trigger: none

jobs:
- job:
  displayName: Validated Impacted Specs
  pool:
    name: azsdk-pool-mms-ubuntu-2204-general
    vmImage: ubuntu-22.04

  steps:
  - template: /eng/pipelines/templates/steps/merge-parent-if-typespec-next.yml

  - template: /eng/pipelines/templates/steps/npm-install.yml

  - pwsh: |
      $(Build.SourcesDirectory)/eng/scripts/TypeSpec-Validation.ps1 -GitClean -BaseCommitish HEAD~2 -Verbose
    displayName: Validate Impacted Specs
    ignoreLASTEXITCODE: true
    condition: |
      and(
        succeeded(),
        or(
          eq(variables['Build.SourceBranchName'], 'typespec-next'),
          eq(variables['System.PullRequest.targetBranchName'], 'typespec-next')
        )
      )

  - pwsh: |
      $(Build.SourcesDirectory)/eng/scripts/TypeSpec-Validation.ps1 -GitClean -Verbose
    displayName: Validate Impacted Specs
    ignoreLASTEXITCODE: true
    condition: |
      and(
        succeeded(),
        and(
          ne(variables['Build.SourceBranchName'], 'typespec-next'),
          ne(variables['System.PullRequest.targetBranchName'], 'typespec-next')
        )
      )
