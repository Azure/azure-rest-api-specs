parameters:
- name: NodeVersion
  type: string
  default: 20.x
steps:
  - task: NodeTool@0
    inputs:
      versionSpec: ${{ parameters.NodeVersion }}
    displayName: "Use Node ${{ parameters.NodeVersion }}"

  - script: npm --version --loglevel info
    displayName: npm --version

  - script: npm install --no-package-lock
    displayName: npm install --no-package-lock
    condition: |
      and(
        succeeded(),
        or(
          eq(variables['Build.SourceBranchName'], 'typespec-next'),
          eq(variables['System.PullRequest.targetBranchName'], 'typespec-next')
        )
      )

  - script: npm ci
    displayName: npm ci
    condition: |
      and(
        succeeded(),
        and(
          ne(variables['Build.SourceBranchName'], 'typespec-next'),
          ne(variables['System.PullRequest.targetBranchName'], 'typespec-next')
        )
      )

  - script: npm ls -a
    displayName: npm ls -a
    condition: succeededOrFailed()
    continueOnError: true
