parameters:
- name: Folder
  type: string
- name: DisplayName
  type: string

steps:
- script: |
    # Log commands before running
    set -x
    
    cd ${{parameters.Folder}}
    npx tsp compile .
    cd $(Build.SourcesDirectory)

    # If any files are added, changed, or deleted, print diff and return error
    if [ -n "$(git status --porcelain)" ]; then
      git status
      git diff
      exit 1
    else

    # Revert any changes
    git clean -df
  displayName: ${{parameters.DisplayName}}
  condition: succeededOrFailed()
