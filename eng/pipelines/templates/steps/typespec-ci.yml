parameters:
- name: Folder
  type: string
- name: DisplayName
  type: string

steps:
- script: |
    # Log commands before running
    set -x
    
    cd ${{parameters.Folder}}
    npx tsp compile .
    cd $(Build.SourcesDirectory)

    # If "tsp compile" generated different swagger than is checked in, display the diff
    git diff

    # "git diff-index --quiet HEAD --" returns zero exit code if no diff, nonzero if yes diff
    # Should cause step to fail if any diff was detected
    git diff-index --quiet HEAD --

    # Revert any changed files
    git restore .    
  displayName: ${{parameters.DisplayName}}
  condition: succeededOrFailed()
