language: node_js
node_js:
  - '8'
services:
  - docker
install: true
stages:
  - Gate
  - Test
jobs:
  allow_failures:
    - stage: Test
      name: Model Validator
      install: npm install
      script: node scripts/modelValidation.js
      env:
        - PR_ONLY=true
    - stage: Test
      name: Semantic Validator All files
      install: npm install
      script: node scripts/semanticValidation.js
      env:
        - PR_ONLY=false
    - stage: Test
      name: Node
      script: travis_wait 30 scripts/swagger-to-sdk.sh Azure/azure-sdk-for-node -v
    - stage: Test
      name: Typescript
      script: travis_wait 30 scripts/swagger-to-sdk.sh Azure/azure-sdk-for-js -v
    - stage: Test
      name: Ruby
      script: travis_wait 30 scripts/swagger-to-sdk.sh Azure/azure-sdk-for-ruby -v
    - stage: Test
      name: Go
      script: travis_wait 30 scripts/swagger-to-sdk.sh Azure/azure-sdk-for-go -o latest -v
    - stage: Test
      name: Java
      script: travis_wait 30 scripts/swagger-to-sdk.sh Azure/azure-sdk-for-java -v
  include:
    - stage: Gate
      name: Branch Strategy
      script: false
      if: branch = master AND repo = Azure/azure-rest-api-specs-pr AND type = pull_request
    - stage: Test
      name: Semantic Validator PR files
      install: npm install
      script: node scripts/semanticValidation.js
      env:
        - PR_ONLY=true
    - stage: Test
      name: Linter Diff
      install:
        - scripts/install-dotnet.sh
        - npm install
      script: node scripts/momentOfTruth.js && node scripts/momentOfTruthPostProcessing.js
      env:
        - PR_ONLY=true
    - stage: Test
      name: Syntax Validator
      install: npm install
      script: npm test -- test/syntax.js
    - stage: Test
      name: Python
      script: travis_wait 30 scripts/swagger-to-sdk.sh Azure/azure-sdk-for-python -v
    - stage: Test
      name: Semantic Validator All files
      install: npm install
      script: node scripts/semanticValidation.js
      env:
        - PR_ONLY=false
    - stage: Test
      name: Breaking Changes
      install:
        - scripts/install-dotnet.sh
        - npm install
      script: node -- scripts/breaking-change.js
      env:
        - PR_ONLY=true
    - stage: Test
      name: Model Validator
      install: npm install
      script: node scripts/modelValidation.js
      env:
        - PR_ONLY=true
    - stage: Test
      name: Node
      script: travis_wait 30 scripts/swagger-to-sdk.sh Azure/azure-sdk-for-node -v
    - stage: Test
      name: Typescript
      script: travis_wait 30 scripts/swagger-to-sdk.sh Azure/azure-sdk-for-js -v
    - stage: Test
      name: Ruby
      script: travis_wait 30 scripts/swagger-to-sdk.sh Azure/azure-sdk-for-ruby -v
    - stage: Test
      name: Go
      script: travis_wait 30 scripts/swagger-to-sdk.sh Azure/azure-sdk-for-go -o latest -v
    - stage: Test
      name: Java
      script: travis_wait 30 scripts/swagger-to-sdk.sh Azure/azure-sdk-for-java -v
