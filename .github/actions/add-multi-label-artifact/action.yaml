name: Add Multi Label Artifact
description: Uploads empty artifacts for each label-value pair, consumed by the "update-labels" action.

inputs:
  labels:
    description: "Array of label-value pairs (e.g., ['label-a=true','label-b=false'])"
    required: true
  token: 
    description: "GitHub token"
    required: true


runs:
  using: composite

  steps:
    - name: Parse and validate input
      shell: bash
      run: |
        # Convert input to array
        eval "label_array=${{ inputs.labels }}"

        # Check if array is empty
        if [ "${#label_array[@]}" -eq 0 ]; then
          echo "Error: No labels provided."
          exit 1
        fi

        # Debug: Print parsed array
        echo "Parsed labels: ${label_array[@]}"

    - name: Process label-value pairs
      shell: bash
      env:
        GH_TOKEN: ${{ inputs.token }}
      run: |
        # Convert input to array
        eval "label_array=${{ inputs.labels }}"

        for label_pair in "${label_array[@]}"; do
          # Replace '=' with a separator for artifact naming
          artifact_name=$(echo "$label_pair" | sed 's/=/=/')

          # Create empty file for the artifact
          empty_file="$RUNNER_TEMP/empty-${artifact_name}.txt"
          > "$empty_file"

          # Upload artifact using actions/upload-artifact
          echo "Uploading artifact: $artifact_name"
          gh api \
            -H "Accept: application/vnd.github+json" \
            -H "Authorization: token $GH_TOKEN" \
            /repos/${{ github.repository }}/actions/artifacts \
            -X POST \
            -F name="$artifact_name" \
            -F file=@"$empty_file"
        done
