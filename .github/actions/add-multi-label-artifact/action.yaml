name: 'Upload Artifacts Based on Labels'
description: 'Loops over a list of label=value pairs and uploads corresponding artifacts'

inputs:
  labels:
    description: 'A list of label=value pairs'
    required: true

runs:
  using: 'composite'
  steps:
  
    - name: Create empty file to upload artifact
      run: "> $RUNNER_TEMP/empty.txt"
      shell: bash

    - name: Process each label-value pair and upload artifact
      shell: bash
      run: |

        label_string="${{ inputs.labels }}"
        label_string="${label_string//[\[\] ]/}"
        IFS=',' read -r -a label_array <<< "$label_string
        for label_pair in "${label_array[@]}"; do
          echo "Processing label pair: $label_pair"
          uses: actions/upload-artifact@v4
          with:
            name: "$label_pair"
            path: ${{ runner.temp }}/empty.txt
            if-no-files-found: error
            overwrite: true
        done
