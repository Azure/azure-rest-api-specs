name: "Swagger SemanticValidation - Analyze Code"

on:
  pull_request:
    types:
      # default
      - opened
      - synchronize
      - reopened
      # re-run if base branch is changed, since previous merge commit may generate incorrect diff
      - edited

permissions:
  contents: read

jobs:
  oav:
    name: "Swagger SemanticValidation - Analyze Code"
    runs-on: ubuntu-24.04

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4
        with:
          fetch-depth: 2

      - name: Setup Node and install deps
        uses: ./.github/actions/setup-node-install-deps

      - name: Swagger Semantic Validation
        id: swagger-semantic-validation
        run: |
          echo "summary=$GITHUB_STEP_SUMMARY" >> "$GITHUB_OUTPUT"
          npm exec --no -- oav-runner specs

      # Used by other workflows like set-status
      - name: Set job-summary artifact
        if: ${{ always() && steps.swagger-semantic-validation.outputs.summary }}
        uses: actions/upload-artifact@v4
        with:
          name: job-summary
          path: ${{ steps.swagger-semantic-validation.outputs.summary }}
          # If the file doesn't exist, just don't add the artifact
          if-no-files-found: ignore
