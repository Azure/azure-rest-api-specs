name: Check Spelling in Changed Files

on:
  pull_request:
    branches:
      - main
      - RPSaaSMaster
      - typespec-next

jobs:
  check-spelling:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2
      # TODO: is this required?
      with:
        fetch-depth: 0  # Ensure full history is fetched

    - name: Run spelling check
      run: |
        Write-Host '${{ toJson(github) }}'
        Write-Host "Remotes..."
        git remote -vv

        $targetCommittish = git rev-parse ${{ github.base_ref }}
        ./eng/common/scripts/check-spelling-in-changed-files.ps1 `
            -CSpellConfigPath 'cSpell.json' `
            -SourceCommittish '${{ github.sha }}' `
            -TargetCommittish  $targetCommittish
      shell: pwsh
