name: After APIView

on:
  check_run:
    types: [completed]
    
permissions:
  issues: write
  contents: read

jobs:
  event-handler:
    name: After APIView
    runs-on: ubuntu-24.04
    if: ${{ github.event.check_run.check_suite.app.name == 'Azure Pipelines' && 
          ( contains(github.event.check_run.name, 'APIView') ||
            contains(github.event.check_run.name, 'Azure.azure-rest-api-specs-pipeline' ) }}
    steps:
      - name: Checkout
        uses: actions/checkout@v2
        with:
          sparse-checkout: 'eng/common'
    
      - name: Create APIView Comment on PR
        run: |
          . ../../../eng/common/scripts/helpers/ApiView-Helpers.ps1
          Set-ApiViewCommentForRelatedIssues -HeadCommitish ${{ github.event.check_suite.head_sha }} -AuthToken ${{ secrets.GITHUB_TOKEN }}
        shell: pwsh
