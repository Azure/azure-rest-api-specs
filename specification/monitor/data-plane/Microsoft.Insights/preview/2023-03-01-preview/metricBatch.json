{
  "swagger": "2.0",
  "info": {
    "title": "Azure Monitor Metric Batch",
    "version": "2023-03-01-preview"
  },
  "x-ms-parameterized-host": {
    "hostTemplate": "{baseUrl}",
    "useSchemePrefix": false,
    "positionInOperation": "first",
    "parameters": [
      {
        "name": "baseUrl",
        "description": "The regional endpoint to use, for example https://eastus.metrics.monitor.azure.com. The region should match the region of the requested resources.",
        "required": true,
        "type": "string",
        "in": "path",
        "x-ms-skip-url-encoding": true
      }
    ]
  },
  "consumes": [
    "application/json"
  ],
  "produces": [
    "application/json"
  ],
  "paths": {
    "/subscriptions/{subscriptionId}/metricBatch": {
      "post": {
        "tags": [
          "Metrics"
        ],
        "operationId": "Metrics_Batch",
        "description": "**Lists the metric values for multiple resources**.",
        "parameters": [
          {
            "$ref": "#/parameters/SubscriptionIdParameter"
          },
          {
            "$ref": "#/parameters/TimespanParameter"
          },
          {
            "$ref": "#/parameters/IntervalParameter"
          },
          {
            "$ref": "#/parameters/MetricNamespaceParameter"
          },
          {
            "$ref": "#/parameters/MetricNamesParameter"
          },
          {
            "$ref": "#/parameters/AggregationsParameter"
          },
          {
            "$ref": "#/parameters/TopParameter"
          },
          {
            "$ref": "#/parameters/OrderByParameter"
          },
          {
            "name": "$filter",
            "in": "query",
            "required": false,
            "type": "string",
            "description": "The **$filter** is used to reduce the set of metric data returned.<br>Example:<br>Metric contains metadata A, B and C.<br>- Return all time series of C where A = a1 and B = b1 or b2<br>**$filter=A eq ‘a1’ and B eq ‘b1’ or B eq ‘b2’ and C eq ‘*’**<br>- Invalid variant:<br>**$filter=A eq ‘a1’ and B eq ‘b1’ and C eq ‘*’ or B = ‘b2’**<br>This is invalid because the logical or operator cannot separate two different metadata names.<br>- Return all time series where A = a1, B = b1 and C = c1:<br>**$filter=A eq ‘a1’ and B eq ‘b1’ and C eq ‘c1’**<br>- Return all time series where A = a1<br>**$filter=A eq ‘a1’ and B eq ‘*’ and C eq ‘*’**."
          },
          {
            "$ref": "#/parameters/ResourceIdList"
          }
        ],
        "responses": {
          "200": {
            "description": "The response to a metrics query.",
            "schema": {
              "$ref": "#/definitions/Response"
            }
          },
          "400": {
            "description": "The response to a metrics query that results in a bad request, with optional additional information.",
            "schema": {
              "$ref": "#/definitions/AdditionalInfoErrorResponse"
            }
          },
          "default": {
            "description": "Describes the format of Error response.",
            "schema": {
              "$ref": "#/definitions/ErrorResponse"
            }
          }
        },
        "x-ms-examples": {
          "Query Storage Metrics": {
            "$ref": "./examples/MetricBatchExample.json"
          }
        }
      }
    }
  },
  "parameters": {
    "ResourceIdList": {
      "name": "resourceIds",
      "in": "body",
      "required": true,
      "schema": {
        "$ref": "#/definitions/ResourceIdList"
      },
      "description": "The comma separated list of resource IDs to query metrics for."
    },
    "SubscriptionIdParameter": {
      "name": "subscriptionId",
      "in": "path",
      "required": true,
      "type": "string",
      "description": "The subscription identifier for the resources in this batch.",
      "x-ms-parameter-location": "method"
    },
    "TimespanParameter": {
      "name": "timespan",
      "in": "query",
      "required": false,
      "type": "string",
      "description": "The timespan of the query. It is a string in the following format 'startDateTime_ISO/endDateTime_ISO'.",
      "x-ms-parameter-location": "method"
    },
    "IntervalParameter": {
      "name": "interval",
      "in": "query",
      "required": false,
      "type": "string",
      "format": "duration",
      "description": "The interval (i.e. timegrain) of the query. The default value is PT1M.",
      "x-ms-parameter-location": "method"
    },
    "MetricNamespaceParameter": {
      "name": "metricnamespace",
      "in": "query",
      "required": true,
      "type": "string",
      "description": "Metric namespace that contains the requested metric names.",
      "x-ms-parameter-location": "method"
    },
    "MetricNamesParameter": {
      "name": "metricnames",
      "in": "query",
      "required": true,
      "type": "string",
      "description": "The names of the metrics (comma separated) to retrieve.",
      "x-ms-parameter-location": "method"
    },
    "AggregationsParameter": {
      "name": "aggregation",
      "in": "query",
      "required": false,
      "type": "string",
      "description": "The list of aggregation types (comma separated) to retrieve.",
      "x-ms-parameter-location": "method"
    },
    "TopParameter": {
      "name": "top",
      "in": "query",
      "required": false,
      "type": "integer",
      "format": "int32",
      "description": "The maximum number of records to retrieve.\nValid only if $filter is specified.\nDefaults to 10.",
      "x-ms-parameter-location": "method"
    },
    "OrderByParameter": {
      "name": "orderby",
      "in": "query",
      "required": false,
      "type": "string",
      "description": "The aggregation to use for sorting results and the direction of the sort.\nOnly one order can be specified.\nExamples: sum asc.",
      "x-ms-parameter-location": "method"
    }
  },
  "definitions": {
    "ResourceIdList": {
      "description": "The comma separated list of resource IDs to query metrics for.",
      "type": "array",
      "items": {
        "type": "string"
      },
      "example": [
        "/subscriptions/123456728-abcd-1234-abcd-123456789abc/resourceGroups/TestGroup/providers/Microsoft.Storage/storageAccounts/TestStorage1",
        "/subscriptions/123456728-abcd-1234-abcd-123456789abc/resourceGroups/TestGroup/providers/Microsoft.Storage/storageAccounts/TestStorage2"
      ]
    },
    "ErrorResponse": {
      "description": "Describes the format of Error response.",
      "type": "object",
      "properties": {
        "code": {
          "description": "Error code",
          "type": "string"
        },
        "message": {
          "description": "Error message indicating why the operation failed.",
          "type": "string"
        }
      }
    },
    "AdditionalInfoErrorResponse": {
      "description": "The response to a metrics query that results in a bad request, with optional additional information.",
      "type": "object",
      "properties": {
        "additionalInfo": {
          "description": "Additional information about the error",
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "type": {
                "description": "The type of the info property (e.g. string).",
                "type": "string"
              },
              "info": {
                "description": "Additional information related to the error.",
                "type": "string"
              }
            }
          }
        },
        "code": {
          "description": "Error code",
          "type": "string"
        },
        "message": {
          "description": "Error message indicating why the operation failed.",
          "type": "string"
        }
      }
    },
    "Response": {
      "description": "The metrics result for a resource.",
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "timespan": {
            "type": "string",
            "description": "The timespan for which the data was retrieved. Its value consists of two datetimes concatenated, separated by '/'.  This may be adjusted in the future and returned back from what was originally requested."
          },
          "interval": {
            "type": "string",
            "format": "duration",
            "description": "The interval (window size) for which the metric data was returned in.  This may be adjusted in the future and returned back from what was originally requested.  This is not present if a metadata request was made."
          },
          "namespace": {
            "type": "string",
            "description": "The namespace of the metrics been queried"
          },
          "resourceregion": {
            "type": "string",
            "description": "The region of the resource been queried for metrics."
          },
          "resourceid": {
            "type": "string",
            "description": "The resource that has been queried for metrics."
          },
          "value": {
            "type": "array",
            "items": {
              "$ref": "#/definitions/Metric"
            },
            "description": "the value of the collection."
          }
        },
        "required": [
          "timespan",
          "value"
        ]
      }
    },
    "MetricBatchBody": {
      "description": "List of resource ids to fetch metric namespaces for",
      "type": "array",
      "items": {
        "type": "string"
      },
      "example": [
        "/subscriptions/123456728-abcd-1234-abcd-123456789abc/resourceGroups/TestGroup/providers/Microsoft.Storage/storageAccounts/TestStorage1",
        "/subscriptions/123456728-abcd-1234-abcd-123456789abc/resourceGroups/TestGroup/providers/Microsoft.Storage/storageAccounts/TestStorage2"
      ]
    },
    "LocalizableString": {
      "type": "object",
      "required": [
        "value"
      ],
      "properties": {
        "value": {
          "type": "string",
          "description": "the invariant value."
        },
        "localizedValue": {
          "type": "string",
          "description": "the locale specific value."
        }
      },
      "description": "The localizable string class."
    },
    "Unit": {
      "type": "string",
      "description": "the unit of the metric.",
      "enum": [
        "Count",
        "Bytes",
        "Seconds",
        "CountPerSecond",
        "BytesPerSecond",
        "Percent",
        "MilliSeconds",
        "ByteSeconds",
        "Unspecified",
        "Cores",
        "MilliCores",
        "NanoCores",
        "BitsPerSecond"
      ],
      "x-ms-enum": {
        "name": "Unit",
        "modelAsString": false
      }
    },
    "MetricValue": {
      "type": "object",
      "required": [
        "timeStamp"
      ],
      "properties": {
        "timeStamp": {
          "type": "string",
          "format": "date-time",
          "description": "the timestamp for the metric value in ISO 8601 format."
        },
        "average": {
          "type": "number",
          "format": "double",
          "description": "the average value in the time range."
        },
        "minimum": {
          "type": "number",
          "format": "double",
          "description": "the least value in the time range."
        },
        "maximum": {
          "type": "number",
          "format": "double",
          "description": "the greatest value in the time range."
        },
        "total": {
          "type": "number",
          "format": "double",
          "description": "the sum of all of the values in the time range."
        },
        "count": {
          "type": "number",
          "format": "double",
          "description": "the number of samples in the time range. Can be used to determine the number of values that contributed to the average value."
        }
      },
      "description": "Represents a metric value."
    },
    "MetadataValue": {
      "type": "object",
      "properties": {
        "name": {
          "$ref": "#/definitions/LocalizableString",
          "description": "the name of the metadata."
        },
        "value": {
          "type": "string",
          "description": "the value of the metadata."
        }
      },
      "description": "Represents a metric metadata value."
    },
    "Metric": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "description": "the metric Id."
        },
        "name": {
          "$ref": "#/definitions/LocalizableString",
          "description": "the name and the display name of the metric, i.e. it is localizable string."
        },
        "displayDescription": {
          "type": "string",
          "description": "Description of this metric"
        },
        "type": {
          "type": "string",
          "description": "the resource type of the metric resource."
        },
        "unit": {
          "$ref": "#/definitions/Unit",
          "description": "the unit of the metric."
        },
        "timeseries": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/TimeSeriesElement"
          },
          "description": "the time series returned when a data query is performed."
        },
        "errorCode": {
          "type": "string",
          "description": "'Success' or the error details on query failures for this metric."
        },
        "errorMessage": {
          "type": "string",
          "description": "Error message encountered querying this specific metric."
        }
      },
      "required": [
        "id",
        "name",
        "displayDescription",
        "type",
        "unit",
        "timeseries"
      ],
      "description": "The result data of a query."
    },
    "TimeSeriesElement": {
      "type": "object",
      "properties": {
        "metadatavalues": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/MetadataValue"
          },
          "description": "the metadata values returned if $filter was specified in the call."
        },
        "data": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/MetricValue"
          },
          "description": "An array of data points representing the metric values.  This is only returned if a result type of data is specified."
        }
      },
      "description": "A time series result type. The discriminator value is always TimeSeries in this case."
    }
  }
}
