{
  "parameters": {
    "subscriptionId": "14ddf0c5-77c5-4b53-84f6-e1fa43ad68f7",
    "resourceGroupName": "gigtest",
    "ruleName": "dynamiccpu",
    "api-version": "2024-03-01-preview",
    "parameters": {
      "location": "global",
      "identity": {
        "type": "UserAssigned",
        "userAssignedIdentities": {
          "/subscriptions/14ddf0c5-77c5-4b53-84f6-e1fa43ad68f7/resourceGroups/gigtest/providers/Microsoft.ManagedIdentity/userAssignedIdentities/myId": {}
        }
      },
      "tags": {
        "hidden-link:/subscriptions/b67f7fec-69fc-4974-9099-a26bd6ffeda3/resourceGroups/Rac46PostSwapRG/providers/Microsoft.Web/sites/leoalerttest": "Resource"
      },
      "properties": {
        "description": "This is a dynamic metric alert",
        "severity": 3,
        "enabled": true,
        "scopes": [
          "/subscriptions/14ddf0c5-77c5-4b53-84f6-e1fa43ad68f7/resourceGroups/gigtest/providers/Microsoft.Compute/virtualMachines/gigwadme"
        ],
        "evaluationFrequency": "PT1M",
        "resolveConfiguration": {
          "autoResolved": true,
          "timeToResolve": "PT15M"
        },
        "criteria": {
          "odata.type": "Microsoft.Azure.Monitor.QueryMetricCriteria",
          "allOf": [
            {
              "name": "Metric1",
              "criterionType": "Query_StaticThresholdCriterion",
              "query": "Perf | where ObjectName == \"Processor\" and CounterName == \"% Processor Time\" | summarize AggregatedValue = avg(CounterValue) by bin(TimeGenerated, 5m)"
            }
          ]
        },
        "actions": [
          {
            "actionGroupId": "/subscriptions/14ddf0c5-77c5-4b53-84f6-e1fa43ad68f7/resourcegroups/gigtest/providers/microsoft.insights/actiongroups/group2"
          }
        ]
      }
    }
  },
  "responses": {
    "200": {
      "body": {
        "id": "/subscriptions/14ddf0c5-77c5-4b53-84f6-e1fa43ad68f7/resourceGroups/gigtest/providers/microsoft.insights/metricAlerts/dynamiccpu",
        "type": "Microsoft.Insights/metricAlerts",
        "name": "dynamiccpu",
        "location": "global",
        "identity": {
          "type": "UserAssigned",
          "tenantId": "9c14adb6-f0b4-4b26-a090-45e4c571f222",
          "userAssignedIdentities": {
            "/subscriptions/14ddf0c5-77c5-4b53-84f6-e1fa43ad68f7/resourceGroups/gigtest/providers/Microsoft.ManagedIdentity/userAssignedIdentities/myId": {
              "clientId": "ef8372b0-d5c7-4c44-9d2b-1ea5c2cb5432",
              "principalId": "85a35d7d-5f01-454b-9f4a-d23c4938d13f"
            }
          }
        },
        "tags": {
          "hidden-link:/subscriptions/b67f7fec-69fc-4974-9099-a26bd6ffeda3/resourceGroups/Rac46PostSwapRG/providers/Microsoft.Web/sites/leoalerttest": "Resource"
        },
        "properties": {
          "description": "This is a dynamic metric alert",
          "severity": 3,
          "enabled": true,
          "scopes": [
            "/subscriptions/14ddf0c5-77c5-4b53-84f6-e1fa43ad68f7/resourceGroups/gigtest/providers/Microsoft.Compute/virtualMachines/gigwadme"
          ],
          "evaluationFrequency": "PT1M",
          "resolveConfiguration": {
            "autoResolved": true,
            "timeToResolve": "PT15M"
          },
          "criteria": {
            "odata.type": "Microsoft.Azure.Monitor.QueryMetricCriteria",
            "allOf": [
              {
                "name": "Metric1",
                "criterionType": "StaticThresholdCriterion",
                "query": "Perf | where ObjectName == \"Processor\" and CounterName == \"% Processor Time\" | summarize AggregatedValue = avg(CounterValue) by bin(TimeGenerated, 5m)"
              }
            ]
          },
          "actions": [
            {
              "actionGroupId": "/subscriptions/14ddf0c5-77c5-4b53-84f6-e1fa43ad68f7/resourcegroups/gigtest/providers/microsoft.insights/actiongroups/group2"
            }
          ]
        }
      }
    },
    "201": {
      "body": {
        "id": "/subscriptions/14ddf0c5-77c5-4b53-84f6-e1fa43ad68f7/resourceGroups/gigtest/providers/microsoft.insights/metricAlerts/dynamiccpu",
        "type": "Microsoft.Insights/metricAlerts",
        "name": "dynamiccpu",
        "location": "global",
        "kind": "Query",
        "identity": {
          "type": "UserAssigned",
          "tenantId": "9c14adb6-f0b4-4b26-a090-45e4c571f222",
          "userAssignedIdentities": {
            "/subscriptions/14ddf0c5-77c5-4b53-84f6-e1fa43ad68f7/resourceGroups/gigtest/providers/Microsoft.ManagedIdentity/userAssignedIdentities/myId": {
              "clientId": "ef8372b0-d5c7-4c44-9d2b-1ea5c2cb5432",
              "principalId": "85a35d7d-5f01-454b-9f4a-d23c4938d13f"
            }
          }
        },
        "tags": {
          "hidden-link:/subscriptions/b67f7fec-69fc-4974-9099-a26bd6ffeda3/resourceGroups/Rac46PostSwapRG/providers/Microsoft.Web/sites/leoalerttest": "Resource"
        },
        "properties": {
          "description": "This is a dynamic metric alert",
          "severity": 3,
          "enabled": true,
          "scopes": [
            "/subscriptions/14ddf0c5-77c5-4b53-84f6-e1fa43ad68f7/resourceGroups/gigtest/providers/Microsoft.Compute/virtualMachines/gigwadme"
          ],
          "evaluationFrequency": "PT1M",
          "resolveConfiguration": {
            "autoResolved": true,
            "timeToResolve": "PT15M"
          },
          "criteria": {
            "odata.type": "Microsoft.Azure.Monitor.QueryMetricCriteria",
            "allOf": [
              {
                "name": "Metric1",
                "criterionType": "StaticThresholdCriterion",
                "query": "Perf | where ObjectName == \"Processor\" and CounterName == \"% Processor Time\" | summarize AggregatedValue = avg(CounterValue) by bin(TimeGenerated, 5m)"
              }
            ]
          },
          "actions": [
            {
              "actionGroupId": "/subscriptions/14ddf0c5-77c5-4b53-84f6-e1fa43ad68f7/resourcegroups/gigtest/providers/microsoft.insights/actiongroups/group2"
            }
          ]
        }
      }
    }
  }
}
