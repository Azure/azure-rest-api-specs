{
  "parameters": {
    "accountName": "sampleacct",
    "api-version": "2025-06-01",
    "parameters": {
      "properties": {
        "deploymentConfiguration": {
          "virtualMachineConfiguration": {
            "imageReference": {
              "offer": "WindowsServer",
              "publisher": "MicrosoftWindowsServer",
              "sku": "2019-datacenter-smalldisk",
              "version": "latest"
            },
            "nodeAgentSkuId": "batch.node.windows amd64",
            "nodePlacementConfiguration": {
              "policy": "Zonal"
            },
            "windowsConfiguration": {
              "enableAutomaticUpdates": false
            }
          }
        },
        "scaleSettings": {
          "fixedScale": {
            "targetDedicatedNodes": 2,
            "targetLowPriorityNodes": 0
          }
        },
        "upgradePolicy": {
          "automaticOSUpgradePolicy": {
            "disableAutomaticRollback": true,
            "enableAutomaticOSUpgrade": true,
            "osRollingUpgradeDeferral": true,
            "useRollingUpgradePolicy": true
          },
          "mode": "automatic",
          "rollingUpgradePolicy": {
            "enableCrossZoneUpgrade": true,
            "maxBatchInstancePercent": 20,
            "maxUnhealthyInstancePercent": 20,
            "maxUnhealthyUpgradedInstancePercent": 20,
            "pauseTimeBetweenBatches": "PT0S",
            "prioritizeUnhealthyInstances": false,
            "rollbackFailedInstancesOnPolicyBreach": false
          }
        },
        "vmSize": "Standard_d4s_v3"
      }
    },
    "poolName": "testpool",
    "resourceGroupName": "default-azurebatch-japaneast",
    "subscriptionId": "12345678-1234-1234-1234-123456789012"
  },
  "responses": {
    "200": {
      "body": {
        "name": "testpool",
        "type": "Microsoft.Batch/batchAccounts/pools",
        "id": "/subscriptions/12345678-1234-1234-1234-123456789012/resourceGroups/default-azurebatch-japaneast/providers/Microsoft.Batch/batchAccounts/sampleacct/pools/testpool",
        "properties": {
          "allocationState": "Resizing",
          "allocationStateTransitionTime": "2023-05-11T06:16:44.2372184Z",
          "creationTime": "2023-05-11T06:16:44.2372184Z",
          "currentDedicatedNodes": 0,
          "currentLowPriorityNodes": 0,
          "deploymentConfiguration": {
            "virtualMachineConfiguration": {
              "imageReference": {
                "offer": "WindowsServer",
                "publisher": "MicrosoftWindowsServer",
                "sku": "2019-datacenter-smalldisk",
                "version": "latest"
              },
              "nodeAgentSkuId": "batch.node.windows amd64",
              "nodePlacementConfiguration": {
                "policy": "Zonal"
              },
              "windowsConfiguration": {
                "enableAutomaticUpdates": false
              }
            }
          },
          "interNodeCommunication": "Disabled",
          "lastModified": "2023-05-11T06:16:44.2372184Z",
          "provisioningState": "Succeeded",
          "provisioningStateTransitionTime": "2023-05-11T06:16:44.2372184Z",
          "resizeOperationStatus": {
            "nodeDeallocationOption": "Requeue",
            "resizeTimeout": "PT15M",
            "startTime": "2023-05-11T06:16:44.2372184Z",
            "targetDedicatedNodes": 2
          },
          "scaleSettings": {
            "fixedScale": {
              "resizeTimeout": "PT15M",
              "targetDedicatedNodes": 2,
              "targetLowPriorityNodes": 0
            }
          },
          "taskSchedulingPolicy": {
            "nodeFillType": "Spread"
          },
          "taskSlotsPerNode": 1,
          "upgradePolicy": {
            "automaticOSUpgradePolicy": {
              "disableAutomaticRollback": true,
              "enableAutomaticOSUpgrade": true,
              "osRollingUpgradeDeferral": true,
              "useRollingUpgradePolicy": true
            },
            "mode": "automatic",
            "rollingUpgradePolicy": {
              "enableCrossZoneUpgrade": true,
              "maxBatchInstancePercent": 20,
              "maxUnhealthyInstancePercent": 20,
              "maxUnhealthyUpgradedInstancePercent": 20,
              "pauseTimeBetweenBatches": "PT0S",
              "prioritizeUnhealthyInstances": false,
              "rollbackFailedInstancesOnPolicyBreach": false
            }
          },
          "vmSize": "STANDARD_D4S_V3"
        }
      },
      "headers": {
        "ETag": "W/\"0x8DB51E64D3C3B69\""
      }
    }
  },
  "operationId": "Pool_Create",
  "title": "CreatePool - UpgradePolicy"
}
