scope: ResourceGroup
testScenarios:
  - description: test_nw_flow_log_update
    steps:
      - step: RawStep_3052
        method: GET
        rawUrl: >-
          https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/test_nw_flow_log_000001?api-version=2020-10-01
        requestHeaders:
          cache-control: no-cache
          content-length: '428'
          content-type: application/json; charset=utf-8
          date: Wed, 24 Feb 2021 15:43:21 GMT
          expires: '-1'
          pragma: no-cache
          strict-transport-security: max-age=31536000; includeSubDomains
          vary: Accept-Encoding
          x-content-type-options: nosniff
        responseExpected: >-
          {"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/test_nw_flow_log_000001","name":"test_nw_flow_log_000001","type":"Microsoft.Resources/resourceGroups","location":"eastus","tags":{"product":"azurecli","cause":"automation","date":"2021-02-24T15:42:49Z"},"properties":{"provisioningState":"Succeeded"}}
      - step: Create_networkSecurityGroups_nsg1
        resourceName: networkSecurityGroups_nsg1
        exampleFile: ../examples/Create_networkSecurityGroups_nsg1_Generated_3054.json
        operationId: NetworkSecurityGroups_CreateOrUpdate
      - step: RawStep_3055
        method: GET
        rawUrl: >-
          https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/test_nw_flow_log_000001?api-version=2020-10-01
        requestHeaders:
          cache-control: no-cache
          content-length: '428'
          content-type: application/json; charset=utf-8
          date: Wed, 24 Feb 2021 15:43:36 GMT
          expires: '-1'
          pragma: no-cache
          strict-transport-security: max-age=31536000; includeSubDomains
          vary: Accept-Encoding
          x-content-type-options: nosniff
        responseExpected: >-
          {"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/test_nw_flow_log_000001","name":"test_nw_flow_log_000001","type":"Microsoft.Resources/resourceGroups","location":"eastus","tags":{"product":"azurecli","cause":"automation","date":"2021-02-24T15:42:49Z"},"properties":{"provisioningState":"Succeeded"}}
      - step: RawStep_3056
        method: PUT
        rawUrl: >-
          https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/test_nw_flow_log_000001/providers/Microsoft.Storage/storageAccounts/storageaccount0395?api-version=2021-01-01
        requestBody: >-
          {"sku":{"name":"Standard_RAGRS"},"kind":"StorageV2","location":"eastus","properties":{"encryption":{"services":{"blob":{}},"keySource":"Microsoft.Storage"},"supportsHttpsTrafficOnly":true}}
        requestHeaders:
          cache-control: no-cache
          content-length: '0'
          content-type: text/plain; charset=utf-8
          date: Wed, 24 Feb 2021 15:43:38 GMT
          expires: '-1'
          location: >-
            https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Storage/locations/eastus/asyncoperations/1f057423-dba6-4079-8b99-ec2cfa2d6ac0?monitor=true&api-version=2021-01-01
          pragma: no-cache
          server: >-
            Microsoft-Azure-Storage-Resource-Provider/1.0,Microsoft-HTTPAPI/2.0
            Microsoft-HTTPAPI/2.0
          strict-transport-security: max-age=31536000; includeSubDomains
          x-content-type-options: nosniff
          x-ms-ratelimit-remaining-subscription-writes: '1193'
        statusCode: 202
      - step: RawStep_3057
        method: PUT
        rawUrl: >-
          https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/test_nw_flow_log_000001/providers/Microsoft.OperationalInsights/workspaces/clitest000003?api-version=2020-08-01
        requestBody: >-
          {"location":"eastus","properties":{"sku":{"name":"PerGB2018"},"retentionInDays":30,"workspaceCapping":{}}}
        requestHeaders:
          cache-control: no-cache
          content-length: '1177'
          content-type: application/json
          date: Wed, 24 Feb 2021 15:44:03 GMT
          pragma: no-cache
          server: Microsoft-IIS/10.0 Microsoft-IIS/10.0
          strict-transport-security: max-age=31536000; includeSubDomains
          x-content-type-options: nosniff
          x-ms-ratelimit-remaining-subscription-writes: '1192'
          x-powered-by: ASP.NET ASP.NET
        statusCode: 201
        responseExpected: >-
          {"properties":{"source":"Azure","customerId":"906914ad-6921-4114-9b71-e549fe0bb9b5","provisioningState":"Creating","sku":{"name":"pergb2018","maxCapacityReservationLevel":3000,"lastSkuUpdate":"Wed,
          24 Feb 2021 15:44:02
          GMT"},"retentionInDays":30,"features":{"legacy":0,"searchVersion":1,"enableLogAccessUsingOnlyResourcePermissions":true},"workspaceCapping":{"dailyQuotaGb":-1,"quotaNextResetTime":"Thu,
          25 Feb 2021 09:00:00
          GMT","dataIngestionStatus":"RespectQuota"},"publicNetworkAccessForIngestion":"Enabled","publicNetworkAccessForQuery":"Enabled","createdDate":"Wed,
          24 Feb 2021 15:44:02 GMT","modifiedDate":"Wed, 24 Feb 2021 15:44:02
          GMT"},"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/test_nw_flow_log_000001/providers/microsoft.operationalinsights/workspaces/clitest000003","name":"clitest000003","type":"Microsoft.OperationalInsights/workspaces","location":"eastus"}
      - step: NetworkWatchers_ListAll_3058
        exampleFile: ../examples/NetworkWatchers_ListAll_2688_Generated.json
        operationId: NetworkWatchers_ListAll
      - step: RawStep_3059
        method: GET
        rawUrl: >-
          https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/providers/microsoft.operationalinsights?api-version=2020-10-01
        requestHeaders:
          cache-control: no-cache
          content-length: '8910'
          content-type: application/json; charset=utf-8
          date: Wed, 24 Feb 2021 15:44:35 GMT
          expires: '-1'
          pragma: no-cache
          strict-transport-security: max-age=31536000; includeSubDomains
          vary: Accept-Encoding
          x-content-type-options: nosniff
        responseExpected: >-
          {"id":"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.OperationalInsights","namespace":"Microsoft.OperationalInsights","authorizations":[{"applicationId":"d2a0a418-0aac-4541-82b2-b3142c89da77","roleDefinitionId":"86695298-2eb9-48a7-9ec3-2fdb38b6878b"},{"applicationId":"ca7f3f0b-7d91-482c-8e09-c5d840d0eac5","roleDefinitionId":"5d5a2e56-9835-44aa-93db-d2f19e155438"}],"resourceTypes":[{"resourceType":"workspaces","locations":["East
          US","West Europe","Southeast Asia","Australia Southeast","West Central
          US","Japan East","UK South","Central India","Canada Central","West US
          2","Australia Central","Australia East","France Central","Korea
          Central","North Europe","Central US","East Asia","East US 2","South
          Central US","North Central US","West US","UK West","South Africa
          North","Brazil South","Switzerland North","Switzerland West","Germany
          West Central","Australia Central 2","UAE Central","UAE North","Japan
          West","Brazil Southeast","Norway
          East"],"apiVersions":["2020-10-01","2020-08-01","2020-03-01-preview","2017-04-26-preview","2017-03-15-preview","2017-03-03-preview","2017-01-01-preview","2015-11-01-preview","2015-03-20"],"capabilities":"CrossResourceGroupResourceMove,
          CrossSubscriptionResourceMove, SupportsTags,
          SupportsLocation"},{"resourceType":"locations","locations":[],"apiVersions":["2020-10-01","2020-08-01","2020-03-01-preview","2019-08-01-preview","2017-04-26-preview","2017-03-15-preview","2017-03-03-preview","2017-01-01-preview","2015-11-01-preview","2015-03-20"],"defaultApiVersion":"2020-08-01","capabilities":"None"},{"resourceType":"locations/operationStatuses","locations":["East
          US","West Europe","Southeast Asia","Australia Southeast","West Central
          US","Japan East","UK South","Central India","Canada Central","West US
          2","Australia Central","Australia East","France Central","Korea
          Central","North Europe","Central US","East Asia","East US 2","South
          Central US","North Central US","West US","UK West","South Africa
          North","Brazil South","Switzerland North","Switzerland West","Germany
          West Central","Australia Central 2","UAE Central","UAE North","Japan
          West","Brazil Southeast","Norway
          East"],"apiVersions":["2020-08-01","2020-03-01-preview","2019-08-01-preview","2017-04-26-preview","2017-03-15-preview","2017-03-03-preview","2017-01-01-preview","2015-11-01-preview","2015-03-20"],"defaultApiVersion":"2020-08-01","capabilities":"None"},{"resourceType":"workspaces/scopedPrivateLinkProxies","locations":["East
          US","West Europe","Southeast Asia","Australia Southeast","West Central
          US","Japan East","UK South","Central India","Canada Central","West US
          2","Australia Central","Australia East","France Central","Korea
          Central","North Europe","Central US","East Asia","East US 2","South
          Central US","North Central US","West US","UK West","South Africa
          North","Brazil South","Switzerland North","Switzerland West","Germany
          West Central","Australia Central 2","UAE Central","UAE North","Japan
          West","Brazil Southeast","Norway
          East"],"apiVersions":["2020-03-01-preview","2019-08-01-preview","2015-11-01-preview"],"defaultApiVersion":"2020-03-01-preview","capabilities":"None"},{"resourceType":"workspaces/query","locations":[],"apiVersions":["2017-10-01"],"capabilities":"None"},{"resourceType":"workspaces/metadata","locations":[],"apiVersions":["2017-10-01"],"capabilities":"None"},{"resourceType":"workspaces/dataSources","locations":["East
          US","West Europe","Southeast Asia","Australia Southeast","West Central
          US","Japan East","UK South","Central India","Canada Central","West US
          2","Australia Central","Australia East","France Central","Korea
          Central","North Europe","Central US","East Asia","East US 2","South
          Central US","North Central US","West US","UK West","South Africa
          North","Brazil South","Switzerland North","Switzerland West","Germany
          West Central","Australia Central 2","UAE Central","UAE North","Japan
          West","Brazil Southeast","Norway
          East"],"apiVersions":["2020-08-01","2020-03-01-preview","2015-11-01-preview"],"defaultApiVersion":"2020-08-01","capabilities":"None"},{"resourceType":"workspaces/linkedStorageAccounts","locations":["East
          US","West Europe","Southeast Asia","Australia Southeast","West Central
          US","Japan East","UK South","Central India","Canada Central","West US
          2","Australia Central","Australia East","France Central","Korea
          Central","North Europe","Central US","East Asia","East US 2","South
          Central US","North Central US","West US","UK West","South Africa
          North","Brazil South","Switzerland North","Switzerland West","Germany
          West Central","Australia Central 2","UAE Central","UAE North","Japan
          West","Brazil Southeast","Norway
          East"],"apiVersions":["2020-08-01","2020-03-01-preview","2019-08-01-preview"],"defaultApiVersion":"2020-08-01","capabilities":"None"},{"resourceType":"workspaces/Tables","locations":["East
          US","West Europe","Southeast Asia","Australia Southeast","West Central
          US","Japan East","UK South","Central India","Canada Central","West US
          2","Australia East","Australia Central","France Central","Korea
          Central","North Europe","Central US","East Asia","East US 2","South
          Central US","North Central US","West US","UK West","South Africa
          North","Brazil South","Switzerland North","Switzerland West","Germany
          West Central","Australia Central 2","UAE Central","UAE North","Japan
          West","Brazil Southeast","Norway
          East"],"apiVersions":["2020-08-01","2020-03-01-preview","2017-04-26-preview"],"capabilities":"None"},{"resourceType":"storageInsightConfigs","locations":[],"apiVersions":["2020-08-01","2020-03-01-preview","2014-10-10"],"capabilities":"SupportsExtension"},{"resourceType":"workspaces/linkedServices","locations":["East
          US","West Europe","Southeast Asia","Australia Southeast","West Central
          US","Japan East","UK South","Central India","Canada Central","West US
          2","Australia Central","Australia East","France Central","Korea
          Central","North Europe","Central US","East Asia","East US 2","South
          Central US","North Central US","West US","UK West","South Africa
          North","Brazil South","Switzerland North","Switzerland West","Germany
          West Central","Australia Central 2","UAE Central","UAE North","Japan
          West","Brazil Southeast","Norway
          East"],"apiVersions":["2020-08-01","2020-03-01-preview","2019-08-01-preview","2015-11-01-preview"],"defaultApiVersion":"2020-08-01","capabilities":"None"},{"resourceType":"linkTargets","locations":["East
          US"],"apiVersions":["2020-03-01-preview","2015-03-20"],"capabilities":"None"},{"resourceType":"deletedWorkspaces","locations":["East
          US","West Europe","Southeast Asia","Australia Southeast","West Central
          US","Japan East","UK South","Central India","Canada Central","West US
          2","Australia Central","Australia East","France Central","Korea
          Central","North Europe","Central US","East Asia","East US 2","South
          Central US","North Central US","West US","UK West","South Africa
          North","Brazil South","Switzerland North","Switzerland West","Germany
          West Central","Australia Central 2","UAE Central","UAE North","Japan
          West","Brazil Southeast","Norway
          East"],"apiVersions":["2020-08-01","2020-03-01-preview"],"defaultApiVersion":"2020-08-01","capabilities":"None"},{"resourceType":"operations","locations":[],"apiVersions":["2020-10-01","2020-08-01","2020-03-01-preview","2015-11-01-preview","2014-11-10"],"defaultApiVersion":"2020-08-01","capabilities":"None"},{"resourceType":"clusters","locations":["East
          US","West Europe","Southeast Asia","Australia Southeast","West Central
          US","Japan East","UK South","Central India","Canada Central","West US
          2","Australia Central","Australia East","France Central","Korea
          Central","North Europe","Central US","East Asia","East US 2","South
          Central US","North Central US","West US","UK West","South Africa
          North","Switzerland North","Switzerland West","Germany West
          Central","Australia Central 2","UAE Central","Brazil South","UAE
          North","Japan West","Brazil Southeast","Norway
          East"],"apiVersions":["2020-10-01","2020-08-01","2020-03-01-preview","2019-08-01-preview"],"defaultApiVersion":"2020-08-01","capabilities":"CrossResourceGroupResourceMove,
          CrossSubscriptionResourceMove, SystemAssignedResourceIdentity,
          SupportsTags,
          SupportsLocation"},{"resourceType":"workspaces/dataExports","locations":["East
          US","West Europe","Southeast Asia","Australia Southeast","West Central
          US","Japan East","UK South","Central India","Canada Central","West US
          2","Australia Central","Australia East","France Central","Korea
          Central","North Europe","Central US","East Asia","East US 2","South
          Central US","North Central US","West US","UK West","South Africa
          North","Brazil South","Switzerland North","Switzerland West","Germany
          West Central","Australia Central 2","UAE Central","UAE North","Japan
          West","Brazil Southeast","Norway
          East"],"apiVersions":["2020-08-01","2020-03-01-preview","2019-08-01-preview"],"defaultApiVersion":"2020-08-01","capabilities":"None"}],"registrationState":"Registered","registrationPolicy":"RegistrationRequired"}
      - step: RawStep_3060
        method: GET
        rawUrl: >-
          https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/test_nw_flow_log_000001/providers/microsoft.operationalinsights/workspaces/clitest000003?api-version=2020-10-01
        requestHeaders:
          cache-control: no-cache
          content-length: '1178'
          content-type: application/json
          date: Wed, 24 Feb 2021 15:44:36 GMT
          pragma: no-cache
          server: Microsoft-IIS/10.0 Microsoft-IIS/10.0
          strict-transport-security: max-age=31536000; includeSubDomains
          transfer-encoding: chunked
          vary: Accept-Encoding
          x-content-type-options: nosniff
          x-powered-by: ASP.NET ASP.NET
        responseExpected: >-
          {"properties":{"source":"Azure","customerId":"906914ad-6921-4114-9b71-e549fe0bb9b5","provisioningState":"Succeeded","sku":{"name":"pergb2018","maxCapacityReservationLevel":3000,"lastSkuUpdate":"Wed,
          24 Feb 2021 15:44:02
          GMT"},"retentionInDays":30,"features":{"legacy":0,"searchVersion":1,"enableLogAccessUsingOnlyResourcePermissions":true},"workspaceCapping":{"dailyQuotaGb":-1,"quotaNextResetTime":"Thu,
          25 Feb 2021 09:00:00
          GMT","dataIngestionStatus":"RespectQuota"},"publicNetworkAccessForIngestion":"Enabled","publicNetworkAccessForQuery":"Enabled","createdDate":"Wed,
          24 Feb 2021 15:44:02 GMT","modifiedDate":"Wed, 24 Feb 2021 15:44:03
          GMT"},"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/test_nw_flow_log_000001/providers/microsoft.operationalinsights/workspaces/clitest000003","name":"clitest000003","type":"Microsoft.OperationalInsights/workspaces","location":"eastus"}
      - step: Create_flowLogs_flow_log_test2
        resourceName: flowLogs_flow_log_test2
        exampleFile: ../examples/Create_flowLogs_flow_log_test2_Generated_3062.json
        operationId: FlowLogs_CreateOrUpdate
      - step: NetworkWatchers_ListAll_3063
        exampleFile: ../examples/NetworkWatchers_ListAll_2688_Generated.json
        operationId: NetworkWatchers_ListAll
      - step: Update_flowLogs_flow_log_test2_3066
        resourceName: flowLogs_flow_log_test2
        operationId: FlowLogs_CreateOrUpdate
        resourceUpdate:
          - replace: /properties/storageId
            value: >-
              /subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/test_nw_flow_log_000001/providers/Microsoft.Storage/storageAccounts/storageaccount0395
          - replace: /properties/retentionPolicy/days
            value: 2
          - replace: /properties/retentionPolicy/enabled
            value: true
          - add: /tags
            value:
              foo: bar
    variables:
      networkSecurityGroupName: nsg1
      networkWatcherName: NetworkWatcher_eastus
      flowLogName: flow_log_test2
