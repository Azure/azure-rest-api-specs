{
  "swagger": "2.0",
  "info": {
    "title": "Microsoft Cognitive Language Service - Analyze Conversations",
    "description": "This API accepts a request and mediates among multiple language projects, such as LUIS Generally Available, Question Answering, LUIS Deepstack, and then calls the best candidate service to handle the request. At last, it returns a response with the candidate service's response as a payload.\n\n In some cases, this API needs to forward requests and responses between the caller and an upstream service.",
    "version": "2021-07-15-preview"
  },
  "securityDefinitions": {
    "apim_key": {
      "type": "apiKey",
      "description": "An APIM subscription key.",
      "name": "Ocp-Apim-Subscription-Key",
      "in": "header"
    }
  },
  "security": [
    {
      "apim_key": []
    }
  ],
  "x-ms-parameterized-host": {
    "hostTemplate": "{Endpoint}/language",
    "useSchemePrefix": false,
    "parameters": [
      {
        "$ref": "common.json#/parameters/Endpoint"
      }
    ]
  },
  "paths": {
    "/:analyze-conversations": {
      "post": {
        "operationId": "ConversationAnalysis_AnalyzeConversations",
        "description": "Analyzes the input conversation utterance.",
        "parameters": [
          {
            "name": "projectName",
            "in": "query",
            "required": true,
            "type": "string",
            "description": "The project name."
          },
          {
            "name": "deploymentName",
            "in": "query",
            "required": true,
            "type": "string",
            "description": "The deployment name/deployed version."
          },
          {
            "$ref": "#/parameters/ConversationAnalysisInput"
          },
          {
            "$ref": "common.json#/parameters/ApiVersionParameter"
          }
        ],
        "consumes": [
          "application/json"
        ],
        "produces": [
          "application/json"
        ],
        "responses": {
          "200": {
            "description": "The conversation analysis response.",
            "schema": {
              "$ref": "#/definitions/ConversationAnalysisResult"
            }
          },
          "default": {
            "description": "Error response.",
            "schema": {
              "$ref": "common.json#/definitions/ErrorResponse"
            }
          }
        },
        "x-ms-examples": {
          "Arbitration result": {
            "$ref": "./examples/conversations/Workflow_arbitration.json"
          },
          "LUIS Deepstack project result": {
            "$ref": "./examples/conversations/Conversation_project.json"
          },
          "Workflow direct target result": {
            "$ref": "./examples/conversations/Workflow_direct_target.json"
          }
        }
      }
    }
  },
  "definitions": {
    "ConversationAnalysisInput": {
      "type": "object",
      "description": "The request body.",
      "required": [
        "query"
      ],
      "properties": {
        "query": {
          "description": "The conversation utterance to be analyzed.",
          "type": "string"
        },
        "directTarget": {
          "type": "string",
          "description": "The name of the target project this request is sending to directly."
        },
        "language": {
          "type": "string",
          "description": "The language to use in this request. This will be the language setting when communicating with all other target projects."
        },
        "verbose": {
          "type": "boolean",
          "description": "If true, the service will return more detailed information in the response."
        },
        "isLoggingEnabled": {
          "description": "If true, the query will be kept by the service for customers to further review, to improve the model quality.",
          "type": "boolean"
        },
        "parameters": {
          "type": "object",
          "description": "A dictionary representing the input for each target project.",
          "additionalProperties": {
            "$ref": "#/definitions/AnalyzeParameters"
          }
        }
      }
    },
    "AnalyzeParameters": {
      "type": "object",
      "description": "This is the parameter set of either the conversation application itself or one of the target services.",
      "required": [
        "targetKind"
      ],
      "discriminator": "targetKind",
      "properties": {
        "targetKind": {
          "type": "string",
          "description": "The type of a target service.",
          "enum": [
            "luis",
            "luis_deepstack",
            "question_answering"
          ],
          "x-ms-enum": {
            "name": "targetKind",
            "modelAsString": true
          }
        },
        "apiVersion": {
          "type": "string",
          "description": "The API version to use when call a specific target service."
        }
      }
    },
    "LUISParameters": {
      "description": "This is a set of request parameters for LUIS Generally Available projects.",
      "x-ms-discriminator-value": "luis",
      "type": "object",
      "allOf": [
        {
          "$ref": "#/definitions/AnalyzeParameters"
        }
      ],
      "properties": {
        "query": {
          "type": "string",
          "maxLength": 500,
          "description": "The utterance to predict."
        },
        "callingOptions": {
          "type": "object",
          "description": "This customizes how the service calls LUIS Generally Available projects.",
          "$ref": "#/definitions/LUISCallingOptions"
        }
      },
      "additionalProperties": true
    },
    "LUISCallingOptions": {
      "description": "This customizes how the service calls LUIS Generally Available projects.",
      "type": "object",
      "properties": {
        "verbose": {
          "description": "Enable verbose response.",
          "type": "boolean"
        },
        "log": {
          "description": "Save log to add in training utterances later.",
          "type": "boolean"
        },
        "show-all-intents": {
          "description": "Set true to show all intents.",
          "type": "boolean"
        },
        "timezoneOffset": {
          "type": "number",
          "description": "The timezone offset for the location of the request."
        },
        "spellCheck": {
          "type": "boolean",
          "description": "Enable spell checking."
        },
        "bing-spell-check-subscription-key": {
          "description": "The subscription key to use when enabling Bing spell check",
          "type": "string"
        }
      }
    },
    "DeepstackParameters": {
      "type": "object",
      "description": "This is a set of request parameters for LUIS Deepstack projects.",
      "x-ms-discriminator-value": "luis_deepstack",
      "allOf": [
        {
          "$ref": "#/definitions/AnalyzeParameters"
        }
      ],
      "properties": {
        "callingOptions": {
          "type": "object",
          "$ref": "#/definitions/DeepstackCallingOptions"
        }
      }
    },
    "DeepstackCallingOptions": {
      "type": "object",
      "description": "The option to set to call a LUIS Deepstack project.",
      "properties": {
        "language": {
          "description": "The language of the query.",
          "type": "string"
        },
        "verbose": {
          "description": "If true, the service will return more detailed information.",
          "type": "boolean"
        },
        "isLoggingEnabled": {
          "description": "If true, the query will be saved for customers to further review in authoring, to improve the model quality.",
          "type": "boolean"
        }
      }
    },
    "QuestionAnsweringParameters": {
      "type": "object",
      "description": "This is a set of request parameters for Question Answering knowledge bases.",
      "x-ms-discriminator-value": "question_answering",
      "allOf": [
        {
          "$ref": "#/definitions/AnalyzeParameters"
        }
      ],
      "properties": {
        "projectParameters": {
          "type": "object",
          "description": "The parameters send to a Question Answering KB."
        }
      }
    },
    "ConversationAnalysisResult": {
      "type": "object",
      "description": "Represents a conversation analysis response.",
      "required": [
        "query",
        "prediction"
      ],
      "properties": {
        "query": {
          "type": "string",
          "description": "The conversation utterance given by the caller."
        },
        "detectedLanguage": {
          "type": "string",
          "description": "The system detected language for the query."
        },
        "prediction": {
          "description": "The prediction result of a conversation project.",
          "$ref": "#/definitions/BasePrediction"
        }
      }
    },
    "BasePrediction": {
      "type": "object",
      "description": "This is the base class of prediction",
      "required": [
        "projectKind"
      ],
      "discriminator": "projectKind",
      "properties": {
        "projectKind": {
          "type": "string",
          "description": "The type of the project.",
          "enum": [
            "conversation",
            "workflow"
          ],
          "x-ms-enum": {
            "name": "projectKind",
            "modelAsString": true
          }
        },
        "topIntent": {
          "type": "string",
          "description": "The intent with the highest score."
        }
      }
    },
    "WorkflowPrediction": {
      "type": "object",
      "description": "This represents the prediction result of an Workflow project.",
      "x-ms-discriminator-value": "workflow",
      "required": [
        "intents"
      ],
      "allOf": [
        {
          "$ref": "#/definitions/BasePrediction"
        }
      ],
      "properties": {
        "intents": {
          "description": "A dictionary that contains all intents. A key is an intent name and a value is its confidence score and target type. The top intent's value also contains the actual response from the target project.",
          "type": "object",
          "additionalProperties": {
            "$ref": "#/definitions/TargetIntentResult"
          }
        }
      }
    },
    "TargetIntentResult": {
      "type": "object",
      "description": "This is the base class of an intent prediction",
      "discriminator": "targetKind",
      "required": [
        "confidenceScore",
        "targetKind"
      ],
      "properties": {
        "targetKind": {
          "type": "string",
          "description": "This discriminator property specifies the type of the target project that returns the response. 'luis' means the type is LUIS Generally Available. 'luis_deepstack' means LUIS vNext. 'question_answering' means Question Answering.",
          "enum": [
            "luis",
            "luis_deepstack",
            "question_answering"
          ],
          "x-ms-enum": {
            "name": "targetKind",
            "modelAsString": true
          }
        },
        "apiVersion": {
          "type": "string",
          "description": "The API version used to call a target service."
        },
        "confidenceScore": {
          "type": "number",
          "format": "double",
          "description": "The prediction score and it ranges from 0.0 to 1.0.",
          "minimum": 0,
          "maximum": 1
        }
      }
    },
    "DSTargetIntentResult": {
      "type": "object",
      "description": "A wrap up of LUIS Deepstack response.",
      "x-ms-discriminator-value": "luis_deepstack",
      "allOf": [
        {
          "$ref": "#/definitions/TargetIntentResult"
        }
      ],
      "properties": {
        "result": {
          "type": "object",
          "$ref": "#/definitions/DeepstackResult",
          "description": "The actual response from a LUIS Deepstack application.",
          "x-nullable": true
        }
      }
    },
    "DeepstackResult": {
      "type": "object",
      "description": "The response returned by a LUIS Deepstack project.",
      "required": [
        "query",
        "prediction"
      ],
      "properties": {
        "query": {
          "description": "The same query given in request.",
          "type": "string"
        },
        "detectedLanguage": {
          "description": "The detected language from the query.",
          "type": "string"
        },
        "prediction": {
          "description": "The predicted result for the query.",
          "$ref": "#/definitions/DeepstackPrediction"
        }
      }
    },
    "DeepstackPrediction": {
      "type": "object",
      "description": "Represents the prediction section of a LUIS Deepstack project.",
      "x-ms-discriminator-value": "conversation",
      "required": [
        "classifications",
        "entities"
      ],
      "allOf": [
        {
          "$ref": "#/definitions/BasePrediction"
        }
      ],
      "properties": {
        "classifications": {
          "description": "The classification results.",
          "type": "array",
          "items": {
            "$ref": "#/definitions/DeepstackClassification"
          }
        },
        "entities": {
          "description": "The entity extraction results.",
          "type": "array",
          "items": {
            "$ref": "#/definitions/DeepstackEntity"
          }
        }
      }
    },
    "DeepstackClassification": {
      "type": "object",
      "description": "The classification result of a LUIS Deepstack project.",
      "required": [
        "category",
        "confidenceScore"
      ],
      "properties": {
        "category": {
          "description": "A predicted class.",
          "type": "string"
        },
        "confidenceScore": {
          "format": "float",
          "description": "The confidence score of the class from 0.0 to 1.0.",
          "type": "number",
          "minimum": 0,
          "maximum": 1
        }
      }
    },
    "DeepStackEntityResolution": {
      "type": "object",
      "description": "This is the base class of all kinds of entity resolutions.",
      "required": [
        "resolutionKind"
      ],
      "properties": {
        "resolutionKind": {
          "type": "string",
          "description": "The type of an entity resolution.",
          "enum": [
            "DictionaryNormalizedValue"
          ],
          "x-ms-enum": {
            "name": "resolutionKind",
            "modelAsString": true,
            "values": [
              {
                "value": "DictionaryNormalizedValue",
                "description": "Dictionary normalized entities."
              }
            ]
          }
        }
      },
      "additionalProperties": true
    },
    "DictionaryNormalizedValueResolution": {
      "type": "object",
      "description": "The DictionaryNormalizedValue resolution indicates entity values are extracted from a predefined dictionary. For example, Coca could be a normalized name for Coca-Cola.",
      "x-ms-discriminator-value": "DictionaryNormalizedValue",
      "allOf": [
        {
          "$ref": "#/definitions/DeepStackEntityResolution"
        }
      ],
      "properties": {
        "values": {
          "type": "array",
          "description": "A list of normalized entities.",
          "x-nullable": false,
          "items": {
            "type": "string",
            "x-nullable": false
          }
        }
      }
    },
    "DeepstackEntity": {
      "type": "object",
      "description": "The entity extraction result of a LUIS Deepstack project.",
      "required": [
        "category",
        "text",
        "offset",
        "length",
        "confidenceScore"
      ],
      "properties": {
        "category": {
          "description": "The entity category.",
          "type": "string"
        },
        "text": {
          "description": "The predicted entity text.",
          "type": "string"
        },
        "offset": {
          "format": "int32",
          "description": "The starting index of this entity in the query.",
          "type": "integer"
        },
        "length": {
          "format": "int32",
          "description": "The length of the text.",
          "type": "integer"
        },
        "confidenceScore": {
          "format": "float",
          "description": "The entity confidence score.",
          "type": "number"
        },
        "resolution": {
          "description": "A array with extra information about the entity.",
          "type": "array",
          "items": {
            "$ref": "#/definitions/DeepStackEntityResolution"
          }
        }
      }
    },
    "LUISTargetIntentResult": {
      "type": "object",
      "description": "It is a wrap up of LUIS Generally Available response.",
      "x-ms-discriminator-value": "luis",
      "allOf": [
        {
          "$ref": "#/definitions/TargetIntentResult"
        }
      ],
      "properties": {
        "result": {
          "type": "object",
          "description": "The actual response from a LUIS Generally Available application.",
          "x-nullable": true
        }
      }
    },
    "QuestionAnsweringTargetIntentResult": {
      "type": "object",
      "description": "It is a wrap up a Question Answering KB response.",
      "x-ms-discriminator-value": "question_answering",
      "allOf": [
        {
          "$ref": "#/definitions/TargetIntentResult"
        }
      ],
      "properties": {
        "result": {
          "type": "object",
          "description": "The generated answer by a Question Answering KB.",
          "x-nullable": true
        }
      }
    }
  },
  "parameters": {
    "ConversationAnalysisInput": {
      "name": "ConversationAnalysisInput",
      "in": "body",
      "required": true,
      "schema": {
        "$ref": "#/definitions/ConversationAnalysisInput"
      },
      "x-nullable": true,
      "description": "Post body of the request.",
      "x-ms-parameter-location": "method"
    }
  }
}
