{
   "swagger": "2.0",
   "info": {
      "title": "Purview Metadata Policies Service REST API Document",
      "version": "2020-12-01-preview"
   },
   "x-ms-parameterized-host": {
      "hostTemplate": "{Endpoint}",
      "useSchemePrefix": false,
      "parameters": [
         {
            "$ref": "#/parameters/Endpoint"
         }
      ]
   },
   "schemes": [
      "https"
   ],
   "consumes": [
      "application/json"
   ],
   "produces": [
      "application/json"
   ],
   "securityDefinitions": {
      "azure_auth": {
         "flow": "implicit",
         "authorizationUrl": "https://login.microsoftonline.com/common/oauth2/authorize",
         "scopes": {
            "user_impersonation": "impersonate your user account"
         },
         "type": "oauth2",
         "description": "Azure Active Directory OAuth2 Flow."
      }
   },
   "security": [
      {
         "azure_auth": [
            "user_impersonation"
         ]
      }
   ],
   "paths": {
      "/metadataPolicies/{policyId}": {
         "put": {
            "tags": [
               "AuthzAuthoring"
            ],
            "summary": "Updates a policy with unique policy id.",
            "operationId": "Update",
            "consumes": [
               "application/json",
               "text/json",
               "application/*+json"
            ],
            "produces": [
               "application/json"
            ],
            "parameters": [
               {
                  "in": "path",
                  "name": "policyId",
                  "description": "Unique policy id.",
                  "required": true,
                  "type": "string"
               },
               {
                  "in": "body",
                  "name": "body",
                  "description": "Policy object to be updated.",
                  "required": true,
                  "schema": {
                     "$ref": "#/definitions/AuthzPolicyViewModel"
                  }
               }
            ],
            "responses": {
               "200": {
                  "description": "Success",
                  "schema": {
                     "$ref": "#/definitions/AuthzPolicyViewModel"
                  }
               }
            }
         },
         "get": {
            "tags": [
               "AuthzAuthoring"
            ],
            "summary": "Get policy.",
            "operationId": "Get",
            "produces": [
               "application/json"
            ],
            "parameters": [
               {
                  "in": "path",
                  "name": "policyId",
                  "description": "Id of an existing policy that needs to be fetched.",
                  "required": true,
                  "type": "string"
               }
            ],
            "responses": {
               "200": {
                  "description": "Success",
                  "schema": {
                     "$ref": "#/definitions/AuthzPolicyViewModel"
                  }
               },
               "404": {
                  "description": "Not Found",
                  "schema": {
                     "$ref": "#/definitions/ErrorModel"
                  }
               },
               "400": {
                  "description": "Bad Request",
                  "schema": {
                     "$ref": "#/definitions/ErrorModel"
                  }
               }
            }
         }
      },
      "/metadataPolicies": {
         "get": {
            "tags": [
               "AuthzAuthoring"
            ],
            "summary": "Get all the policies.",
            "operationId": "GetAll",
            "produces": [
               "application/json"
            ],
            "parameters": [
               {
                  "in": "query",
                  "name": "skipToken",
                  "description": "Continuation token for the next page.",
                  "type": "string"
               }
            ],
            "responses": {
               "200": {
                  "description": "Success",
                  "schema": {
                     "$ref": "#/definitions/AuthzPolicyViewModelPagedResults"
                  }
               }
            }
         }
      },
      "/collections/{collectionName}/metadataPolicy": {
         "get": {
            "tags": [
               "AuthzAuthoring"
            ],
            "summary": "Get policy by collection name.",
            "operationId": "GetByCollection",
            "produces": [
               "application/json"
            ],
            "parameters": [
               {
                  "in": "path",
                  "name": "collectionName",
                  "description": "The name of an existing collection for which one policy needs to be fetched.",
                  "required": true,
                  "type": "string"
               }
            ],
            "responses": {
               "200": {
                  "description": "Success",
                  "schema": {
                     "$ref": "#/definitions/AuthzPolicyViewModel"
                  }
               },
               "404": {
                  "description": "Not Found",
                  "schema": {
                     "$ref": "#/definitions/ErrorModel"
                  }
               },
               "400": {
                  "description": "Bad Request",
                  "schema": {
                     "$ref": "#/definitions/ErrorModel"
                  }
               }
            }
         }
      },
      "/roles": {
         "get": {
            "tags": [
               "Roles"
            ],
            "summary": "The GetAll.",
            "operationId": "GetAllRoles",
            "produces": [
               "application/json"
            ],
            "parameters": [
               {
                  "in": "query",
                  "name": "category",
                  "description": "The role categorySystem.String.",
                  "type": "string"
               },
               {
                  "in": "query",
                  "name": "skipToken",
                  "description": "The skipTokenSystem.String.",
                  "type": "string"
               }
            ],
            "responses": {
               "200": {
                  "description": "Success",
                  "schema": {
                     "$ref": "#/definitions/RoleViewModelPagedResults"
                  }
               },
               "400": {
                  "description": "Bad Request",
                  "schema": {
                     "$ref": "#/definitions/ErrorModel"
                  }
               }
            }
         }
      }
   },
   "definitions": {
      "ErrorModel": {
         "type": "object",
         "properties": {
            "code": {
               "type": "string"
            },
            "message": {
               "type": "string"
            },
            "target": {
               "type": "string"
            },
            "details": {
               "type": "array",
               "items": {
                  "$ref": "#/definitions/ErrorModel"
               }
            }
         }
      },
      "AttributeMatcher": {
         "type": "object",
         "properties": {
            "fromRule": {
               "type": "string"
            },
            "attributeName": {
               "type": "string"
            },
            "attributeValueIncludes": {
               "type": "string"
            },
            "attributeValueIncludedIn": {
               "type": "array",
               "items": {
                  "type": "string"
               }
            },
            "attributeValueExcludes": {
               "type": "string"
            },
            "attributeValueExcludedIn": {
               "type": "array",
               "items": {
                  "type": "string"
               }
            },
            "matcherId": {
               "type": "string"
            },
            "matcherConfig": {
               "type": "object",
               "additionalProperties": {
                  "uniqueItems": true,
                  "type": "array",
                  "items": {
                     "type": "string"
                  }
               }
            }
         }
      },
      "DNFCondition": {
         "type": "object",
         "properties": {
            "attributes": {
               "type": "array",
               "items": {
                  "type": "array",
                  "items": {
                     "$ref": "#/definitions/AttributeMatcher"
                  }
               }
            }
         }
      },
      "CNFCondition": {
         "type": "object",
         "properties": {
            "attributes": {
               "type": "array",
               "items": {
                  "type": "array",
                  "items": {
                     "$ref": "#/definitions/AttributeMatcher"
                  }
               }
            }
         }
      },
      "DecisionRule": {
         "type": "object",
         "properties": {
            "kind": {
               "enum": [
                  "policyset",
                  "policy",
                  "attributerule",
                  "decisionrule"
               ],
               "type": "string",
               "readOnly": true
            },
            "effect": {
               "enum": [
                  "NotApplicable",
                  "Deny",
                  "Permit",
                  "Indeterminate"
               ],
               "type": "string"
            },
            "id": {
               "type": "string"
            },
            "name": {
               "type": "string"
            },
            "version": {
               "format": "int64",
               "type": "integer"
            },
            "updatedAt": {
               "type": "string"
            },
            "metadata": {
               "type": "object",
               "additionalProperties": {
                  "type": "string"
               }
            },
            "dnfCondition": {
               "$ref": "#/definitions/DNFCondition"
            },
            "cnfCondition": {
               "$ref": "#/definitions/CNFCondition"
            }
         }
      },
      "AttributeRule": {
         "type": "object",
         "properties": {
            "kind": {
               "enum": [
                  "policyset",
                  "policy",
                  "attributerule",
                  "decisionrule"
               ],
               "type": "string",
               "readOnly": true
            },
            "id": {
               "type": "string"
            },
            "name": {
               "type": "string"
            },
            "version": {
               "format": "int64",
               "type": "integer"
            },
            "updatedAt": {
               "type": "string"
            },
            "metadata": {
               "type": "object",
               "additionalProperties": {
                  "type": "string"
               }
            },
            "dnfCondition": {
               "$ref": "#/definitions/DNFCondition"
            },
            "cnfCondition": {
               "$ref": "#/definitions/CNFCondition"
            }
         }
      },
      "CollectionReference": {
         "type": "object",
         "properties": {
            "type": {
               "type": "string",
               "readOnly": true
            },
            "referenceName": {
               "type": "string"
            }
         }
      },
      "AuthzPolicyProperties": {
         "type": "object",
         "properties": {
            "description": {
               "type": "string"
            },
            "decisionRules": {
               "type": "array",
               "items": {
                  "$ref": "#/definitions/DecisionRule"
               }
            },
            "attributeRules": {
               "type": "array",
               "items": {
                  "$ref": "#/definitions/AttributeRule"
               }
            },
            "collection": {
               "$ref": "#/definitions/CollectionReference"
            },
            "parentCollectionName": {
               "type": "string"
            }
         },
         "example": {
            "name": "policy_root-collection",
            "id": "5688e3a0-8182-4da8-b810-6ca03d0ea406",
            "version": 0,
            "properties": {
               "description": "",
               "decisionRules": [
                  {
                     "kind": "decisionrule",
                     "effect": "Permit",
                     "cnfCondition": [
                        [
                           {
                              "fromRule": "permission:root-collection",
                              "attributeName": "derived.purview.permission",
                              "attributeValueIncludes": "permission:root-collection"
                           }
                        ],
                        [
                           {
                              "attributeName": "resource.purview.collection",
                              "attributeValueIncludes": "root-collection"
                           }
                        ]
                     ]
                  }
               ],
               "attributeRules": [
                  {
                     "kind": "attributerule",
                     "id": "permission:root-collection",
                     "name": "permission:root-collection",
                     "cnfCondition": [
                        [
                           {
                              "fromRule": "cd0784c6-92f8-479d-9214-4f025d758882:root-collection",
                              "attributeName": "derived.purview.permission",
                              "attributeValueIncludes": "cd0784c6-92f8-479d-9214-4f025d758882:root-collection"
                           }
                        ]
                     ]
                  },
                  {
                     "kind": "attributerule",
                     "id": "cd0784c6-92f8-479d-9214-4f025d758882:root-collection",
                     "name": "cd0784c6-92f8-479d-9214-4f025d758882:root-collection",
                     "dnfCondition": [
                        [
                           {
                              "attributeName": "principal.microsoft.id",
                              "attributeValueIncludedIn": [
                                 "some-user"
                              ]
                           },
                           {
                              "fromRule": "cd0784c6-92f8-479d-9214-4f025d758882",
                              "attributeName": "derived.purview.role",
                              "attributeValueIncludes": "cd0784c6-92f8-479d-9214-4f025d758882"
                           }
                        ]
                     ]
                  }
               ],
               "collection": {
                  "type": "CollectionReference",
                  "referenceName": "root-collection"
               }
            }
         }
      },
      "AuthzPolicyViewModel": {
         "type": "object",
         "properties": {
            "name": {
               "type": "string"
            },
            "id": {
               "type": "string"
            },
            "version": {
               "format": "int32",
               "type": "integer"
            },
            "properties": {
               "$ref": "#/definitions/AuthzPolicyProperties"
            }
         }
      },
      "AuthzPolicyViewModelPagedResults": {
         "required": [
            "values"
         ],
         "type": "object",
         "properties": {
            "values": {
               "type": "array",
               "items": {
                  "$ref": "#/definitions/AuthzPolicyViewModel"
               }
            },
            "nextLink": {
               "type": "string"
            },
            "count": {
               "format": "int32",
               "type": "integer"
            }
         }
      },
      "RolePropertiesModel": {
         "type": "object",
         "properties": {
            "provisioningState": {
               "type": "string"
            },
            "category": {
               "type": "string"
            },
            "roleType": {
               "type": "string"
            },
            "friendlyName": {
               "type": "string"
            },
            "description": {
               "type": "string"
            },
            "cnfCondition": {
               "$ref": "#/definitions/CNFCondition"
            },
            "dnfCondition": {
               "$ref": "#/definitions/DNFCondition"
            },
            "metadata": {
               "type": "object",
               "additionalProperties": {
                  "type": "string"
               }
            },
            "version": {
               "format": "int64",
               "type": "integer"
            }
         }
      },
      "RoleViewModel": {
         "type": "object",
         "properties": {
            "id": {
               "type": "string"
            },
            "name": {
               "type": "string"
            },
            "type": {
               "type": "string"
            },
            "properties": {
               "$ref": "#/definitions/RolePropertiesModel"
            }
         }
      },
      "RoleViewModelPagedResults": {
         "required": [
            "values"
         ],
         "type": "object",
         "properties": {
            "values": {
               "type": "array",
               "items": {
                  "$ref": "#/definitions/RoleViewModel"
               }
            },
            "nextLink": {
               "type": "string"
            },
            "count": {
               "format": "int32",
               "type": "integer"
            }
         }
      }
   },
   "parameters": {
      "Endpoint": {
         "name": "Endpoint",
         "description": "The policy endpoint of your Purview account. Example: https://{accountName}.purview.azure.com/policystore",
         "x-ms-parameter-location": "client",
         "required": true,
         "type": "string",
         "in": "path",
         "x-ms-skip-url-encoding": true
      }
   }
}