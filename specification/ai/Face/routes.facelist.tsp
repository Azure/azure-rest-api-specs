import "@typespec/http";
import "@typespec/rest";
import "@azure-tools/typespec-azure-core";
import "./models.facelist.tsp";

using TypeSpec.Http;
using TypeSpec.Rest;
using Azure.Core;
using Azure.Core.Traits;
using Foundations;

namespace Face;

alias AddFaceListFaceSummary = "Add a face to a specified face list, up to 1,000 faces.";
alias AddFaceListFaceDescription = """
  To deal with an image containing multiple faces, input face can be specified as an image with a targetFace rectangle. It returns a persistedFaceId representing the added face. No image will be stored. Only the extracted face feature(s) will be stored on server until FaceList - Delete Face or FaceList - Delete is called.

  Note that persistedFaceId is different from faceId generated by Face - Detect.
  ${AddFaceDescriptionInList}
  """;
alias AddLargeFaceListFaceSummary = "Add a face to a specified large face list, up to 1,000,000 faces.";
alias AddLargeFaceListFaceDescription = """
  To deal with an image containing multiple faces, input face can be specified as an image with a targetFace rectangle. It returns a persistedFaceId representing the added face. No image will be stored. Only the extracted face feature(s) will be stored on server until LargeFaceList - Delete Face or LargeFaceList - Delete is called.

  Note that persistedFaceId is different from faceId generated by Face - Detect.
  ${AddFaceDescriptionInList}

  > [!NOTE]
  >
  > *
  >   * Free-tier subscription quota: 1,000 faces per large face list.
  >   * S0-tier subscription quota: 1,000,000 faces per large face list.
  """;

interface FaceListOperations {
  @summary("Create an empty face list with user-specified faceListId, name, an optional userData and recognitionModel.")
  @doc("""
    Up to 64 face lists are allowed in one subscription.

    Face list is a list of faces, up to 1,000 faces, and used by Face - Find Similar.

    After creation, user should use FaceList - Add Face to import the faces. No image will be stored. Only the extracted face feature(s) will be stored on server until FaceList - Delete is called.

    Find Similar is used for scenario like finding celebrity-like faces, similar face filtering, or as a light way face identification. But if the actual use is to identify person, please use PersonGroup / LargePersonGroup and Face - Identify.

    Please consider LargeFaceList when the face number is large. It can support up to 1,000,000 faces.
    """)
  @returnsDoc(SuccessfulCallWithEmptyBody)
  createFaceList is FaceCollectionResourceCreateOperation<FaceList>;

  @doc("Delete a specified face list.")
  @returnsDoc(SuccessfulCallWithEmptyBody)
  deleteFaceList is FaceResourceDeleteOperation<FaceList>;

  @doc("Retrieve a face list's faceListId, name, userData, recognitionModel and faces in the face list.")
  @returnsDoc("A successful call returns the face list's information.")
  getFaceList is FaceResourceReadOperationWithReturnRecognitionModelOptions<FaceList>;

  @doc("Update information of a face list, including name and userData.")
  @returnsDoc(SuccessfulCallWithEmptyBody)
  updateFaceList is FaceResourceUpdateOperation<FaceList>;

  @doc("""
    List face lists' faceListId, name, userData and recognitionModel.

    To get face information inside faceList use Get Face List.
    """)
  @returnsDoc("A successful call returns an array of faceList.")
  getFaceLists is Foundations.ResourceList<
    FaceList,
    ReturnRecognitionModelOptions,
    Body<FaceListItem[]>,
    ServiceTraits,
    FaceErrorResponse
  >;

  @summary(AddFaceListFaceSummary)
  @doc(AddFaceListFaceDescription)
  @returnsDoc(AddFaceSuccess)
  addFaceListFaceFromUrl is AddFaceFromUrl<FaceListFace>;

  #suppress "@azure-tools/typespec-azure-core/byos" "It's an RPC call to detect face from an image, it doesn't store anything. There's a BYOS version of this call, but it's not this one."
  @summary(AddFaceListFaceSummary)
  @doc(AddFaceListFaceDescription)
  @returnsDoc(AddFaceSuccess)
  addFaceListFace is AddFace<FaceListFace>;

  @summary("Delete a face from a face list by specified faceListId and persistedFaceId.")
  @doc("Adding/deleting faces to/from a same face list are processed sequentially and to/from different face lists are in parallel.")
  @returnsDoc(SuccessfulCallWithEmptyBody)
  deleteFaceListFace is FaceResourceDeleteOperation<FaceListFace>;

  @summary("Create an empty large face list with user-specified largeFaceListId, name, an optional userData and recognitionModel.")
  @doc("""
    Large face list is a list of faces, up to 1,000,000 faces, and used by Find Similar.

    After creation, user should use Add Large Face List Face to import the faces and Train Large Face List to make it ready for Find Similar. No image will be stored. Only the extracted face feature(s) will be stored on server until Delete Large Face List is called.

    Find Similar is used for scenario like finding celebrity-like faces, similar face filtering, or as a light way face identification. But if the actual use is to identify person, please use Person Group / Large Person Group and Identify.

    > [!NOTE]
    >
    > *
    >   * Free-tier subscription quota: 64 large face lists.
    >   * S0-tier subscription quota: 1,000,000 large face lists.
    """)
  @returnsDoc(SuccessfulCallWithEmptyBody)
  createLargeFaceList is FaceCollectionResourceCreateOperation<LargeFaceList>;

  @summary("Delete a face from a large face list by specified largeFaceListId and persistedFaceId.")
  @doc("Adding/deleting faces to/from a same large face list are processed sequentially and to/from different large face lists are in parallel.")
  @returnsDoc(SuccessfulCallWithEmptyBody)
  deleteLargeFaceList is FaceResourceDeleteOperation<LargeFaceList>;

  @doc("Retrieve a large face list's largeFaceListId, name, userData and recognitionModel.")
  @returnsDoc("A successful call returns the large face list's information.")
  getLargeFaceList is FaceResourceReadOperationWithReturnRecognitionModelOptions<LargeFaceList>;

  @doc("Update information of a large face list, including name and userData.")
  @returnsDoc(SuccessfulCallWithEmptyBody)
  updateLargeFaceList is FaceResourceUpdateOperation<LargeFaceList>;

  @summary("List large face lists' information of largeFaceListId, name, userData and recognitionModel.")
  @doc(
    """
    To get face information inside largeFaceList use LargeFaceList Face - Get.

    Large face lists are stored in alphabetical order of largeFaceListId.
    ${ListRequestOptionsDescriptionInList}
    """
  )
  @returnsDoc("A successful call returns an array of large face lists and their information (largeFaceListId, name and userData).")
  getLargeFaceLists is FaceResourceListOperation<
    LargeFaceList,
    LargeFaceList,
    ReturnRecognitionModelOptions
  >;

  @doc("""
    To check the large face list training status completed or still ongoing. LargeFaceList Training is an asynchronous operation triggered by Train Large Face List.

    Training time depends on the number of face entries in a large face list. It could be in seconds, or up to half an hour for 1,000,000 faces.
    """)
  @returnsDoc("A successful call returns the large face list's training status.")
  getLargeFaceListTrainingStatus is FaceResourceGetTrainingStatus<LargeFaceList>;

  @summary("Submit a large face list training task.")
  @doc("""

    Training is a crucial step that only a trained large face list can be used by Find Similar.

    The training task is an asynchronous task. Training time depends on the number of face entries in a large face list. It could be in seconds, or up to half an hour for 1,000,000 faces. To check training completion, please use Get Large Face List Training Status.
    """)
  @returnsDoc(SuccessfulCallWithEmptyBody)
  @pollingOperation(FaceListOperations.getLargeFaceListTrainingStatus)
  trainLargeFaceList is FaceResourceTrain<LargeFaceList>;

  @summary(AddLargeFaceListFaceSummary)
  @doc(AddLargeFaceListFaceDescription)
  @returnsDoc(AddFaceSuccess)
  addLargeFaceListFaceFromUrl is AddFaceFromUrl<LargeFaceListFace>;

  #suppress "@azure-tools/typespec-azure-core/byos" "It's an RPC call to detect face from an image, it doesn't store anything. There's a BYOS version of this call, but it's not this one."
  @summary(AddLargeFaceListFaceSummary)
  @doc(AddLargeFaceListFaceDescription)
  @returnsDoc(AddFaceSuccess)
  addLargeFaceListFace is AddFace<LargeFaceListFace>;

  @doc("Delete a face from a large face list by specified largeFaceListId and persistedFaceId.")
  @returnsDoc(SuccessfulCallWithEmptyBody)
  deleteLargeFaceListFace is FaceResourceDeleteOperation<LargeFaceListFace>;

  @doc("Retrieve persisted face in large face list by largeFaceListId and persistedFaceId.")
  @returnsDoc("A successful call returns target persisted face's information (persistedFaceId and userData).")
  getLargeFaceListFace is FaceResourceReadOperation<LargeFaceListFace>;

  @doc("Update a specified face's userData field in a large face list by its persistedFaceId.")
  @returnsDoc(SuccessfulCallWithEmptyBody)
  updateLargeFaceListFace is FaceResourceUpdateOperation<
    LargeFaceListFace,
    FaceUserData
  >;

  @summary("List faces' persistedFaceId and userData in a specified large face list.")
  @doc(
    """
    Faces are stored in alphabetical order of persistedFaceId created in LargeFaceList Face - Add.
    ${ListRequestOptionsDescriptionInList}
    """
  )
  @returnsDoc("A successful call returns an array of persisted faces and their information (persistedFaceId and userData).")
  getLargeFaceListFaces is FaceResourceListOperation<LargeFaceListFace>;
}
