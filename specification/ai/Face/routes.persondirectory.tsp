import "@typespec/http";
import "@typespec/rest";
import "@azure-tools/typespec-azure-core";
import "./models.persondirectory.tsp";

using TypeSpec.Http;
using TypeSpec.Rest;
using Azure.Core;
using Azure.Core.Traits;
using Foundations;

namespace Face;

#suppress "@azure-tools/typespec-azure-core/use-standard-operations" "Doesn't fit standard ops"
#suppress "@azure-tools/typespec-azure-core/long-running-polling-operation-required" "Doesn't fit in generated long-running operation"
@summary("Add a face to a person (see PersonDirectory Person - Create) for face identification or verification.")
@doc(
  """
To deal with an image containing multiple faces, input face can be specified as an image with a targetFace rectangle. It returns a persistedFaceId representing the added face. No image will be stored. Only the extracted face feature(s) will be stored on server until PersonDirectory Person - Delete Face or PersonDirectory Person - Delete is called.
Note persistedFaceId is different from faceId generated by Face - Detect.

${AddFaceDescription}
* Adding/deleting faces to/from a same person will be processed sequentially. Adding/deleting faces to/from different persons are processed in parallel.
* This is a long running operation. Use Response Header "Operation-Location" to determine when the AddFace operation has successfully propagated for future requests to Face - Identify. For further information about Operation-Locations see Operations - Get Status.
"""
)
@returnsDoc(PersonModificationAccepted)
@sharedRoute
@createsResource(PersonDirectoryFace)
op AddPersonFaceOperation<T extends TypeSpec.Reflection.Model> is Foundations.ResourceCollectionOperation<
  PersonDirectoryFace,
  AddFaceOptions & T,
  AddFaceResult &
    TypeSpec.Http.AcceptedResponse & {
      @header("operation-Location")
      operationLocation: ResourceLocation<FaceOperationStatus>;

      @header("Location")
      location: ResourceLocation<PersonDirectoryPerson>;
    },
  ServiceTraits
>;

@pollingOperation(getFaceOperationStatus)
@deletesResource(TResource)
op FaceResourceDeleteLongRunningOperation<TResource extends TypeSpec.Reflection.Model> is Foundations.ResourceOperation<
  TResource,
  {},
  TypeSpec.Http.AcceptedResponse & {
    @pollingLocation
    @header("operation-Location")
    operationLocation: ResourceLocation<FaceOperationStatus>;
  },
  ServiceTraits
>;

#suppress "@azure-tools/typespec-azure-core/long-running-polling-operation-required" "Doesn't fit in generated long-running operation"
op DynamicPersonGroupLongRunningOperation<TParams extends TypeSpec.Reflection.Model> is Foundations.ResourceOperation<
  DynamicPersonGroup,
  Foundations.ResourceBody<TParams>,
  TypeSpec.Http.OkResponse | Foundations.AcceptedResponse<{
    @header("operation-Location")
    operationLocation: ResourceLocation<FaceOperationStatus>;
  }>,
  ServiceTraits
>;

@doc("Get status of a long running operation.")
op getFaceOperationStatus is Operations.ResourceRead<FaceOperationStatus>;

alias PersonModificationAccepted = "A successful call returns an empty response body. The service has accepted the request and will start processing soon. The client can query the operation status and result using the URL specified in the 'Operation-Location' response header. The URL expires in 48 hours.";
alias DynamicPersonGroupModificationAccepted = "A successful call returns an empty response body. The service has accepted the request and will start processing soon. The client can query the operation status and result using the URL specified in the 'Operation-Location' response header. The URL expires in 48 hours. The URL provides the status of when PersonDirectory Person - List DynamicPersonGroup References will return the changes made in this request.";
interface PersonDirectoryOperations {
  #suppress "@azure-tools/typespec-azure-core/use-standard-operations" "Doesn't fit standard ops"
  #suppress "@azure-tools/typespec-azure-core/long-running-polling-operation-required" "Doesn't fit in generated long-running operation"
  @doc("Creates a new person in a person directory. To add face to this person, please call PersonDirectory Person - Add Face.")
  @returnsDoc(PersonModificationAccepted)
  @createsResource(PersonDirectoryPerson)
  createPerson is Foundations.ResourceCollectionOperation<
    PersonDirectoryPerson,
    Foundations.ResourceBody<PersonDirectoryPerson>,
    CreatePersonResult &
      TypeSpec.Http.AcceptedResponse & {
        @header("operation-Location")
        operationLocation: ResourceLocation<FaceOperationStatus>;

        @header("Location")
        location: ResourceLocation<PersonDirectoryPerson>;
      },
    ServiceTraits
  >;

  #suppress "@azure-tools/typespec-azure-core/use-standard-operations" "Doesn't fit standard ops"
  @doc("Delete an existing person from person directory. The persistedFaceId(s), userData, person name and face feature(s) in the person entry will all be deleted.")
  @returnsDoc(PersonModificationAccepted)
  deletePerson is FaceResourceDeleteLongRunningOperation<PersonDirectoryPerson>;

  @doc("Retrieve a person's name and userData from person directory.")
  getPerson is Operations.ResourceRead<PersonDirectoryPerson>;

  #suppress "@azure-tools/typespec-azure-core/use-standard-operations" "Doesn't fit standard ops"
  @doc("Update name or userData of a person.")
  updatePerson is FaceResourceUpdateOperation<PersonDirectoryPerson>;

  #suppress "@azure-tools/typespec-azure-core/use-standard-operations" "Doesn't fit standard ops"
  @doc(
    """
  * Persons are stored in alphabetical order of personId created in PersonDirectory Person - Create.
  ${ListRequestOptionsDescription}
  """
  )
  @summary("List all persons' information in person directory, including personId, name, and userData.")
  getPersons is FaceResourceListOperation<PersonDirectoryPerson>;

  #suppress "@azure-tools/typespec-azure-core/use-standard-operations" "Doesn't fit standard ops"
  @summary("List all dynamic person groups a person has been referenced by in person directory.")
  @doc(
    """ 
  * Dynamic person groups are stored in alphabetical order of dynamic person group id created in PersonDirectory DynamicPersonGroup - Create.
  ${ListRequestOptionsDescription}
  """
  )
  @get
  @action("dynamicPersonGroupReferences")
  @actionSeparator("/")
  getDynamicPersonGroupReferences is Foundations.ResourceOperation<
    PersonDirectoryPerson,
    ListRequestOptions,
    ListGroupReferenceResult,
    ServiceTraits
  >;

  #suppress "@azure-tools/typespec-azure-core/byos" "It's an RPC call to detect face from an image, it doesn't store anything. There's a BYOS version of this call, but it's not this one."
  #suppress "@azure-tools/typespec-azure-core/use-standard-operations" "Doesn't fit standard ops"
  #suppress "@azure-tools/typespec-azure-core/long-running-polling-operation-required" "Doesn't fit in generated long-running operation"
  addPersonFace is AddPersonFaceOperation<{
    @doc("The format of the HTTP payload.")
    @header
    contentType: "application/octet-stream";

    @doc("The image to be analyzed")
    @body
    imageContent: bytes;
  }>;

  #suppress "@azure-tools/typespec-azure-core/byos" "It's an RPC call to detect face from an image, it doesn't store anything. There's a BYOS version of this call, but it's not this one."
  #suppress "@azure-tools/typespec-azure-core/use-standard-operations" "Doesn't fit standard ops"
  #suppress "@azure-tools/typespec-azure-core/long-running-polling-operation-required" "Doesn't fit in generated long-running operation"
  addPersonFaceFromUrl is AddPersonFaceOperation<{
    @doc("URL of input image.")
    url: url;
  }>;

  #suppress "@azure-tools/typespec-azure-core/use-standard-operations" "Doesn't fit standard ops"
  @summary("Delete a face from a person in person directory by specified personId and persistedFaceId.")
  @doc("""
  Adding/deleting faces to/from a same person will be processed sequentially. Adding/deleting faces to/from different persons are processed in parallel.
  """)
  @returnsDoc(PersonModificationAccepted)
  deletePersonFace is FaceResourceDeleteLongRunningOperation<PersonDirectoryFace>;

  @doc("""
  Retrieve person face information. The persisted person face is specified by its personId. recognitionModel, and persistedFaceId.
  """)
  getPersonFace is Operations.ResourceRead<PersonDirectoryFace>;

  #suppress "@azure-tools/typespec-azure-core/use-standard-operations" "Doesn't fit standard ops"
  @doc("""
  Update a person persisted face's userData field.
  """)
  @updatesResource(PersonDirectoryFace)
  updatePersonFace is FaceResourceUpdateOperation<
    PersonDirectoryFace,
    Foundations.ResourceBody<PersonDirectoryFace>
  >;

  #suppress "@azure-tools/typespec-azure-core/use-standard-operations" "Doesn't fit standard ops"
  @doc("""
  Retrieve a person's persistedFaceIds representing the registered person face feature(s).
  """)
  getPersonFaces is Foundations.ResourceList<
    PersonDirectoryFace,
    {},
    ListFaceResult,
    ServiceTraits
  >;

  #suppress "@azure-tools/typespec-azure-core/use-standard-operations" "Doesn't fit standard ops"
  #suppress "@azure-tools/typespec-azure-core/long-running-polling-operation-required" "Doesn't fit in generated long-running operation"
  @summary("Creates a new dynamic person group with specified dynamicPersonGroupId, name, and user-provided userData.")
  @doc("""
  A dynamic person group is a container that references PersonDirectory Person - Create. After creation, use PersonDirectory DynamicPersonGroup - Update to add or remove persons into the dynamic person group. DynamicPersonGroup and UserData will be stored on server until PersonDirectory DynamicPersonGroup - Delete is called. Use Face - Identify with the dynamicPersonGroupId parameter to identify against persons.
  No image will be stored. Only the person's extracted face feature(s) and userData will be stored on server until PersonDirectory Person - Delete or PersonDirectory Person - Delete Face is called.

  'recognitionModel' does not need to be specified with dynamic person groups. Dynamic person groups are references to PersonDirectory Person - Create and therefore work with most all 'recognitionModels'. The faceId's provided during Face - Identify determine the 'recognitionModel' used.
  """)
  @returnsDoc(DynamicPersonGroupModificationAccepted)
  @put
  createDynamicPersonGroup is DynamicPersonGroupLongRunningOperation<CreateDynamicPersonGroupContent>;

  #suppress "@azure-tools/typespec-azure-core/use-standard-operations" "Doesn't fit standard ops"
  @summary("Deletes an existing dynamic person group with specified dynamicPersonGroupId.")
  @doc("""
  Deleting this dynamic person group only delete the references to persons data. To delete actual person see PersonDirectory Person - Delete.
  """)
  @returnsDoc(DynamicPersonGroupModificationAccepted)
  deleteDynamicPersonGroup is FaceResourceDeleteLongRunningOperation<DynamicPersonGroup>;

  @doc("""
  This API returns dynamic person group information only, use PersonDirectory DynamicPersonGroup - List Persons instead to retrieve person information under the dynamic person group.
  """)
  @summary("Retrieve the information of a dynamic person group, including its name and userData.")
  @returnsDoc("A successful call returns the dynamic person group's information.")
  getDynamicPersonGroup is Operations.ResourceRead<DynamicPersonGroup>;

  #suppress "@azure-tools/typespec-azure-core/use-standard-operations" "Doesn't fit standard ops"
  #suppress "@azure-tools/typespec-azure-core/long-running-polling-operation-required" "Doesn't fit in generated long-running operation"
  @summary("Update an existing dynamic person group name, userData, add, or remove persons.")
  @doc("""
  The properties keep unchanged if they are not in request body.
  """)
  @returnsDoc(DynamicPersonGroupModificationAccepted)
  @patch
  updateDynamicPersonGroup is DynamicPersonGroupLongRunningOperation<UpdateDynamicPersonGroupContent>;

  #suppress "@azure-tools/typespec-azure-core/use-standard-operations" "Doesn't fit standard ops"
  @summary("List all existing dynamic person groups by dynamicPersonGroupId along with name and userData.")
  @doc(
    """
  * Dynamic person groups are stored in alphabetical order of dynamicPersonGroupId.
  ${ListRequestOptionsDescription}
  """
  )
  getDynamicPersonGroups is FaceResourceListOperation<DynamicPersonGroup>;

  #suppress "@azure-tools/typespec-azure-core/use-standard-operations" "Doesn't fit standard ops"
  @summary("List all persons in the specified dynamic person group.")
  @doc(
    """
  * Persons are stored in alphabetical order of personId created in PersonDirectory Person - Create.
  ${ListRequestOptionsDescription}
  """
  )
  @get
  @action("persons")
  @actionSeparator("/")
  getDynamicPersonGroupPersons is Foundations.ResourceOperation<
    DynamicPersonGroup,
    ListRequestOptions,
    ListPersonResult,
    ServiceTraits
  >;
}
