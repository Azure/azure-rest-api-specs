/** Describes the schema of the Azure Container Registry events published to Azure Event Grid. This corresponds to the Data property of an EventGridEvent. */
namespace Microsoft.EventGrid.SystemEvents;

/** Schema of the Data property of an EventGridEvent for a Microsoft.ContainerRegistry.ImagePushed event. */
#suppress "@azure-tools/typespec-azure-core/composition-over-inheritance" "Maintain compatibility with existing models."
model ContainerRegistryImagePushedEventData
  extends ContainerRegistryEventData {}

/** Schema of the Data property of an EventGridEvent for a Microsoft.ContainerRegistry.ImageDeleted event. */
#suppress "@azure-tools/typespec-azure-core/composition-over-inheritance" "Maintain compatibility with existing models."
model ContainerRegistryImageDeletedEventData
  extends ContainerRegistryEventData {}

/** Schema of the Data property of an EventGridEvent for a Microsoft.ContainerRegistry.ChartPushed event. */
#suppress "@azure-tools/typespec-azure-core/composition-over-inheritance" "Maintain compatibility with existing models."
model ContainerRegistryChartPushedEventData
  extends ContainerRegistryArtifactEventData {}

/** Schema of the Data property of an EventGridEvent for a Microsoft.ContainerRegistry.ChartDeleted event. */
#suppress "@azure-tools/typespec-azure-core/composition-over-inheritance" "Maintain compatibility with existing models."
model ContainerRegistryChartDeletedEventData
  extends ContainerRegistryArtifactEventData {}

alias ContainerRegistryBaseEventData = {
  /** The event ID. */
  id?: string;

  /** The time at which the event occurred. */
  timestamp: utcDateTime;

  /** The action that encompasses the provided event. */
  action?: string;

  /** The location of the event. */
  location?: string;
};

/** The content of the event request message. */
model ContainerRegistryEventData {
  ...ContainerRegistryBaseEventData;

  /** The target of the event. */
  target: ContainerRegistryEventTarget;

  /** The request that generated the event. */
  request: ContainerRegistryEventRequest;

  /** The agent that initiated the event. For most situations, this could be from the authorization context of the request. */
  actor: ContainerRegistryEventActor;

  /** The registry node that generated the event. Put differently, while the actor initiates the event, the source generates it. */
  source: ContainerRegistryEventSource;

  /** The connected registry information if the event is generated by a connected registry. */
  connectedRegistry: ContainerRegistryEventConnectedRegistry;
}

/** The content of the event request message. */
model ContainerRegistryArtifactEventData {
  ...ContainerRegistryBaseEventData;

  /** The target of the event. */
  target: ContainerRegistryArtifactEventTarget;

  /** The connected registry information if the event is generated by a connected registry. */
  connectedRegistry: ContainerRegistryEventConnectedRegistry;
}

/** The target of the event. */
model ContainerRegistryEventTarget {
  /** The MIME type of the referenced object. */
  mediaType?: string;

  /** The number of bytes of the content. Same as Length field. */
  size?: int64;

  /** The digest of the content, as defined by the Registry V2 HTTP API Specification. */
  digest?: string;

  /** The number of bytes of the content. Same as Size field. */
  length?: int64;

  /** The repository name. */
  repository?: string;

  /** The direct URL to the content. */
  url?: string;

  /** The tag name. */
  tag?: string;
}

/** The target of the event. */
model ContainerRegistryArtifactEventTarget {
  ...ContainerRegistryBaseEventTarget<
    "The MIME type of the artifact.",
    "The size in bytes of the artifact.",
    "The digest of the artifact.",
    "The repository name of the artifact.",
    "The tag of the artifact."
  >;

  /** The name of the artifact. */
  name?: string;

  /** The version of the artifact. */
  version?: string;
}

/** The request that generated the event. */
model ContainerRegistryEventRequest {
  /** The ID of the request that initiated the event. */
  id?: string;

  /** The IP or hostname and possibly port of the client connection that initiated the event. This is the RemoteAddr from the standard http request. */
  addr?: string;

  /** The externally accessible hostname of the registry instance, as specified by the http host header on incoming requests. */
  host?: string;

  /** The request method that generated the event. */
  method?: string;

  /** The user agent header of the request. */
  useragent?: string;
}

/** The agent that initiated the event. For most situations, this could be from the authorization context of the request. */
model ContainerRegistryEventActor {
  /** The subject or username associated with the request context that generated the event. */
  name?: string;
}

/** The registry node that generated the event. Put differently, while the actor initiates the event, the source generates it. */
model ContainerRegistryEventSource {
  /** The IP or hostname and the port of the registry node that generated the event. Generally, this will be resolved by os.Hostname() along with the running port. */
  addr?: string;

  /** The running instance of an application. Changes after each restart. */
  #suppress "@azure-tools/typespec-azure-core/casing-style" "Modeling after the existing service swagger."
  instanceID?: string;
}

/** The connected registry information if the event is generated by a connected registry. */
model ContainerRegistryEventConnectedRegistry {
  /** The name of the connected registry that generated this event. */
  name?: string;
}

alias ContainerRegistryBaseEventTarget<
  TmediaType extends valueof string,
  Tsize extends valueof string,
  Tdigest extends valueof string,
  Trepository extends valueof string,
  Ttag extends valueof string
> = {
  @doc(TmediaType)
  mediaType?: string;

  @doc(Tsize)
  size?: int64;

  @doc(Tdigest)
  digest?: string;

  @doc(Trepository)
  repository?: string;

  @doc(Ttag)
  tag?: string;
};
