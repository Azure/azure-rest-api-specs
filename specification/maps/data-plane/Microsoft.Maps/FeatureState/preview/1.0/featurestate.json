{
  "swagger": "2.0",
  "info": {
    "title": "Azure Maps Feature State Service",
    "version": "1.0",
    "description": "APIs for managing the dynamic feature states in Azure Maps."
  },
  "x-ms-parameterized-host": {
    "hostTemplate": "{geography}.atlas.microsoft.com",
    "parameters": [
      {
        "$ref": "../../../Common/preview/1.0/common.json#/parameters/GeographicResourceLocation"
      }
    ]
  },
  "schemes": [
    "https"
  ],
  "consumes": [],
  "produces": [
    "application/json"
  ],
  "security": [
    {
      "azure_auth": [
        "user_impersonation"
      ]
    },
    {
      "SubscriptionKeyInHeader": []
    },
    {
      "SubscriptionKeyInQuery": []
    }
  ],
  "securityDefinitions": {
    "azure_auth": {
      "type": "oauth2",
      "authorizationUrl": "https://login.microsoftonline.com/common/oauth2/authorize",
      "flow": "implicit",
      "description": "Azure Active Directory OAuth2 Flow",
      "scopes": {
        "user_impersonation": "impersonate your user account"
      }
    },
    "SubscriptionKeyInHeader": {
      "type": "apiKey",
      "name": "subscription-key",
      "in": "header"
    },
    "SubscriptionKeyInQuery": {
      "type": "apiKey",
      "name": "subscription-key",
      "in": "query"
    }
  },
  "responses": {},
  "parameters": {
    "DatasetIdForCreate": {
      "name": "datasetId",
      "description": "The datasetId must have been obtained from a successful [Dataset Create API](/rest/api/maps/dataset/createpreview) call.",
      "type": "string",
      "in": "query",
      "required": true,
      "x-ms-parameter-location": "method"
    },
    "StatesetId": {
      "name": "statesetId",
      "description": "The stateset id that was created.",
      "type": "string",
      "in": "query",
      "required": true,
      "x-ms-parameter-location": "method"
    },
    "StatesetIdInPath": {
      "name": "statesetId",
      "description": "The stateset id that was created.",
      "type": "string",
      "in": "path",
      "required": true,
      "x-ms-parameter-location": "method"
    },
    "FeatureIdInDataset": {
      "name": "featureId",
      "description": "The id of a feature in the given dataset. If the featureId is not present in the dataset, Bad Request response will be returned.",
      "type": "string",
      "in": "query",
      "required": true,
      "x-ms-parameter-location": "method"
    },
    "FeatureIdInStateset": {
      "name": "featureId",
      "description": "The id of a feature in the given stateset. If no state was set for the featureId in the stateset earlier, Bad Request response will be returned.",
      "type": "string",
      "in": "query",
      "required": true,
      "x-ms-parameter-location": "method"
    },
    "StateKeyNameDelete": {
      "name": "stateKeyName",
      "description": "The Name of the state to be deleted.",
      "type": "string",
      "in": "query",
      "required": true,
      "x-ms-parameter-location": "method"
    }
  },
  "paths": {
    "/featureState/stateset/{statesetId}": {
      "get": {
        "description": "**Applies to**: see pricing [tiers](https://azure.microsoft.com/en-us/pricing/details/azure-maps/).\n<br>\n\nThis GET API allows the user to get the stateset Information.\n\nThe stateset Information includes the datasetId associated to the stateset, and the styles of that stateset.",
        "operationId": "FeatureState_GetStatesetPreview",
        "x-ms-examples": {
          "Get stateset information with a statesetId": {
            "$ref": "./examples/GetStateset.json"
          }
        },
        "parameters": [
          {
            "$ref": "../../../Common/preview/1.0/common.json#/parameters/SubscriptionKey"
          },
          {
            "$ref": "../../../Common/preview/1.0/common.json#/parameters/ApiVersion"
          },
          {
            "$ref": "#/parameters/StatesetIdInPath"
          }
        ],
        "responses": {
          "200": {
            "description": "Get request completed successfully.",
            "schema": {
              "$ref": "#/definitions/StatesetGetResponse"
            }
          },
          "400": {
            "$ref": "../../../Common/preview/1.0/common.json#/responses/400"
          },
          "401": {
            "$ref": "../../../Common/preview/1.0/common.json#/responses/401"
          },
          "403": {
            "$ref": "../../../Common/preview/1.0/common.json#/responses/403"
          },
          "404": {
            "$ref": "../../../Common/preview/1.0/common.json#/responses/404"
          },
          "500": {
            "$ref": "../../../Common/preview/1.0/common.json#/responses/500"
          }
        }
      },
      "delete": {
        "description": "**Applies to**: see pricing [tiers](https://azure.microsoft.com/en-us/pricing/details/azure-maps/). <br> This DELETE API allows the user to delete the stateset and the associated data.",
        "operationId": "FeatureState_DeleteStatesetPreview",
        "x-ms-examples": {
          "Delete an existing stateset": {
            "$ref": "./examples/DeleteStateset.json"
          }
        },
        "parameters": [
          {
            "$ref": "../../../Common/preview/1.0/common.json#/parameters/SubscriptionKey"
          },
          {
            "$ref": "../../../Common/preview/1.0/common.json#/parameters/ApiVersion"
          },
          {
            "$ref": "#/parameters/StatesetIdInPath"
          }
        ],
        "responses": {
          "204": {
            "description": "Stateset Deleted."
          },
          "400": {
            "$ref": "../../../Common/preview/1.0/common.json#/responses/400"
          },
          "401": {
            "$ref": "../../../Common/preview/1.0/common.json#/responses/401"
          },
          "403": {
            "$ref": "../../../Common/preview/1.0/common.json#/responses/403"
          },
          "404": {
            "$ref": "../../../Common/preview/1.0/common.json#/responses/404"
          },
          "500": {
            "$ref": "../../../Common/preview/1.0/common.json#/responses/500"
          }
        }
      },
      "put": {
        "description": "**Applies to**: see pricing [tiers](https://azure.microsoft.com/en-us/pricing/details/azure-maps/).\n<br>\n\nThis PUT API allows the user to update the stateset style rules.",
        "operationId": "FeatureState_PutStatesetPreview",
        "x-ms-examples": {
          "Update stateset style rules with a statesetId": {
            "$ref": "./examples/UpdateStateset.json"
          }
        },
        "parameters": [
          {
            "$ref": "../../../Common/preview/1.0/common.json#/parameters/SubscriptionKey"
          },
          {
            "$ref": "../../../Common/preview/1.0/common.json#/parameters/ApiVersion"
          },
          {
            "$ref": "#/parameters/StatesetIdInPath"
          },
          {
            "name": "statesetStyleUpdateRequestBody",
            "in": "body",
            "description": "The stateset style JSON data. Only style rules are allowed to be updated, update on keyname and type is not allowed.",
            "required": true,
            "schema": {
              "$ref": "#/definitions/StylesObject"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Stateset styles are updated successfully."
          },
          "400": {
            "$ref": "../../../Common/preview/1.0/common.json#/responses/400"
          },
          "401": {
            "$ref": "../../../Common/preview/1.0/common.json#/responses/401"
          },
          "403": {
            "$ref": "../../../Common/preview/1.0/common.json#/responses/403"
          },
          "404": {
            "$ref": "../../../Common/preview/1.0/common.json#/responses/404"
          },
          "500": {
            "$ref": "../../../Common/preview/1.0/common.json#/responses/500"
          }
        }
      }
    },
    "/featureState/stateset": {
      "post": {
        "description": "**Applies to**: see pricing [tiers](https://azure.microsoft.com/en-us/pricing/details/azure-maps/).\n<br>\n\nThis POST API allows the user to create a new Stateset and define stateset style using request body.\n\nCreator makes it possible to develop applications based on your private indoor map data using Azure Maps API and SDK. The Feature State API is part of Creator. \n\nThe Feature State service allows the user to update the states of a feature and query them to be used in other services. The dynamic properties of a feature that don't belong to the dataset are referred to as *states* here.\n\nThis Feature State service pivot on the Stateset. Like Tileset, Stateset encapsulates the storage mechanism for feature states for a dataset.\n\nOnce the stateset is created, users can use that statesetId to post feature state updates and retrieve the current feature states. A feature can have only one state at a given point in time. \n\nFeature state is defined by the key name, value and the timestamp. When a feature state update is posted to Azure Maps, the state value gets updated only if the provided state’s timestamp is later than the stored timestamp. \n\nAzure Maps MapControl provides a way to use these feature states to style the features. Please refer to the State Tile documentation for more information.",
        "operationId": "FeatureState_CreateStatesetPreview",
        "x-ms-examples": {
          "Create a new stateset with a datasetId": {
            "$ref": "./examples/CreateStateset.json"
          }
        },
        "parameters": [
          {
            "$ref": "../../../Common/preview/1.0/common.json#/parameters/SubscriptionKey"
          },
          {
            "$ref": "../../../Common/preview/1.0/common.json#/parameters/ApiVersion"
          },
          {
            "$ref": "#/parameters/DatasetIdForCreate"
          },
          {
            "name": "statesetCreateRequestBody",
            "in": "body",
            "description": "The stateset style JSON data.",
            "required": true,
            "schema": {
              "$ref": "#/definitions/StylesObject"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Stateset created.",
            "schema": {
              "$ref": "#/definitions/StatesetCreatedResponse"
            }
          },
          "400": {
            "$ref": "../../../Common/preview/1.0/common.json#/responses/400"
          },
          "401": {
            "$ref": "../../../Common/preview/1.0/common.json#/responses/401"
          },
          "403": {
            "$ref": "../../../Common/preview/1.0/common.json#/responses/403"
          },
          "404": {
            "$ref": "../../../Common/preview/1.0/common.json#/responses/404"
          },
          "500": {
            "$ref": "../../../Common/preview/1.0/common.json#/responses/500"
          }
        }
      },
      "get": {
        "description": "**Applies to**: see pricing [tiers](https://azure.microsoft.com/en-us/pricing/details/azure-maps/). <br> This API allows the caller to fetch a list of all previously successfully created statesets.",
        "operationId": "FeatureState_ListStatesetPreview",
        "x-ms-examples": {
          "List all the previously created statesets": {
            "$ref": "./examples/Stateset_List.json"
          }
        },
        "parameters": [
          {
            "$ref": "../../../Common/preview/1.0/common.json#/parameters/SubscriptionKey"
          },
          {
            "$ref": "../../../Common/preview/1.0/common.json#/parameters/ApiVersion"
          }
        ],
        "responses": {
          "200": {
            "description": "The list stateset request completed successfully. The response body contains a list of all the previously created statesets.",
            "schema": {
              "$ref": "#/definitions/StatesetListResponse"
            }
          },
          "400": {
            "$ref": "../../../Common/preview/1.0/common.json#/responses/400"
          },
          "401": {
            "$ref": "../../../Common/preview/1.0/common.json#/responses/401"
          },
          "403": {
            "$ref": "../../../Common/preview/1.0/common.json#/responses/403"
          },
          "404": {
            "$ref": "../../../Common/preview/1.0/common.json#/responses/404"
          },
          "500": {
            "$ref": "../../../Common/preview/1.0/common.json#/responses/500"
          }
        }
      }
    },
    "/featureState/state": {
      "get": {
        "operationId": "FeatureState_GetStatesPreview",
        "description": "**Applies to**: see pricing [tiers](https://azure.microsoft.com/en-us/pricing/details/azure-maps/). <br> This API returns the current state information associated with the given feature in the given stateset.",
        "x-ms-examples": {
          "Get the current states of a feature": {
            "$ref": "./examples/GetStates.json"
          }
        },
        "parameters": [
          {
            "$ref": "../../../Common/preview/1.0/common.json#/parameters/SubscriptionKey"
          },
          {
            "$ref": "../../../Common/preview/1.0/common.json#/parameters/ApiVersion"
          },
          {
            "$ref": "#/parameters/StatesetId"
          },
          {
            "$ref": "#/parameters/FeatureIdInStateset"
          }
        ],
        "responses": {
          "200": {
            "description": "Get request completed successfully.",
            "schema": {
              "$ref": "#/definitions/FeatureStatesStructure"
            }
          },
          "400": {
            "$ref": "../../../Common/preview/1.0/common.json#/responses/400"
          },
          "401": {
            "$ref": "../../../Common/preview/1.0/common.json#/responses/401"
          },
          "403": {
            "$ref": "../../../Common/preview/1.0/common.json#/responses/403"
          },
          "404": {
            "$ref": "../../../Common/preview/1.0/common.json#/responses/404"
          },
          "500": {
            "$ref": "../../../Common/preview/1.0/common.json#/responses/500"
          }
        }
      },
      "post": {
        "operationId": "FeatureState_UpdateStatesPreview",
        "description": "**Applies to**: see pricing [tiers](https://azure.microsoft.com/en-us/pricing/details/azure-maps/). <br>\nThis POST API allows the user to update the state of the given feature in the given stateset.",
        "x-ms-examples": {
          "Update the states of a feature": {
            "$ref": "./examples/UpdateStates.json"
          }
        },
        "parameters": [
          {
            "$ref": "../../../Common/preview/1.0/common.json#/parameters/SubscriptionKey"
          },
          {
            "$ref": "../../../Common/preview/1.0/common.json#/parameters/ApiVersion"
          },
          {
            "$ref": "#/parameters/StatesetId"
          },
          {
            "$ref": "#/parameters/FeatureIdInDataset"
          },
          {
            "name": "featureStateUpdateRequestBody",
            "in": "body",
            "description": "The feature state JSON data. A feature can have only one state at a given point in time. The specified state keyname must have been defined during the stateset creation.",
            "required": true,
            "schema": {
              "$ref": "#/definitions/FeatureStatesStructure"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Feature states are updated successfully."
          },
          "400": {
            "$ref": "../../../Common/preview/1.0/common.json#/responses/400"
          },
          "401": {
            "$ref": "../../../Common/preview/1.0/common.json#/responses/401"
          },
          "403": {
            "$ref": "../../../Common/preview/1.0/common.json#/responses/403"
          },
          "404": {
            "$ref": "../../../Common/preview/1.0/common.json#/responses/404"
          },
          "500": {
            "$ref": "../../../Common/preview/1.0/common.json#/responses/500"
          }
        }
      },
      "delete": {
        "operationId": "FeatureState_DeleteStatePreview",
        "description": "**Applies to**: see pricing [tiers](https://azure.microsoft.com/en-us/pricing/details/azure-maps/). <br> This API deletes the state information identified by the StateKeyName parameter for the feature identified by the FeatureId parameter in the the stateset.",
        "x-ms-examples": {
          "Delete the given feature state": {
            "$ref": "./examples/DeleteFeatureState.json"
          }
        },
        "parameters": [
          {
            "$ref": "../../../Common/preview/1.0/common.json#/parameters/SubscriptionKey"
          },
          {
            "$ref": "../../../Common/preview/1.0/common.json#/parameters/ApiVersion"
          },
          {
            "$ref": "#/parameters/StatesetId"
          },
          {
            "$ref": "#/parameters/FeatureIdInStateset"
          },
          {
            "$ref": "#/parameters/StateKeyNameDelete"
          }
        ],
        "responses": {
          "200": {
            "description": "Feature states deleted successfully."
          },
          "400": {
            "$ref": "../../../Common/preview/1.0/common.json#/responses/400"
          },
          "401": {
            "$ref": "../../../Common/preview/1.0/common.json#/responses/401"
          },
          "403": {
            "$ref": "../../../Common/preview/1.0/common.json#/responses/403"
          },
          "404": {
            "$ref": "../../../Common/preview/1.0/common.json#/responses/404"
          },
          "409": {
            "$ref": "../../../Common/preview/1.0/common.json#/responses/409"
          },
          "500": {
            "$ref": "../../../Common/preview/1.0/common.json#/responses/500"
          }
        }
      }
    }
  },
  "definitions": {
    "StatesetGetResponse": {
      "description": "The response model for the successful Stateset Get API.",
      "type": "object",
      "properties": {
        "datasetIdList": {
          "description": "Dataset ID associated with the stateset.",
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "statesetStyle": {
          "$ref": "#/definitions/StylesObject"
        }
      }
    },
    "StatesetListResponse": {
      "description": "The response model for the successful Stateset List API.",
      "type": "object",
      "properties": {
        "statesetDetailList": {
          "description": "A list of statesets information.",
          "type": "array",
          "items": {
            "$ref": "#/definitions/StatesetInfoObject"
          }
        }
      }
    },
    "StatesetInfoObject": {
      "description": "The stateset information detail.",
      "type": "object",
      "properties": {
        "statesetId": {
          "description": "The stateset ID of this stateset.",
          "type": "string"
        },
        "datasetIdList": {
          "description": "Dataset ID associated with the stateset.",
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "statesetStyle": {
          "$ref": "#/definitions/StylesObject"
        }
      }
    },
    "StatesetCreatedResponse": {
      "description": "The response model for the successful Stateset Create API.",
      "type": "object",
      "properties": {
        "statesetId": {
          "description": "The ID for the new stateset created.",
          "type": "string",
          "readOnly": true
        }
      }
    },
    "FeatureStatesStructure": {
      "description": "The feature states model for a feature.",
      "type": "object",
      "properties": {
        "states": {
          "description": "The feature states array.",
          "type": "array",
          "items": {
            "$ref": "#/definitions/FeatureStateObject"
          }
        }
      }
    },
    "FeatureStateObject": {
      "description": "Single feature state model.",
      "type": "object",
      "properties": {
        "keyName": {
          "description": "Feature state Keyname.",
          "type": "string"
        },
        "value": {
          "description": "Value for the feature state.",
          "type": "object"
        },
        "eventTimestamp": {
          "description": "Timestamp when the feature state was captured.",
          "type": "string"
        }
      }
    },
    "StylesObject": {
      "description": "The styles model.",
      "type": "object",
      "properties": {
        "styles": {
          "description": "An array of stateset styles. The style rule could be a numeric or string or a boolean type style rule.  Refer to NumberRuleObject, StringRuleObject and BooleanRuleObject definitions [here](https://aka.ms/AzureMapsStatesetStylesObject). ",
          "type": "array",
          "items": {
            "$ref": "#/definitions/StyleObject"
          }
        }
      }
    },
    "NumberRuleObject": {
      "description": "The numeric rule. The color is selected from the first range it falls into.",
      "type": "object",
      "properties": {
        "range": {
          "$ref": "#/definitions/RangeObject"
        },
        "color": {
          "description": "The color when value is within the range. Color is a JSON string in a variety of permitted formats, HTML-style hex values, RGB (\"#ff0\", \"#ffff00\", \"rgb(255, 255, 0)\"), RGBA (\"rgba(255, 255, 0, 1)\"), HSL(\"hsl(100, 50%, 50%)\"), and HSLA(\"hsla(100, 50%, 50%, 1)\"). Predefined HTML colors names, like yellow and blue, are also permitted.",
          "type": "string"
        }
      }
    },
    "RangeObject": {
      "description": "The numeric value range for this style rule. If the value is in the range, all the conditions must hold true.",
      "type": "object",
      "properties": {
        "minimum": {
          "description": "All the number x that x ≥ minimum.",
          "type": "number",
          "format": "double"
        },
        "maximum": {
          "description": "All the number x that x ≤ maximum.",
          "type": "number",
          "format": "double"
        },
        "exclusiveMinimum": {
          "description": "All the number x that x > exclusiveMinimum.",
          "type": "number",
          "format": "double"
        },
        "exclusiveMaximum": {
          "description": "All the number x that x < exclusiveMaximum.",
          "type": "number",
          "format": "double"
        }
      }
    },
    "BooleanRuleObject": {
      "description": "The boolean rule. The color is selected based on the logic value of the key.",
      "type": "object",
      "properties": {
        "true": {
          "description": "The color when value is true. Color is a JSON string in a variety of permitted formats, HTML-style hex values, RGB (\"#ff0\", \"#ffff00\", \"rgb(255, 255, 0)\"), RGBA (\"rgba(255, 255, 0, 1)\"), HSL(\"hsl(100, 50%, 50%)\"), and HSLA(\"hsla(100, 50%, 50%, 1)\"). Predefined HTML colors names, like yellow and blue, are also permitted.",
          "type": "string"
        },
        "false": {
          "description": "The color when value is false. Color is a JSON string in a variety of permitted formats, HTML-style hex values, RGB (\"#ff0\", \"#ffff00\", \"rgb(255, 255, 0)\"), RGBA (\"rgba(255, 255, 0, 1)\"), HSL(\"hsl(100, 50%, 50%)\"), and HSLA(\"hsla(100, 50%, 50%, 1)\"). Predefined HTML colors names, like yellow and blue, are also permitted.",
          "type": "string"
        }
      }
    },
    "StringRuleObject": {
      "description": "The string rule. The string value matching is case sensitive. If a feature's state doesn't match any of the values defined here, that feature will not have any dynamic style. If duplicate string values are given, the first one takes precedence.",
      "type": "object",
      "additionalProperties": {
        "description": "The color when the keyName value string is equal to this property name. Color is a JSON string in a variety of permitted formats, HTML-style hex values, RGB (\"#ff0\", \"#ffff00\", \"rgb(255, 255, 0)\"), RGBA (\"rgba(255, 255, 0, 1)\"), HSL(\"hsl(100, 50%, 50%)\"), and HSLA(\"hsla(100, 50%, 50%, 1)\"). Predefined HTML colors names, like yellow and blue, are also permitted.",
        "type": "string"
      }
    },
    "StyleObject": {
      "description": "The stateset style model. The style rule could be a numeric type style rule or a boolean type style rule.  Refer to NumberRuleObject, StringRuleObject and BooleanRuleObject definitions [here](https://aka.ms/AzureMapsStatesetStylesObject). ",
      "discriminator": "type",
      "type": "object",
      "required": [
        "keyName",
        "type"
      ],
      "properties": {
        "keyName": {
          "description": "Stateset style key name. Key names are random strings but they should be unique inside style array.",
          "type": "string"
        },
        "type": {
          "description": "The type of stateset style.",
          "type": "string",
          "enum": [
            "boolean",
            "number",
            "string"
          ],
          "x-ms-enum": {
            "name": "StyleObjectType",
            "modelAsString": true,
            "values": [
              {
                "value": "boolean",
                "description": "Boolean type of stateset style.",
                "name": "BooleanTypeStyleRule"
              },
              {
                "value": "number",
                "description": "Number type of stateset style.",
                "name": "NumberTypeStyleRule"
              },
              {
                "value": "string",
                "description": "String type of stateset style.",
                "name": "StringTypeStyleRule"
              }
            ]
          }
        }
      }
    },
    "BooleanTypeStyleRule": {
      "description": "The boolean type style rule object.",
      "x-ms-discriminator-value": "boolean",
      "type": "object",
      "allOf": [
        {
          "$ref": "#/definitions/StyleObject"
        }
      ],
      "properties": {
        "rules": {
          "description": "Boolean style rules.",
          "type": "array",
          "items": {
            "$ref": "#/definitions/BooleanRuleObject"
          }
        }
      },
      "required": [
        "rules"
      ]
    },
    "NumberTypeStyleRule": {
      "description": "The numeric type style rule object.",
      "x-ms-discriminator-value": "number",
      "type": "object",
      "allOf": [
        {
          "$ref": "#/definitions/StyleObject"
        }
      ],
      "properties": {
        "rules": {
          "description": "Numeric style rules.",
          "type": "array",
          "items": {
            "$ref": "#/definitions/NumberRuleObject"
          }
        }
      },
      "required": [
        "rules"
      ]
    },
    "StringTypeStyleRule": {
      "description": "The string type style rule object.",
      "x-ms-discriminator-value": "string",
      "type": "object",
      "allOf": [
        {
          "$ref": "#/definitions/StyleObject"
        }
      ],
      "properties": {
        "rules": {
          "description": "String style rules.",
          "type": "array",
          "items": {
            "$ref": "#/definitions/StringRuleObject"
          }
        }
      },
      "required": [
        "rules"
      ]
    }
  }
}
