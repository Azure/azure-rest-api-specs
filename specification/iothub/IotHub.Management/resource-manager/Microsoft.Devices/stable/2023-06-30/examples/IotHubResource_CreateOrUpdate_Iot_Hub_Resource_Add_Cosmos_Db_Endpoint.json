{
  "parameters": {
    "api-version": "2023-06-30",
    "iotHubDescription": {
      "etag": "AAAAAAFD6M4=",
      "location": "centraluseuap",
      "properties": {
        "cloudToDevice": {
          "defaultTtlAsIso8601": "PT1H",
          "feedback": {
            "lockDurationAsIso8601": "PT1M",
            "maxDeliveryCount": 10,
            "ttlAsIso8601": "PT1H"
          },
          "maxDeliveryCount": 10
        },
        "enableDataResidency": false,
        "enableFileUploadNotifications": false,
        "eventHubEndpoints": {
          "events": {
            "partitionCount": 2,
            "retentionTimeInDays": 1
          }
        },
        "features": "None",
        "ipFilterRules": [],
        "messagingEndpoints": {
          "fileNotifications": {
            "lockDurationAsIso8601": "PT1M",
            "maxDeliveryCount": 10,
            "ttlAsIso8601": "PT1H"
          }
        },
        "minTlsVersion": "1.2",
        "networkRuleSets": {
          "applyToBuiltInEventHubEndpoint": true,
          "defaultAction": "Deny",
          "ipRules": [
            {
              "action": "Allow",
              "filterName": "rule1",
              "ipMask": "131.117.159.53"
            },
            {
              "action": "Allow",
              "filterName": "rule2",
              "ipMask": "157.55.59.128/25"
            }
          ]
        },
        "routing": {
          "endpoints": {
            "cosmosDBSqlContainers": [
              {
                "name": "endpointcosmos",
                "authenticationType": "keyBased",
                "containerName": "test",
                "databaseName": "systemstore",
                "endpointUri": "https://test-systemstore-test2.documents.azure.com",
                "partitionKeyName": "keystamped",
                "partitionKeyTemplate": "{deviceid}-{YYYY}-{MM}",
                "primaryKey": "<primary-key>",
                "resourceGroup": "rg-test",
                "secondaryKey": "<secondary-key>",
                "subscriptionId": "<subscription-id>"
              }
            ],
            "eventHubs": [],
            "serviceBusQueues": [],
            "serviceBusTopics": [],
            "storageContainers": []
          },
          "fallbackRoute": {
            "name": "$fallback",
            "condition": "true",
            "endpointNames": [
              "events"
            ],
            "isEnabled": true,
            "source": "DeviceMessages"
          },
          "routes": []
        },
        "storageEndpoints": {
          "$default": {
            "connectionString": "",
            "containerName": "",
            "sasTtlAsIso8601": "PT1H"
          }
        }
      },
      "sku": {
        "name": "S1",
        "capacity": 1
      },
      "tags": {}
    },
    "resourceGroupName": "myResourceGroup",
    "resourceName": "testHub",
    "subscriptionId": "91d12660-3dec-467a-be2a-213b5544ddc0"
  },
  "responses": {
    "200": {
      "body": {
        "name": "testHub",
        "type": "Microsoft.Devices/IotHubs",
        "etag": "AAAAAAFD6M4=",
        "id": "/subscriptions/ae24ff83-d2ca-4fc8-9717-05dae4bba489/resourceGroups/myResourceGroup/providers/Microsoft.Devices/IotHubs/testHub",
        "location": "centraluseuap",
        "properties": {
          "cloudToDevice": {
            "defaultTtlAsIso8601": "PT1H",
            "feedback": {
              "lockDurationAsIso8601": "PT1M",
              "maxDeliveryCount": 10,
              "ttlAsIso8601": "PT1H"
            },
            "maxDeliveryCount": 10
          },
          "enableDataResidency": false,
          "enableFileUploadNotifications": false,
          "eventHubEndpoints": {
            "events": {
              "path": "iot-dps-cit-hub-1",
              "endpoint": "sb://iothub-ns-iot-dps-ci-245306-76aca8e13b.servicebus.windows.net/",
              "partitionCount": 2,
              "partitionIds": [
                "0",
                "1"
              ],
              "retentionTimeInDays": 1
            }
          },
          "features": "None",
          "hostName": "iot-dps-cit-hub-1.azure-devices.net",
          "ipFilterRules": [
            {
              "action": "Accept",
              "filterName": "rule1",
              "ipMask": "131.117.159.53"
            },
            {
              "action": "Accept",
              "filterName": "rule2",
              "ipMask": "157.55.59.128/25"
            }
          ],
          "messagingEndpoints": {
            "fileNotifications": {
              "lockDurationAsIso8601": "PT1M",
              "maxDeliveryCount": 10,
              "ttlAsIso8601": "PT1H"
            }
          },
          "minTlsVersion": "1.2",
          "networkRuleSets": {
            "applyToBuiltInEventHubEndpoint": true,
            "defaultAction": "Deny",
            "ipRules": [
              {
                "action": "Allow",
                "filterName": "rule1",
                "ipMask": "131.117.159.53"
              },
              {
                "action": "Allow",
                "filterName": "rule2",
                "ipMask": "157.55.59.128/25"
              }
            ]
          },
          "provisioningState": "Succeeded",
          "routing": {
            "endpoints": {
              "cosmosDBSqlContainers": [
                {
                  "name": "endpointcosmos",
                  "authenticationType": "keyBased",
                  "containerName": "test",
                  "databaseName": "systemstore",
                  "endpointUri": "https://test-systemstore-test2.documents.azure.com",
                  "id": "009208fa-9cb7-4b90-bfbd-f40086e766c9",
                  "partitionKeyName": "keystamped",
                  "partitionKeyTemplate": "{deviceid}-{YYYY}-{MM}",
                  "resourceGroup": "rg-test",
                  "subscriptionId": "<subscription-id>"
                }
              ],
              "eventHubs": [],
              "serviceBusQueues": [],
              "serviceBusTopics": [],
              "storageContainers": []
            },
            "fallbackRoute": {
              "name": "$fallback",
              "condition": "true",
              "endpointNames": [
                "events"
              ],
              "isEnabled": true,
              "source": "DeviceMessages"
            },
            "routes": []
          },
          "state": "Active",
          "storageEndpoints": {
            "$default": {
              "connectionString": "",
              "containerName": "",
              "sasTtlAsIso8601": "PT1H"
            }
          }
        },
        "sku": {
          "name": "S1",
          "capacity": 1,
          "tier": "Standard"
        },
        "systemData": {
          "createdAt": "2021-01-30T00:28:38.963Z"
        },
        "tags": {}
      }
    },
    "201": {
      "body": {
        "name": "testHub",
        "type": "Microsoft.Devices/IotHubs",
        "etag": "AAAAAAFD6M4=",
        "id": "/subscriptions/ae24ff83-d2ca-4fc8-9717-05dae4bba489/resourceGroups/myResourceGroup/providers/Microsoft.Devices/IotHubs/testHub",
        "location": "centraluseuap",
        "properties": {
          "cloudToDevice": {
            "defaultTtlAsIso8601": "PT1H",
            "feedback": {
              "lockDurationAsIso8601": "PT1M",
              "maxDeliveryCount": 10,
              "ttlAsIso8601": "PT1H"
            },
            "maxDeliveryCount": 10
          },
          "enableDataResidency": false,
          "enableFileUploadNotifications": false,
          "eventHubEndpoints": {
            "events": {
              "path": "iot-dps-cit-hub-1",
              "endpoint": "sb://iothub-ns-iot-dps-ci-245306-76aca8e13b.servicebus.windows.net/",
              "partitionCount": 2,
              "partitionIds": [
                "0",
                "1"
              ],
              "retentionTimeInDays": 1
            }
          },
          "features": "None",
          "hostName": "iot-dps-cit-hub-1.azure-devices.net",
          "ipFilterRules": [
            {
              "action": "Accept",
              "filterName": "rule1",
              "ipMask": "131.117.159.53"
            },
            {
              "action": "Accept",
              "filterName": "rule2",
              "ipMask": "157.55.59.128/25"
            }
          ],
          "messagingEndpoints": {
            "fileNotifications": {
              "lockDurationAsIso8601": "PT1M",
              "maxDeliveryCount": 10,
              "ttlAsIso8601": "PT1H"
            }
          },
          "minTlsVersion": "1.2",
          "networkRuleSets": {
            "applyToBuiltInEventHubEndpoint": true,
            "defaultAction": "Deny",
            "ipRules": [
              {
                "action": "Allow",
                "filterName": "rule1",
                "ipMask": "131.117.159.53"
              },
              {
                "action": "Allow",
                "filterName": "rule2",
                "ipMask": "157.55.59.128/25"
              }
            ]
          },
          "provisioningState": "Succeeded",
          "routing": {
            "endpoints": {
              "cosmosDBSqlContainers": [
                {
                  "name": "endpointcosmos",
                  "authenticationType": "keyBased",
                  "containerName": "test",
                  "databaseName": "systemstore",
                  "endpointUri": "https://test-systemstore-test2.documents.azure.com",
                  "id": "009208fa-9cb7-4b90-bfbd-f40086e766c9",
                  "partitionKeyName": "keystamped",
                  "partitionKeyTemplate": "{deviceid}-{YYYY}-{MM}",
                  "resourceGroup": "rg-test",
                  "subscriptionId": "<subscription-id>"
                }
              ],
              "eventHubs": [],
              "serviceBusQueues": [],
              "serviceBusTopics": [],
              "storageContainers": []
            },
            "fallbackRoute": {
              "name": "$fallback",
              "condition": "true",
              "endpointNames": [
                "events"
              ],
              "isEnabled": true,
              "source": "DeviceMessages"
            },
            "routes": []
          },
          "state": "Active",
          "storageEndpoints": {
            "$default": {
              "connectionString": "",
              "containerName": "",
              "sasTtlAsIso8601": "PT1H"
            }
          }
        },
        "sku": {
          "name": "S1",
          "capacity": 1,
          "tier": "Standard"
        },
        "systemData": {
          "createdAt": "2021-01-30T00:28:38.963Z"
        },
        "tags": {}
      }
    }
  },
  "operationId": "IotHubResource_CreateOrUpdate",
  "title": "IotHubResource_AddCosmosDbEndpoint"
}