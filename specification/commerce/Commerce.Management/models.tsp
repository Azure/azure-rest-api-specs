import "@typespec/rest";
import "@typespec/http";
import "@azure-tools/typespec-azure-resource-manager";

using TypeSpec.Rest;
using TypeSpec.Http;
using Azure.ResourceManager;
using Azure.ResourceManager.Foundations;

namespace Microsoft.Commerce;

#suppress "@azure-tools/typespec-azure-core/documentation-required" "For backward compatibility"
#suppress "@azure-tools/typespec-azure-core/no-enum" "For backward compatibility"
enum AggregationGranularity {
  /**
   * Daily
   */
  Daily,

  /**
   * Hourly
   */
  Hourly,
}

/**
 * Name of the offer term
 */
#suppress "@azure-tools/typespec-azure-core/no-enum" "For backward compatibility"
enum OfferTermInfo {
  /**
   * Recurring Charge
   */
  RecurringCharge: "Recurring Charge",

  /**
   * Monetary Commitment
   */
  MonetaryCommitment: "Monetary Commitment",

  /**
   * Monetary Credit
   */
  MonetaryCredit: "Monetary Credit",
}

/**
 * Describes the usageAggregation.
 */
model UsageAggregation {
  /**
   * Unique Id for the usage aggregate.
   */
  id?: string;

  /**
   * Name of the usage aggregate.
   */
  name?: string;

  /**
   * Type of the resource being returned.
   */
  type?: string;

  /**
   * Usage data.
   */
  properties?: UsageSample;
}

/**
 * Describes a sample of the usageAggregation.
 */
model UsageSample {
  /**
   * The subscription identifier for the Azure user.
   */
  #suppress "@azure-tools/typespec-azure-core/no-format"
  @format("uuid")
  subscriptionId?: string;

  /**
   * Unique ID for the resource that was consumed (aka ResourceID).
   */
  meterId?: string;

  /**
   * UTC start time for the usage bucket to which this usage aggregate belongs.
   */
  // FIXME: (utcDateTime) Please double check that this is the correct type for your scenario.
  usageStartTime?: utcDateTime;

  /**
   * UTC end time for the usage bucket to which this usage aggregate belongs.
   */
  // FIXME: (utcDateTime) Please double check that this is the correct type for your scenario.
  usageEndTime?: utcDateTime;

  /**
   * The amount of the resource consumption that occurred in this time frame.
   */
  quantity?: float32;

  /**
   * The unit in which the usage for this resource is being counted, e.g. Hours, GB.
   */
  unit?: string;

  /**
   * Friendly name of the resource being consumed.
   */
  meterName?: string;

  /**
   * Category of the consumed resource.
   */
  meterCategory?: string;

  /**
   * Sub-category of the consumed resource.
   */
  meterSubCategory?: string;

  /**
   * Region of the meterId used for billing purposes
   */
  meterRegion?: string;

  /**
   * Key-value pairs of instance details (legacy format).
   */
  infoFields?: unknown;

  /**
   * Key-value pairs of instance details represented as a string.
   */
  instanceData?: string;
}

/**
 * Describes the format of Error response with a wrapper object
 */
@error
model ErrorObjectResponse {
  /**
   * Wrapper object for error information
   */
  error?: ErrorResponse;
}

/**
 * Describes the format of Error response.
 */
@error
model ErrorResponse {
  /**
   * Error code
   */
  code?: string;

  /**
   * Error message indicating why the operation failed.
   */
  message?: string;
}

/**
 * Price and Metadata information for resources
 */
model ResourceRateCardInfo {
  /**
   * The currency in which the rates are provided.
   */
  Currency?: string;

  /**
   * The culture in which the resource information is localized.
   */
  Locale?: string;

  /**
   * All rates are pretax, so this will always be returned as 'false'.
   */
  IsTaxIncluded?: boolean;

  /**
   * A list of offer terms.
   */
  @identifiers(#["Name"])
  OfferTerms?: OfferTermInfoAutoGenerated[];

  /**
   * A list of meters.
   */
  @identifiers(#["MeterId"])
  Meters?: MeterInfo[];
}

/**
 * Describes the offer term.
 */
@discriminator("Name")
model OfferTermInfoAutoGenerated {
  /**
   * Name of the offer term
   */
  Name: OfferTermInfo;

  /**
   * Indicates the date from which the offer term is effective.
   */
  // FIXME: (utcDateTime) Please double check that this is the correct type for your scenario.
  EffectiveDate?: utcDateTime;
}

/**
 * Detailed information about the meter.
 */
model MeterInfo {
  /**
   * The unique identifier of the resource.
   */
  #suppress "@azure-tools/typespec-azure-core/no-format"
  @format("uuid")
  MeterId?: string;

  /**
   * The name of the meter, within the given meter category
   */
  MeterName?: string;

  /**
   * The category of the meter, e.g., 'Cloud services', 'Networking', etc..
   */
  MeterCategory?: string;

  /**
   * The subcategory of the meter, e.g., 'A6 Cloud services', 'ExpressRoute (IXP)', etc..
   */
  MeterSubCategory?: string;

  /**
   * The unit in which the meter consumption is charged, e.g., 'Hours', 'GB', etc.
   */
  Unit?: string;

  /**
   * Provides additional meter data. 'Third Party' indicates a meter with no discount. Blanks indicate First Party.
   */
  MeterTags?: string[];

  /**
   * The region in which the Azure service is available.
   */
  MeterRegion?: string;

  /**
   * The list of key/value pairs for the meter rates, in the format 'key':'value' where key = the meter quantity, and value = the corresponding price
   */
  #suppress "@azure-tools/typespec-azure-resource-manager/arm-no-record" "For backward compatibility"
  MeterRates?: Record<float32>;

  /**
   * Indicates the date from which the meter rate is effective.
   */
  // FIXME: (utcDateTime) Please double check that this is the correct type for your scenario.
  EffectiveDate?: utcDateTime;

  /**
   * The resource quantity that is included in the offer at no cost. Consumption beyond this quantity will be charged.
   */
  IncludedQuantity?: float32;
}

/**
 * Parameters that are used in the odata $filter query parameter for providing RateCard information.
 */
model RateCardQueryParameters {
  /**
   * The Offer ID parameter consists of the 'MS-AZR-' prefix, plus the Offer ID number (e.g., MS-AZR-0026P). See https://azure.microsoft.com/en-us/support/legal/offer-details/ for more information on the list of available Offer IDs, country/region availability, and billing currency.
   */
  @pattern("^MS-AZR-\\d{4}P(-\\d{4}P)*$")
  OfferDurableId: string;

  /**
   * The currency in which the rates need to be provided.
   */
  Currency: string;

  /**
   * The culture in which the resource metadata needs to be localized.
   */
  Locale: string;

  /**
   * 2 letter ISO code where the offer was purchased.
   */
  RegionInfo: string;
}

/**
 * Indicates that this is a monetary credit offer.
 */
model MonetaryCredit extends OfferTermInfoAutoGenerated {
  /**
   * The amount of credit provided under the terms of the given offer level.
   */
  Credit?: decimal;

  /**
   * An array of meter ids that are excluded from the given offer terms.
   */
  ExcludedMeterIds?: string[];

  /**
   * Name of the offer term
   */
  Name: OfferTermInfo.MonetaryCredit;
}

/**
 * Indicates that a monetary commitment is required for this offer
 */
model MonetaryCommitment extends OfferTermInfoAutoGenerated {
  /**
   * The list of key/value pairs for the tiered meter rates, in the format 'key':'value' where key = price, and value = the corresponding discount percentage. This field is used only by offer terms of type 'Monetary Commitment'.
   */
  #suppress "@azure-tools/typespec-azure-resource-manager/arm-no-record" "For backward compatibility"
  TieredDiscount?: Record<decimal>;

  /**
   * An array of meter ids that are excluded from the given offer terms.
   */
  ExcludedMeterIds?: string[];

  /**
   * Name of the offer term
   */
  Name: OfferTermInfo.MonetaryCommitment;
}

/**
 * Indicates a recurring charge is present for this offer.
 */
model RecurringCharge extends OfferTermInfoAutoGenerated {
  /**
   * The amount of recurring charge as per the offer term.
   */
  RecurringCharge?: int32;

  /**
   * Name of the offer term
   */
  Name: OfferTermInfo.RecurringCharge;
}
