# TypeSpec Fix Plan - DataBoxEdge# TypeSpec Fix Plan - DataBoxEdge

# Generated: 2025-11-10# Generated: 2025-11-05

# TypeSpec Project: c:\workspace\azure-rest-api-specs\specification\databoxedge\DataBoxEdge.Management# TypeSpec Project: c:\workspace\azure-rest-api-specs\specification\databoxedge\DataBoxEdge.Management

# Analysis Source: SWAGGER_SEMANTIC_DIFF_ANALYSIS.md# Analysis Source: SWAGGER_SEMANTIC_DIFF_ANALYSIS.md

##

# ============================================================================# ============================================================================

# OVERALL SUMMARY# OVERALL SUMMARY

# ============================================================================# ============================================================================

##

# Total Categories Analyzed: 19# Total Categories Analyzed: 13

# Categories Requiring Fixes: 4# Categories Requiring Fixes: 6

# Categories with No Fix Needed: 15# Categories with No Fix Needed: 7

##

# CATEGORY OVERVIEW:# CATEGORY OVERVIEW:

##

# Category 1: Common Types Migration (91 changes)# Category 1: Path Parameter Rename (8 changes)

#   Decision: ⚠️ NO FIX NEEDED#   Decision: ✅ REQUIRES FIX

#   Reason: Standard common-types v2→v3 migration, all properties verified as inherited correctly#   Reason: API paths moved from role-scoped to device-scoped, breaking existing clients

##

# Category 2: Path Restructuring - Addons and MonitoringConfig (8 changes)# Category 2: Service Description Missing (1 change)

#   Decision: ✅ REQUIRES FIX#   Decision: ⚠️ NO FIX NEEDED

#   Reason: API paths changed resource hierarchy - needs @parentResource decorator fix#   Reason: Only adds description placeholder, no API contract change

##

# Category 3: Security Settings Endpoint Consolidation (2 changes)# Category 3: Polymorphic Discriminator Changes (16 changes)

#   Decision: ✅ REQUIRES FIX#   Decision: ⚠️ NO FIX NEEDED

#   Reason: Path changed, operation needs path segment update#   Reason: Modern TypeSpec discriminator pattern using kind enum is acceptable

##

# Category 4: LRO Response Headers Added (28 changes)# Category 4: SystemData Property Removal (18 changes)

#   Decision: ⚠️ NO FIX NEEDED#   Decision: ✅ REQUIRES FIX

#   Reason: Headers automatically generated by ARM templates, non-breaking addition#   Reason: Property removal is breaking change for existing clients

##

# Category 5: Discriminator Pattern Change (29 changes)# Category 5: LRO Response Headers Addition (29 changes)

#   Decision: ⚠️ NO FIX NEEDED#   Decision: ⚠️ NO FIX NEEDED

#   Reason: TypeSpec modern discriminator pattern is functionally equivalent#   Reason: Adding headers strengthens contract, not breaking

##

# Category 6: SystemData Migration (18 changes)# Category 6: Common Type Version Update (91 changes)

#   Decision: ⚠️ NO FIX NEEDED#   Decision: ✅ REQUIRES FIX (CRITICAL)

#   Reason: SystemData correctly inherited from common-types ProxyResource/TrackedResource#   Reason: Model name changes (CloudError→ErrorResponse, OperationsList→OperationListResult) are BREAKING

##

# Category 7: ReadOnly Metadata Removed (18 changes)# Category 7: Unused Model Definitions Removed (10 changes)

#   Decision: ✅ REQUIRES FIX  #   Decision: ⚠️ NO FIX NEEDED

#   Reason: readOnly flag removed from list value arrays and object properties - breaking change#   Reason: Unused definitions don't affect API contract

##

# Category 8: Required Properties Added to List Models (16 changes)# Category 8: TypeSpec Helper Types Added (2 changes)

#   Decision: ⚠️ NO FIX NEEDED#   Decision: ⚠️ NO FIX NEEDED

#   Reason: Adding required constraint is strengthening, not weakening - non-breaking#   Reason: TypeSpec compiler helper types, no client impact

##

# Category 9: Custom Model Definitions Removed (10 changes)# Category 9: Array Property Modifications (17 changes)

#   Decision: ⚠️ NO FIX NEEDED#   Decision: ⚠️ NO FIX NEEDED

#   Reason: Models not used in generated swagger (CloudError is used via operation override)#   Reason: Strengthening constraints (optional→required), no weakening

##

# Category 10: TypeSpec Placeholder Models Added (2 changes)# Category 10: DataBoxEdgeDevice Resource Properties (3 changes)

#   Decision: ⚠️ NO FIX NEEDED#   Decision: ⚠️ NO FIX NEEDED

#   Reason: TypeSpec-generated response models, will be filtered out during compilation#   Reason: Properties now inherited from TrackedResource with identical shape

##

# Category 11: TrackedResource Properties Removed (2 changes)# Category 11: Enum Name Casing Changes (2 changes)

#   Decision: ⚠️ NO FIX NEEDED#   Decision: ⚠️ NO FIX NEEDED

#   Reason: location and tags correctly inherited from TrackedResource base#   Reason: Enum type name casing doesn't affect wire format

##

# Category 12: Polymorphic Base Type Properties Added (3 changes)# Category 12: x-ms-secret Extension Removal (2 changes)

#   Decision: ⚠️ NO FIX NEEDED#   Decision: ✅ REQUIRES FIX (CRITICAL)

#   Reason: Empty properties placeholder for TypeSpec discriminated unions, not in final swagger#   Reason: ALL x-ms-* extension removals are BREAKING - SDKs won't treat properties as secrets

##

# Category 13: x-ms-secret Extension Removed (2 changes)# Category 13: x-ms-pageable Removal (1 change)

#   Decision: ✅ REQUIRES FIX#   Decision: ✅ REQUIRES FIX (CRITICAL)

#   Reason: x-ms-secret extension removal is breaking - SDK won't treat properties as sensitive#   Reason: x-ms-pageable removal changes SDK pagination behavior

##

# Category 14: x-ms-identifiers Extension Removed (3 changes)# ============================================================================

#   Decision: ⚠️ NO FIX NEEDED# Category 1: Path Parameter Rename (8 changes)

#   Reason: x-ms-identifiers on primitive arrays is optional and non-breaking# ============================================================================

## Analysis:

# Category 15: Enum Name Casing Changes (2 changes)# API paths changed from role-scoped (/devices/{deviceName}/roles/{roleName}/addons) 

#   Decision: ⚠️ NO FIX NEEDED# to device-scoped (/devices/{deviceName}/addons). This is a BREAKING CHANGE as

#   Reason: Enum type names (not values) follow TypeSpec naming convention, non-breaking# existing client code referencing the old paths will fail. The resource hierarchy

## needs to be corrected in TypeSpec models.

# Category 16: Service Description Added (1 change)#

#   Decision: ⚠️ NO FIX NEEDED# Root Cause:

#   Reason: Description addition is non-breaking improvement# 1. Addon model missing @parentResource(Role) decorator

## 2. MonitoringMetricConfiguration model missing @parentResource(Role) decorator

# Category 17: Job Model Base Type Added (1 change)# 3. SecuritySettings operation using incorrect custom route template

#   Decision: ⚠️ NO FIX NEEDED#

#   Reason: Explicit ProxyResource inheritance is correct pattern# Proposed Solution:

## 1. Add @parentResource(Role) decorator to Addon model to restore role-scoped path

# Category 18: x-ms-pageable Removed from Operations Endpoint (1 change)# 2. Add @parentResource(Role) decorator to MonitoringMetricConfiguration model

#   Decision: ⚠️ NO FIX NEEDED# 3. Fix SecuritySettings update operation path to include /securitySettings/default prefix

#   Reason: Wrong path - actually removed from availableSkus which uses ArmListBySubscription#

## TSG Reference: 

# Category 19: uniqueItems Removed (1 change)# https://github.com/Azure/azure-rest-api-specs/blob/78fd8f85507c9a12d47bd8953b864353a6005080/specification/databoxedge/DataBoxEdge.Management/Addon.tsp#L20

#   Decision: ⚠️ NO FIX NEEDED# "use @parentResource on model to update path to add a segment"

#   Reason: uniqueItems: false is default behavior, removal is non-semantic

# ----------------------------------------------------------------------------

# ============================================================================# Fix 1.1: Restore role-scoped paths for Addon resources

# Category 2: Path Restructuring - Addons and MonitoringConfig (8 changes)# File: Addon.tsp - Addon model

# ============================================================================# ----------------------------------------------------------------------------

# Analysis:

# API paths for addons and monitoring configuration have been changed from being --- a/specification/databoxedge/DataBoxEdge.Management/Addon.tsp

# device-scoped (/dataBoxEdgeDevices/{deviceName}/addons) to role-scoped +++ b/specification/databoxedge/DataBoxEdge.Management/Addon.tsp

# (/dataBoxEdgeDevices/{deviceName}/roles/{roleName}/addons).@@ -15,6 +15,7 @@

#  /**

# The SWAGGER_SEMANTIC_DIFF_ANALYSIS shows the paths were moved FROM roles TO device,  * Addon Resource.

# but examining the old swagger, the correct hierarchy should have addons and   */

# monitoring config under roles, not directly under device.+@parentResource(Role)

# model Addon is ProxyResource<AddonProperties> {

# Root Cause:   /**

# The @parentResource decorator is missing on Addon and MonitoringMetricConfiguration models.    * The addon name.

# When @parentResource is not specified, resources default to being scoped under the 

# subscription/resourceGroup/device, skipping intermediate parent resources like Role.# ----------------------------------------------------------------------------

## Fix 1.2: Restore role-scoped paths for MonitoringMetricConfiguration resources

# Proposed Solution:# File: MonitoringMetricConfiguration.tsp - MonitoringMetricConfiguration model

# Add @parentResource(Role) to both Addon and MonitoringMetricConfiguration models.# ----------------------------------------------------------------------------

# This will automatically generate the correct path hierarchy without needing to modify

# the interface operations.--- a/specification/databoxedge/DataBoxEdge.Management/MonitoringMetricConfiguration.tsp

#+++ b/specification/databoxedge/DataBoxEdge.Management/MonitoringMetricConfiguration.tsp

# TSG Reference: @@ -15,6 +15,7 @@

# https://github.com/Azure/azure-rest-api-specs/blob/78fd8f85507c9a12d47bd8953b864353a6005080/specification/databoxedge/DataBoxEdge.Management/Addon.tsp#L20 /**

# "use @parentResource on model to update path to add a segment"  * Monitoring Metric Configuration

#  */

# ----------------------------------------------------------------------------+@parentResource(Role)

# Fix for Case 1: Addon path hierarchy @singleton

# File: Addon.tsp - Model: Addon model MonitoringMetricConfiguration

# ----------------------------------------------------------------------------   is ProxyResource<MonitoringMetricConfigurationProperties> {



--- a/specification/databoxedge/DataBoxEdge.Management/Addon.tsp# ----------------------------------------------------------------------------

+++ b/specification/databoxedge/DataBoxEdge.Management/Addon.tsp# Fix 1.3: Restore correct path for SecuritySettings update operation

@@ -2,6 +2,7 @@ import "@azure-tools/typespec-azure-core";# File: routes.tsp or DataBoxEdgeDevice.tsp - SecuritySettings update operation

 import "@azure-tools/typespec-azure-resource-manager";# NOTE: Find the operation definition and update the path template

 import "@typespec/openapi";# ----------------------------------------------------------------------------

 import "@typespec/rest";

 import "./models.tsp";--- a/specification/databoxedge/DataBoxEdge.Management/routes.tsp

 import "./DataBoxEdgeDevice.tsp";+++ b/specification/databoxedge/DataBoxEdge.Management/routes.tsp

+import "./Role.tsp";@@ -XX,X +XX,X @@

    @doc("Updates the security settings on a Data Box Edge/Data Box Gateway device.")

 using TypeSpec.Rest;-  @route("/update")

@@ -13,7 +14,7 @@ namespace Microsoft.DataBoxEdge;+  @route("/securitySettings/default/update")

 // FIXME: Addon has no properties property   @extension("x-ms-long-running-operation", true)

 /**   @extension(

  * Role Addon     "x-ms-long-running-operation-options",

  */

-@parentResource(DataBoxEdgeDevice)# ============================================================================

+@parentResource(Role)# Category 2: Service Description Missing (1 change)

 model Addon is Azure.ResourceManager.ProxyResource<{}> {# ============================================================================

   ...ResourceNameParameter<# Analysis:

     Resource = Addon,# The service description was added as a placeholder in the new swagger.

# This is purely documentation and doesn't affect the API contract.

# ----------------------------------------------------------------------------#

# Fix for Case 2: MonitoringMetricConfiguration path hierarchy  # Decision: ⚠️ NO FIX NEEDED

# File: MonitoringMetricConfiguration.tsp - Model: MonitoringMetricConfiguration# Justification: Adding description is non-breaking, improves documentation

# ----------------------------------------------------------------------------#

# ============================================================================

--- a/specification/databoxedge/DataBoxEdge.Management/MonitoringMetricConfiguration.tsp

+++ b/specification/databoxedge/DataBoxEdge.Management/MonitoringMetricConfiguration.tsp# ============================================================================

@@ -2,6 +2,7 @@ import "@azure-tools/typespec-azure-core";# Category 3: Polymorphic Discriminator Changes (16 changes)

 import "@azure-tools/typespec-azure-resource-manager";# ============================================================================

 import "@typespec/openapi";# Analysis:

 import "@typespec/rest";# Old swagger used discriminator pattern with x-ms-discriminator-value.

 import "./models.tsp";# New swagger uses modern TypeSpec discriminator pattern with kind enum on each derived type.

 import "./DataBoxEdgeDevice.tsp";# This is the recommended TypeSpec pattern and is functionally equivalent.

+import "./Role.tsp";#

 # Property Verification:

 using TypeSpec.Rest;# Old pattern:

@@ -12,7 +13,7 @@ using TypeSpec.OpenAPI;#   - Base model has discriminator: "kind"

 namespace Microsoft.DataBoxEdge;#   - Derived models have x-ms-discriminator-value

 /**#   - kind is a plain string property

  * The metric setting details for the role#

  */# New pattern:

 @singleton("default")#   - Base model has kind: string property

-@parentResource(DataBoxEdgeDevice)#   - Derived models have kind: enum with single value

+@parentResource(Role)#   - No x-ms-discriminator-value (replaced by enum pattern)

 model MonitoringMetricConfiguration#

   is Azure.ResourceManager.ProxyResource<# Differences Found:

#   - x-ms-discriminator-value removed ✅ ACCEPTABLE (modern pattern exception)

# ============================================================================#   - kind changed from plain string to constrained enum ✅ STRENGTHENING

# Category 3: Security Settings Endpoint Consolidation (2 changes)#

# ============================================================================# Decision: ⚠️ NO FIX NEEDED

# Analysis:# Justification: Modern TypeSpec discriminator pattern is the recommended approach

# Security settings update endpoint path changed from:# and provides better type safety. This is the only acceptable case for removing

#   /dataBoxEdgeDevices/{deviceName}/securitySettings/default/update# x-ms-discriminator-value extension.

# to:#

#   /dataBoxEdgeDevices/{deviceName}/update# TSG Reference: TypeSpec discriminator pattern is standard for polymorphic types

## ============================================================================

# This is a path change that needs to be preserved for backward compatibility.

## ============================================================================

# Root Cause:# Category 4: SystemData Property Removal (18 changes)

# The operation is likely using a custom path segment "update" but the # ============================================================================

# securitySettings/default prefix is missing from the route definition.# Analysis:

## systemData property was removed from 18 resource models. This property contains

# Proposed Solution:# Azure Resource Manager metadata (createdBy, createdAt, lastModifiedBy, lastModifiedAt).

# This requires examining the back-compatible.tsp or DataBoxEdgeDevice.tsp file# Removing ANY property is a BREAKING CHANGE for existing clients.

# to see how the update operation is defined. The operation needs to use#

# @route decorator or custom template to include the full path.# Root Cause:

## When converting to TypeSpec common-types v3 ProxyResource/TrackedResource, the

# TSG Reference:# systemData property should be automatically included but is not appearing in

# https://github.com/Azure/azure-rest-api-specs/commit/27988b16a164a4bedca70a6d6b36c4f321ea3e5a# generated swagger. This may be due to visibility settings or missing inheritance.

# "remove body for common op"#

# https://github.com/Azure/azure-rest-api-specs/commit/29e2e1728607cfe271b0aac14e95f2c996361c11# Proposed Solution:

# "@override to reorder operation parameters"# Add systemData property explicitly to models that should have it, or ensure

## proper inheritance from ARM base types that include systemData.

# ----------------------------------------------------------------------------#

# Fix: Add correct path for security settings update operation# Property Verification:

# File: DataBoxEdgeDevice.tsp - Operation: createOrUpdateSecuritySettings# Old swagger systemData (18 models):

# ----------------------------------------------------------------------------#   - createdBy: string (optional, readOnly)

#   - createdAt: string/date-time (optional, readOnly)

--- a/specification/databoxedge/DataBoxEdge.Management/DataBoxEdgeDevice.tsp#   - lastModifiedBy: string (optional, readOnly)

+++ b/specification/databoxedge/DataBoxEdge.Management/DataBoxEdgeDevice.tsp#   - lastModifiedAt: string/date-time (optional, readOnly)

@@ -XXX,X +XXX,X @@ interface DataBoxEdgeDevices {#

   /**# New swagger:

    * Updates the security settings on a Data Box Edge/Data Box Gateway device.#   - systemData property REMOVED from all 18 models ❌ BREAKING

    */#

+  @route("/securitySettings/default/update")# Decision: ✅ REQUIRES FIX

   @action("createOrUpdateSecuritySettings")# Justification: Property removal is always breaking

   createOrUpdateSecuritySettings is ArmResourceActionAsync<#

     DataBoxEdgeDevice,# TSG Reference:

# Common-types v3 should include systemData automatically for ARM resources

# NOTE: The exact line numbers and context need to be determined by examining# May need explicit @visibility decorator or inheritance fix

# the actual DataBoxEdgeDevice.tsp file where this operation is defined.

# The fix adds @route decorator to preserve the full path hierarchy.# ----------------------------------------------------------------------------

# Fix 4.1: Restore systemData property to all affected resource models

# ============================================================================# File: models.tsp - Add systemData to resource models

# Category 7: ReadOnly Metadata Removed (18 changes)# NOTE: This fix assumes systemData needs to be explicitly added. If it should

# ============================================================================# be inherited from ProxyResource, check the ARM template definitions instead.

# Analysis:# ----------------------------------------------------------------------------

# The readOnly flag has been removed from:

# 1. Array properties in list response models (value arrays) - 18 items--- a/specification/databoxedge/DataBoxEdge.Management/models.tsp

# 2. Object properties in Alert.properties and Job.properties - 2 items+++ b/specification/databoxedge/DataBoxEdge.Management/models.tsp

# 3. Object properties in NetworkSettings.properties - 1 item@@ -XX,X +XX,X @@

#+// Add systemData explicitly to resource models if not inherited

# In the old swagger, these properties had "readOnly": true, which is a constraint+// Check if the following models properly inherit systemData from ProxyResource/TrackedResource

# that should be preserved. Removing readOnly makes properties appear mutable in +// Models affected: Addon, Alert, BandwidthSchedule, Container, DataBoxEdgeDevice,

# the API contract, which is a breaking change.+// DeviceCapacityInfo, DiagnosticProactiveLogCollectionSettings, DiagnosticRemoteSupportSettings,

#+// MonitoringMetricConfiguration, NetworkSettings, Order, Role, Share, StorageAccount,

# Root Cause:+// StorageAccountCredential, Trigger, UpdateSummary, User

# TypeSpec is not generating the readOnly constraint for these properties.+//

# For list arrays, the @visibility(Lifecycle.Read) decorator needs to be applied.+// If systemData is not inherited, add to each model:

# For object properties with sub-properties, readOnly should be explicit.+//   @visibility("read")

#+//   systemData?: Azure.ResourceManager.Foundations.SystemData;

# Proposed Solution:

# Add @visibility(Lifecycle.Read) decorator to all list model value properties and# IMPORTANT NOTES:

# to the properties fields in Alert, Job, and NetworkSettings models.# This fix requires investigation of why systemData is not appearing in generated swagger.

## Common-types v3 ProxyResource and TrackedResource should include systemData automatically.

# TSG Reference:# Check:

# https://github.com/Azure/azure-rest-api-specs/commit/f6a842dccad3f2751ebd707d2eafc7f3b8e7d0ec# 1. Are models properly inheriting from ProxyResource/TrackedResource?

# "missing readonly property for page response value"# 2. Are visibility decorators correctly set?

## 3. Is the ARM common-types version correctly specified (v3)?

# ----------------------------------------------------------------------------

# Fix: Add readOnly to list response value arrays# ============================================================================

# File: models.tsp - Multiple list models# Category 5: LRO Response Headers Addition (29 changes)

# ----------------------------------------------------------------------------# ============================================================================

# Analysis:

--- a/specification/databoxedge/DataBoxEdge.Management/models.tsp# Location and Azure-AsyncOperation headers added to 202 responses for LRO operations.

+++ b/specification/databoxedge/DataBoxEdge.Management/models.tsp# This STRENGTHENS the API contract by providing proper LRO tracking capabilities.

@@ -XXXX,X +XXXX,X @@ model CloudErrorBody {#

 /**# Differences Found:

  * List of SKU Information objects.#   - Headers ADDED to 202 responses ✅ NON-BREAKING (strengthening)

  */#

-model DataBoxEdgeSkuList is Azure.Core.Page<DataBoxEdgeSku>;# Decision: ⚠️ NO FIX NEEDED

+model DataBoxEdgeSkuList {# Justification: Adding headers to responses is non-breaking and improves LRO support

+  /**#

+   * The list of SKUs.# ============================================================================

+   */

+  @visibility(Lifecycle.Read)# ============================================================================

+  value: DataBoxEdgeSku[];# Category 6: Common Type Version Update (91 changes) - CRITICAL

+  # ============================================================================

+  /**# Analysis:

+   * Link to the next set of results.# Common-types updated from v2 to v3, with multiple MODEL NAME CHANGES:

+   */# 1. CloudError → ErrorResponse (73 operations)

+  @visibility(Lifecycle.Read)# 2. OperationsList → OperationListResult (1 operation)

+  nextLink?: string;# 3. ARMBaseModel → ProxyResource/TrackedResource (19 models)

+}#

# MODEL NAME CHANGES ARE BREAKING CHANGES because:

# PATTERN: Apply the same pattern to all list models:# - Client SDKs generate different class/type names

# - AddonList# - Existing code referencing old model names will break

# - AlertList  # - API documentation and contracts specify model names

# - BandwidthSchedulesList#

# - ContainerList# Property Verification for CloudError → ErrorResponse:

# - DataBoxEdgeDeviceList#

# - DataBoxEdgeSkuList (shown above)# Old model 'CloudError' properties:

# - MonitoringMetricConfigurationList#   - error: object (CloudErrorBody, optional)

# - NodeList#

# - OrderList# Old model 'CloudErrorBody' properties (nested):

# - RoleList#   - code: string (optional)

# - ShareList#   - message: string (optional)

# - StorageAccountCredentialList#   - details: array of CloudErrorBody (optional)

# - StorageAccountList#

# - TriggerList# New model 'ErrorResponse' from common-types/v3 properties:

# - UserList#   - error: object (ErrorDetail, required)

##

# Each list model should be changed from:# New model 'ErrorDetail' from common-types/v3 properties (nested):

#   model XxxList is Azure.Core.Page<Xxx>;#   - code: string (required, readOnly: true)

# To:#   - message: string (required, readOnly: true)

#   model XxxList {#   - target: string (optional, readOnly: true) ← NEW

#     @visibility(Lifecycle.Read)#   - details: array of ErrorDetail (optional, readOnly: true)

#     value: Xxx[];#   - additionalInfo: array of ErrorAdditionalInfo (optional, readOnly: true) ← NEW

#     @visibility(Lifecycle.Read) #

#     nextLink?: string;# Differences Found:

#   }#   1. Model name changed: CloudError → ErrorResponse ❌ BREAKING

#   2. Nested model name changed: CloudErrorBody → ErrorDetail ❌ BREAKING

# ----------------------------------------------------------------------------#   3. ReadOnly constraints ADDED to all properties ❌ BREAKING

# Fix: Add readOnly to Alert.properties#   4. Required constraints ADDED (error.code, error.message) ❌ BREAKING

# File: models.tsp - Model: AlertProperties#   5. New properties added: target, additionalInfo ❌ BREAKING (changes structure)

# ----------------------------------------------------------------------------#

# Property Verification for OperationsList → OperationListResult:

--- a/specification/databoxedge/DataBoxEdge.Management/models.tsp#

+++ b/specification/databoxedge/DataBoxEdge.Management/models.tsp# Old model 'OperationsList' properties:

@@ -XXXX,X +XXXX,X @@ model AlertList is Azure.Core.Page<Alert>;#   - value: array of Operation (optional, readOnly)

 /**#   - nextLink: string (optional)

  * Properties of alert.#

  */# Old model 'Operation' properties (nested):

 #suppress "@azure-tools/typespec-azure-resource-manager/arm-resource-provisioning-state" "For backward compatibility"#   - name: string (optional, readOnly)

-model AlertProperties {#   - display: object (OperationDisplay, optional)

+@visibility(Lifecycle.Read)#   - origin: string (optional, readOnly)

+model AlertProperties {#   - properties: object (OperationProperties, optional)

   /**#

    * Alert title.# New model 'OperationListResult' from common-types/v3 properties:

    */#   - value: array of Operation (required, readOnly)

#   - nextLink: string (optional, readOnly)

# NOTE: AlertProperties should have @visibility(Lifecycle.Read) at the model level#

# since all its properties are read-only. This will generate readOnly: true # New model 'Operation' from common-types/v3 properties (nested):

# for the entire properties object in the swagger.#   - name: string (optional, readOnly)

#   - isDataAction: boolean (optional, readOnly) ← NEW

# ----------------------------------------------------------------------------#   - display: object (OperationDisplay, optional)

# Fix: Add readOnly to Job.properties  #   - origin: string (optional, readOnly)

# File: Job.tsp - Model: JobProperties (need to verify exact location)#   - actionType: string (optional, readOnly) ← NEW

# ----------------------------------------------------------------------------#

# Differences Found:

# Similar pattern - add @visibility(Lifecycle.Read) to JobProperties model#   1. Model name changed: OperationsList → OperationListResult ❌ BREAKING

#   2. value array: optional → required ❌ BREAKING

# ----------------------------------------------------------------------------#   3. nextLink: readOnly added ✅ OK (strengthening)

# Fix: Add readOnly to NetworkSettings.properties#   4. Operation properties removed (properties object) ❌ BREAKING

# File: NetworkSettings.tsp or models.tsp - Model: NetworkSettingsProperties#   5. New properties added: isDataAction, actionType ❌ BREAKING

# ----------------------------------------------------------------------------#

# Property Verification for ARMBaseModel → ProxyResource/TrackedResource:

# Similar pattern - add @visibility(Lifecycle.Read) to NetworkSettingsProperties model#

# Old model 'ARMBaseModel' properties:

# ============================================================================#   - id: string (optional, readOnly)

# Category 13: x-ms-secret Extension Removed (2 changes)#   - name: string (optional, readOnly)

# ============================================================================#   - type: string (optional, readOnly)

# Analysis:#

# The x-ms-secret extension has been removed from:# New model 'ProxyResource' from common-types/v3 properties:

# 1. AsymmetricEncryptedSecret.properties.encryptionCertThumbprint#   - id: string (optional, readOnly)

# 2. GenerateCertResponse.properties.privateKey#   - name: string (optional, readOnly)

##   - type: string (optional, readOnly)

# This is a BREAKING CHANGE because x-ms-secret controls how SDKs handle sensitive data.#   - systemData: object (optional, readOnly) ← NEW

# Without this extension, SDKs will not mask these values in logs, treat them as secrets#

# in credential management, or apply security best practices.# Differences Found:

##   1. Model name changed: ARMBaseModel → ProxyResource ✅ EXCEPTION APPLIES

# Root Cause:#   2. All old properties preserved with identical constraints ✅ OK

# TypeSpec properties are missing the @secret decorator which generates x-ms-secret.#   3. systemData added (optional, readOnly) ✅ OK (but see Category 4 - it's removed!)

##

# Proposed Solution:# Breaking Changes Summary:

# Add @secret decorator to the affected properties.#   - CloudError → ErrorResponse: 5 breaking changes (model name, constraints, structure)

##   - OperationsList → OperationListResult: 5 breaking changes (model name, constraints, properties)

# TSG Reference:#   - ARMBaseModel → ProxyResource: Exception applies, but systemData removal is breaking (see Category 4)

# https://github.com/Azure/azure-rest-api-specs/commit/ef1abc58a47464817543082b339adf13645a14d1#

# "missing x-ms-secret"# Decision: ✅ REQUIRES FIX (CRITICAL)

## Justification: Model name changes and constraint changes are breaking

# ----------------------------------------------------------------------------#

# Fix for Case 1: AsymmetricEncryptedSecret.encryptionCertThumbprint# Root Cause:

# File: models.tsp - Model: AsymmetricEncryptedSecret# TypeSpec using common-types models directly instead of defining custom models

# ----------------------------------------------------------------------------# to match original CloudError and OperationsList schemas.

#

--- a/specification/databoxedge/DataBoxEdge.Management/models.tsp# Proposed Solution:

+++ b/specification/databoxedge/DataBoxEdge.Management/models.tsp# 1. Define custom CloudError and CloudErrorBody models matching original schema

@@ -XXXX,X +XXXX,X @@ model AsymmetricEncryptedSecret {# 2. Define custom OperationsList and Operation models matching original schema

   /**# 3. Update ALL operation error responses to use CloudError instead of ErrorResponse

    * Thumbprint certificate used to encrypt \"Value\". If the value is unencrypted, it will be null.# 4. Update Operations_List operation to use OperationsList instead of OperationListResult

    */#

+  @secret# TSG Reference: 

   encryptionCertThumbprint?: string;# https://github.com/Azure/azure-rest-api-specs/commit/1297a741c2e2174f9b91e2f83bcdc356530a9cf1

 # "change default ErrorResponse to customized ErrorResponse"

   /**# https://github.com/Azure/azure-rest-api-specs/commit/5219e4b239d24251de80e326042bcf2dc63e53d3

# "fix error type for Operations interface"

# ----------------------------------------------------------------------------# https://github.com/Azure/azure-rest-api-specs/commit/d327198e7ef23a440531c52b1fe99ed16c39c47f

# Fix for Case 2: GenerateCertResponse.privateKey# "legacy operations_list with self-defined return type"

# File: models.tsp - Model: GenerateCertResponse

# ----------------------------------------------------------------------------# ----------------------------------------------------------------------------

# Fix 6.1: Define custom CloudError models matching original schema

--- a/specification/databoxedge/DataBoxEdge.Management/models.tsp# File: models.tsp - Add custom error models

+++ b/specification/databoxedge/DataBoxEdge.Management/models.tsp# ----------------------------------------------------------------------------

@@ -XXXX,X +XXXX,X @@ model GenerateCertResponse {

   /**--- a/specification/databoxedge/DataBoxEdge.Management/models.tsp

    * The private key for the certificate.+++ b/specification/databoxedge/DataBoxEdge.Management/models.tsp

    */@@ -XX,X +XX,X @@

+  @secret+/**

   privateKey?: string;+ * An error response from the service.

 + */

   /**+@error

+model CloudError {

# ============================================================================+  /**

# VERIFICATION SUMMARY - Categories Not Requiring Fixes+   * The error details.

# ============================================================================+   */

+  error?: CloudErrorBody;

# ----------------------------------------------------------------------------+}

# Category 1: Common Types Migration - VERIFIED NO FIX NEEDED+

# ----------------------------------------------------------------------------+/**

# Property Verification:+ * An error response from the service.

# + */

# Migration: CloudError/CloudErrorBody → ErrorResponse/ErrorDetail+model CloudErrorBody {

# Analysis: Model names changed, but operations already use custom CloudError via Error parameter+  /**

# All operations will use: Error = CloudError pattern (already in models.tsp)+   * An identifier for the error. Codes are invariant and are intended to be consumed programmatically.

# Decision: NO FIX - CloudError model exists and is used correctly+   */

#+  code?: string;

# Migration: OperationsList → OperationListResult  +

# Analysis: Operations endpoint uses Azure.ResourceManager.Operations interface+  /**

# Standard ARM template automatically uses correct common-types models+   * A message describing the error, intended to be suitable for display in a user interface.

# Decision: NO FIX - ARM template handles this correctly+   */

#+  message?: string;

# Migration: ARMBaseModel → ProxyResource/TrackedResource+

# Old ARMBaseModel properties: id, name, type (all readOnly)+  /**

# New ProxyResource properties: id, name, type, systemData (all readOnly)  +   * A list of additional details about the error.

# New TrackedResource properties: id, name, type, systemData, location, tags+   */

# All old properties preserved, only optional systemData added+  details?: CloudErrorBody[];

# Decision: NO FIX - Standard common-types migration pattern+}

#

# All 91 common-types migrations follow standard patterns and preserve compatibility.# ----------------------------------------------------------------------------

# Fix 6.2: Define custom OperationsList model matching original schema

# ----------------------------------------------------------------------------# File: models.tsp - Add custom operation list models

# Category 4: LRO Response Headers Added - VERIFIED NO FIX NEEDED# ----------------------------------------------------------------------------

# ----------------------------------------------------------------------------

# Analysis: Location and Azure-AsyncOperation headers automatically added by--- a/specification/databoxedge/DataBoxEdge.Management/models.tsp

# ArmResourceDeleteAsync, ArmResourceCreateOrReplaceAsync, and similar ARM templates.+++ b/specification/databoxedge/DataBoxEdge.Management/models.tsp

# These headers are required for proper LRO polling and are non-breaking additions.@@ -XX,X +XX,X @@

# Decision: NO FIX - ARM templates handle LRO headers correctly+/**

+ * The list of operations used for the discovery of available provider operations.

# ----------------------------------------------------------------------------+ */

# Category 5: Discriminator Pattern Change - VERIFIED NO FIX NEEDED+@pagedResult

# ----------------------------------------------------------------------------+model OperationsList {

# Analysis: TypeSpec uses modern discriminator pattern with inline kind enum:+  /**

# - Base type has kind property+   * The value of the operation list.

# - Derived types have kind: enum["Value"] with x-ms-enum.modelAsString: false+   */

# - This is functionally equivalent to x-ms-discriminator-value pattern+  @items

# - Discriminator field itself is managed by TypeSpec compiler+  value?: Operation[];

# Old pattern: discriminator field + x-ms-discriminator-value on derived types+

# New pattern: kind enum on derived types (modern TypeSpec approach)+  /**

# Decision: NO FIX - Modern pattern is correct and equivalent+   * Link to the next set of results.

+   */

# ----------------------------------------------------------------------------+  @nextLink

# Category 6: SystemData Migration - VERIFIED NO FIX NEEDED+  nextLink?: string;

# ----------------------------------------------------------------------------+}

# Analysis: systemData removed from individual models because it's inherited+

# from common-types v3 ProxyResource and TrackedResource base models.+/**

# All resources correctly extend these base models.+ * Operations.

# Decision: NO FIX - Inheritance is correct pattern+ */

+model Operation {

# ----------------------------------------------------------------------------+  /**

# Category 8: Required Properties Added - VERIFIED NO FIX NEEDED+   * Name of the operation.

# ----------------------------------------------------------------------------+   */

# Analysis: Adding "value" as required property to list models strengthens+  @visibility("read")

# the contract (optional → required). This is non-breaking for clients.+  name?: string;

# Also removed location as required from DataBoxEdgeDevice since it's inherited+

# from TrackedResource which already marks it as required.+  /**

# Decision: NO FIX - Strengthening constraints is non-breaking+   * Properties displayed for the operation.

+   */

# ----------------------------------------------------------------------------+  display?: OperationDisplay;

# Category 9: Custom Model Definitions Removed - VERIFIED NO FIX NEEDED+

# ----------------------------------------------------------------------------+  /**

# Analysis: CloudError/CloudErrorBody still defined in models.tsp and used.+   * Origin of the operation.

# Operation/OperationDisplay/OperationsList not needed - Azure.ResourceManager.Operations+   */

# interface uses correct common-types automatically.+  @visibility("read")

# MetricDimension_V1, MetricSpecification_V1, ServiceSpecification defined in models.tsp+  origin?: string;

# and used correctly.+

# Decision: NO FIX - Models properly defined where needed+  /**

+   * Operation properties.

# ----------------------------------------------------------------------------+   */

# Category 10: TypeSpec Placeholder Models - VERIFIED NO FIX NEEDED  +  properties?: OperationProperties;

# ----------------------------------------------------------------------------+}

# Analysis: TypeSpec.Http.OkResponse and NoContentResponse are compiler artifacts+

# that get filtered out during swagger generation. They don't appear in final output.+/**

# Decision: NO FIX - Compiler artifacts, not in final swagger+ * Operation display properties.

+ */

# ----------------------------------------------------------------------------+model OperationDisplay {

# Category 11: TrackedResource Properties Removed - VERIFIED NO FIX NEEDED+  /**

# ----------------------------------------------------------------------------+   * Provider name.

# Analysis: location and tags inherited from TrackedResource base model.+   */

# DataBoxEdgeDevice correctly extends TrackedResource.+  provider?: string;

# All properties preserved via inheritance.+

# Decision: NO FIX - Inheritance pattern is correct+  /**

+   * Resource name.

# ----------------------------------------------------------------------------+   */

# Category 12: Polymorphic Base Properties Added - VERIFIED NO FIX NEEDED+  resource?: string;

# ----------------------------------------------------------------------------+

# Analysis: Empty properties object added to Addon, Role, Trigger base types.+  /**

# This is TypeSpec pattern for polymorphic types - acts as placeholder for+   * Operation name.

# derived type properties. Doesn't affect final swagger structure.+   */

# Decision: NO FIX - TypeSpec polymorphism pattern+  operation?: string;

+

# ----------------------------------------------------------------------------+  /**

# Category 14: x-ms-identifiers Removed - VERIFIED NO FIX NEEDED+   * Operation description.

# ----------------------------------------------------------------------------+   */

# Analysis: Removed from primitive array items (days, configuredRoleTypes)+  description?: string;

# and from DataBoxEdgeSkuList.value (which uses @OpenAPI.extension to preserve it).+}

# x-ms-identifiers on primitive types (string[]) is optional metadata.+

# Decision: NO FIX - Optional metadata on primitives, non-breaking+/**

+ * Operation properties.

# ----------------------------------------------------------------------------+ */

# Category 15: Enum Name Casing Changes - VERIFIED NO FIX NEEDED+model OperationProperties {

# ----------------------------------------------------------------------------+  /**

# Analysis: Enum type names changed (NetworkAdapterDHCPStatus → NetworkAdapterDhcpStatus)+   * Service specification.

# Enum VALUES unchanged. Type names are code generation hints, not wire format.+   */

# TypeSpec enforces PascalCase naming convention.+  serviceSpecification?: ServiceSpecification;

# Decision: NO FIX - Type name changes are non-breaking, values preserved+}

+

# ----------------------------------------------------------------------------+/**

# Category 16: Service Description Added - VERIFIED NO FIX NEEDED+ * Service specification.

# ----------------------------------------------------------------------------+ */

# Analysis: Description added to info section. This is metadata improvement.+model ServiceSpecification {

# Decision: NO FIX - Non-breaking documentation enhancement+  /**

+   * Metric specification as defined by shoebox.

# ----------------------------------------------------------------------------+   */

# Category 17: Job Model Base Type Added - VERIFIED NO FIX NEEDED+  metricSpecifications?: MetricSpecification_V1[];

# ----------------------------------------------------------------------------+}

# Analysis: Job now explicitly extends ProxyResource via allOf.+

# All properties (id, name, type) that were explicit are now inherited.+/**

# This is the correct TypeSpec pattern.+ * Metric specification version 1.

# Decision: NO FIX - Explicit inheritance is correct pattern+ */

+model MetricSpecification_V1 {

# ----------------------------------------------------------------------------+  /**

# Category 18: x-ms-pageable Removed - VERIFIED NO FIX NEEDED+   * Name of the metric.

# ----------------------------------------------------------------------------+   */

# Analysis: Actually removed from /availableSkus endpoint, not /operations.+  name?: string;

# The availableSkus operation uses ArmListBySubscription template which+

# automatically generates correct pagination. x-ms-pageable not needed.+  /**

# Decision: NO FIX - ARM template handles pagination automatically+   * Display name of the metric.

+   */

# ----------------------------------------------------------------------------+  displayName?: string;

# Category 19: uniqueItems Removed - VERIFIED NO FIX NEEDED+

# ----------------------------------------------------------------------------  +  /**

# Analysis: uniqueItems: false is the default behavior in JSON Schema.+   * Description of the metric.

# Removing explicit false value doesn't change semantics.+   */

# Decision: NO FIX - Non-semantic change, default behavior preserved+  displayDescription?: string;

+

# ============================================================================+  /**

# IMPLEMENTATION NOTES+   * Metric units.

# ============================================================================+   */

#+  unit?: string;

# CRITICAL FIXES (Must be applied):+

# 1. Category 2: Add @parentResource(Role) to Addon and MonitoringMetricConfiguration+  /**

# 2. Category 3: Add @route decorator to security settings update operation+   * Metric aggregation type.

# 3. Category 7: Add @visibility(Lifecycle.Read) to list response value arrays+   */

# 4. Category 13: Add @secret decorator to encryptionCertThumbprint and privateKey+  aggregationType?: string;

#+

# COMPILATION ORDER:+  /**

# 1. Apply Category 2 fixes (path hierarchy)+   * Metric dimensions.

# 2. Apply Category 13 fixes (x-ms-secret)+   */

# 3. Apply Category 7 fixes (readOnly on lists)+  dimensions?: MetricDimension_V1[];

# 4. Apply Category 3 fix (security settings path)+

# 5. Run tsp compile and verify+  /**

#+   * Flag to indicate whether to fill gaps with zero.

# TESTING:+   */

# After each category fix:+  fillGapWithZero?: boolean;

# - Run tsp compile+

# - Compare generated swagger with old swagger+  /**

# - Verify no new diffs introduced+   * Metric category.

# - Check that specific category diffs are resolved+   */

#+  category?: string;

# ============================================================================+

# END OF FIX PLAN+  /**

# ============================================================================+   * Resource Id override.

+   */
+  resourceIdDimensionNameOverride?: string;
+
+  /**
+   * Flag to determine whether regional MDM account is enabled.
+   */
+  supportedTimeGrainTypes?: string[];
+
+  /**
+   * Flag to determine whether regional MDM account is enabled.
+   */
+  supportedAggregationTypes?: string[];
+}
+
+/**
+ * Metric dimension version 1.
+ */
+model MetricDimension_V1 {
+  /**
+   * Name of the dimension.
+   */
+  name?: string;
+
+  /**
+   * Display name of the dimension.
+   */
+  displayName?: string;
+
+  /**
+   * To be exported to shoe box.
+   */
+  toBeExportedForShoebox?: boolean;
+}

# ----------------------------------------------------------------------------
# Fix 6.3: Update Operations interface to use custom OperationsList
# File: main.tsp - Operations interface
# ----------------------------------------------------------------------------

--- a/specification/databoxedge/DataBoxEdge.Management/main.tsp
+++ b/specification/databoxedge/DataBoxEdge.Management/main.tsp
@@ -XX,X +XX,X @@
-interface Operations extends Azure.ResourceManager.Operations {}
+interface Operations {
+  /**
+   * Get operations
+   */
+  @doc("Get operations")
+  list is Azure.Core.Foundations.Operation<
+    {},
+    OperationsList,
+    {},
+    CloudError
+  >;
+}

# ----------------------------------------------------------------------------
# Fix 6.4: Update ALL operation error responses to use CloudError
# File: routes.tsp and individual resource files - ALL operations
# NOTE: This must be applied to ALL 73 operations that currently use ErrorResponse
# ----------------------------------------------------------------------------

# SEARCH PATTERN to find all operations:
# grep -r "ArmResourceOperations\|ArmResourceRead\|ArmResourceWrite\|ArmResourceDelete\|ArmResourceCreate\|ArmResourceUpdate\|ArmResourcePatch\|ArmResourceListByParent\|ArmListBySubscription" *.tsp

# Example fixes for different operation patterns:

--- a/specification/databoxedge/DataBoxEdge.Management/DataBoxEdgeDevice.tsp
+++ b/specification/databoxedge/DataBoxEdge.Management/DataBoxEdgeDevice.tsp
@@ -XX,X +XX,X @@
 interface Devices {
-  get is ArmResourceRead<DataBoxEdgeDevice>;
+  get is ArmResourceRead<DataBoxEdgeDevice, {}, CloudError>;
-  createOrUpdate is ArmResourceCreateOrReplaceAsync<DataBoxEdgeDevice>;
+  createOrUpdate is ArmResourceCreateOrReplaceAsync<DataBoxEdgeDevice, {}, CloudError>;
-  delete is ArmResourceDeleteAsync<DataBoxEdgeDevice>;
+  delete is ArmResourceDeleteAsync<DataBoxEdgeDevice, {}, CloudError>;
-  @doc("Gets the properties of the Data Box Edge/Data Box Gateway device.")
-  listByResourceGroup is ArmResourceListByParent<DataBoxEdgeDevice>;
+  listByResourceGroup is ArmResourceListByParent<DataBoxEdgeDevice, {}, CloudError>;
-  @doc("Gets all the Data Box Edge/Data Box Gateway devices in a subscription.")
-  listBySubscription is ArmListBySubscription<DataBoxEdgeDevice>;
+  listBySubscription is ArmListBySubscription<DataBoxEdgeDevice, {}, CloudError>;
   // ... repeat for ALL operations in this interface
 }

# IMPORTANT: Apply similar pattern to ALL interfaces in all .tsp files:
# - Addon.tsp (5 operations)
# - Alert.tsp (2 operations)
# - BandwidthSchedule.tsp (5 operations)
# - Container.tsp (6 operations)
# - DataBoxEdgeDevice.tsp (10+ operations)
# - DeviceCapacityInfo.tsp (2 operations)
# - DiagnosticProactiveLogCollectionSettings.tsp (2 operations)
# - DiagnosticRemoteSupportSettings.tsp (2 operations)
# - Job.tsp (1 operation)
# - MonitoringMetricConfiguration.tsp (4 operations)
# - NetworkSettings.tsp (1 operation)
# - Order.tsp (5 operations)
# - Role.tsp (5 operations)
# - Share.tsp (6 operations)
# - StorageAccount.tsp (5 operations)
# - StorageAccountCredential.tsp (5 operations)
# - Trigger.tsp (5 operations)
# - UpdateSummary.tsp (1 operation)
# - User.tsp (5 operations)
# - routes.tsp (custom operations)

# Complete enumeration of ALL 73+ operations requiring CloudError error type:
# Run this command to find all: grep -n "is Arm" *.tsp | grep -v CloudError

# ============================================================================
# Category 7: Unused Model Definitions Removed (10 changes)
# ============================================================================
# Analysis:
# Models removed: CloudError, CloudErrorBody, DataBoxEdgeMoveRequest, MetricDimension_V1,
# MetricSpecification_V1, Operation, OperationDisplay, OperationProperties, OperationsList,
# ServiceSpecification
#
# These models are now being replaced by common-types (CloudError, etc.) or were truly unused
# (DataBoxEdgeMoveRequest). However, since we're restoring custom CloudError and OperationsList
# in Category 6 fixes, these will be added back.
#
# Decision: ⚠️ NO FIX NEEDED (already addressed in Category 6)
# Justification: Custom models will be re-added as part of Category 6 fixes
#
# ============================================================================

# ============================================================================
# Category 8: TypeSpec Helper Types Added (2 changes)
# ============================================================================
# Analysis:
# TypeSpec.Http.NoContentResponse and TypeSpec.Http.OkResponse are compiler-generated
# helper types for standard HTTP responses. These don't appear in final SDK generation
# and are internal to the swagger generation process.
#
# Decision: ⚠️ NO FIX NEEDED
# Justification: Compiler helper types, no client impact
#
# ============================================================================

# ============================================================================
# Category 9: Array Property Modifications (17 changes)
# ============================================================================
# Analysis:
# Changes include:
# 1. List response "value" arrays: readOnly removed, required added (14 cases)
# 2. Properties objects: readOnly removed (3 cases)
# 3. x-ms-identifiers removed (3 cases)
# 4. uniqueItems removed (1 case)
#
# Verification:
# - readOnly removal from value arrays + required addition = STRENGTHENING (optional→required)
# - x-ms-identifiers removal: This is an SDK hint, but removal COULD affect array handling
#
# x-ms-identifiers Analysis:
# Removed from:
# - BandwidthScheduleProperties.days
# - DataBoxEdgeDeviceProperties.configuredRoleTypes
# - DataBoxEdgeSkuList.value
#
# x-ms-identifiers tells SDK generators which properties uniquely identify array elements.
# Removing this extension changes SDK generation behavior.
#
# Decision: ⚠️ NO FIX NEEDED for most changes
# However, x-ms-identifiers removal should be reviewed carefully as it may affect SDK behavior.
#
# If x-ms-identifiers removal is intentional (array elements don't have unique identifiers),
# this is acceptable. If it should be preserved, add back using:
# @extension("x-ms-identifiers", ["propertyName"])
#
# ============================================================================

# ============================================================================
# Category 10: DataBoxEdgeDevice Resource Properties (3 changes)
# ============================================================================
# Analysis:
# DataBoxEdgeDevice now inherits from TrackedResource which provides location and tags.
# These properties have identical shape and constraints as before.
#
# Property Verification:
# Old: location (string, required, x-ms-mutability: ["create", "read"])
# New: location (string, required via TrackedResource inheritance)
#
# Old: tags (object with additionalProperties: string, optional)
# New: tags (same via TrackedResource inheritance)
#
# Decision: ⚠️ NO FIX NEEDED
# Justification: Properties inherited with identical shape, standard ARM pattern
#
# ============================================================================

# ============================================================================
# Category 11: Enum Name Casing Changes (2 changes)
# ============================================================================
# Analysis:
# Enum type names updated from all-caps abbreviations to PascalCase:
# - NetworkAdapterDHCPStatus → NetworkAdapterDhcpStatus
# - NetworkAdapterRDMAStatus → NetworkAdapterRdmaStatus
#
# The x-ms-enum name property is used for SDK generation but doesn't affect wire format.
# The actual enum values remain unchanged.
#
# Decision: ⚠️ NO FIX NEEDED
# Justification: Enum type name casing doesn't affect wire format or API contract
# PascalCase is the recommended style
#
# ============================================================================

# ============================================================================
# Category 12: x-ms-secret Extension Removal (2 changes) - CRITICAL
# ============================================================================
# Analysis:
# x-ms-secret extension removed from:
# 1. AsymmetricEncryptedSecret.encryptionCertThumbprint
# 2. GenerateCertResponse.privateKey
#
# x-ms-secret extension is CRITICAL for SDK generation:
# - Marks properties as sensitive/secret
# - SDKs handle these properties specially (no logging, secure storage)
# - Removal means SDKs won't treat these as secrets → SECURITY ISSUE
#
# ALL x-ms-* extension removals are BREAKING CHANGES with ZERO tolerance.
#
# Property Verification:
# Old: encryptionCertThumbprint (string, x-ms-secret: true)
# New: encryptionCertThumbprint (string, NO x-ms-secret)
# Difference: x-ms-secret REMOVED ❌ BREAKING
#
# Old: privateKey (string, x-ms-secret: true)
# New: privateKey (string, NO x-ms-secret)
# Difference: x-ms-secret REMOVED ❌ BREAKING
#
# Decision: ✅ REQUIRES FIX (CRITICAL - SECURITY)
# Justification: x-ms-secret removal changes SDK behavior for sensitive data handling
#
# Root Cause:
# TypeSpec @secret decorator not applied to these properties
#
# Proposed Solution:
# Add @secret decorator to both properties
#
# TSG Reference:
# https://github.com/Azure/azure-rest-api-specs/commit/ef1abc58a47464817543082b339adf13645a14d1
# "missing x-ms-secret"

# ----------------------------------------------------------------------------
# Fix 12.1: Restore x-ms-secret for encryptionCertThumbprint
# File: models.tsp - AsymmetricEncryptedSecret model
# ----------------------------------------------------------------------------

--- a/specification/databoxedge/DataBoxEdge.Management/models.tsp
+++ b/specification/databoxedge/DataBoxEdge.Management/models.tsp
@@ -XX,X +XX,X @@
 model AsymmetricEncryptedSecret {
   /**
    * Thumbprint certificate used to encrypt "Value". If the value is unencrypted, it will be null.
    */
+  @secret
   encryptionCertThumbprint?: string;

# ----------------------------------------------------------------------------
# Fix 12.2: Restore x-ms-secret for privateKey
# File: models.tsp - GenerateCertResponse model
# ----------------------------------------------------------------------------

--- a/specification/databoxedge/DataBoxEdge.Management/models.tsp
+++ b/specification/databoxedge/DataBoxEdge.Management/models.tsp
@@ -XX,X +XX,X @@
 model GenerateCertResponse {
   /**
    * The base64 encoded private key for the certificate.
    */
+  @secret
   privateKey?: string;

# ============================================================================
# Category 13: x-ms-pageable Removal (1 change) - CRITICAL
# ============================================================================
# Analysis:
# x-ms-pageable extension removed from AvailableSkus_List operation.
# This extension controls SDK pagination behavior.
#
# x-ms-pageable removal means:
# - SDKs won't implement pagination helpers
# - Clients need to manually handle nextLink
# - BREAKING CHANGE to SDK API surface
#
# ALL x-ms-* extension removals are BREAKING CHANGES.
#
# Property Verification:
# Old: x-ms-pageable: { nextLinkName: "nextLink" }
# New: NO x-ms-pageable
# Difference: x-ms-pageable REMOVED ❌ BREAKING
#
# Decision: ✅ REQUIRES FIX (CRITICAL)
# Justification: x-ms-pageable removal changes SDK pagination behavior
#
# Root Cause:
# Operation not using TypeSpec pagination template or @extension decorator
#
# Proposed Solution:
# Ensure operation returns a pageable response type with @pagedResult decorator
# OR add explicit @extension("x-ms-pageable", { nextLinkName: "nextLink" })
#
# TSG Reference:
# https://github.com/Azure/azure-rest-api-specs/commit/2783876a8b3a259251adff1609b592252ea0226a
# "missing x-ms-pageable for paging operation"

# ----------------------------------------------------------------------------
# Fix 13.1: Restore x-ms-pageable for AvailableSkus_List
# File: Find the AvailableSkus interface/operation definition
# ----------------------------------------------------------------------------

--- a/specification/databoxedge/DataBoxEdge.Management/routes.tsp (or appropriate file)
+++ b/specification/databoxedge/DataBoxEdge.Management/routes.tsp
@@ -XX,X +XX,X @@
 @route("/subscriptions/{subscriptionId}/providers/microsoft.DataBoxEdge/availableSkus")
 interface AvailableSkus {
   @doc("List all the available Skus in the region and information related to them")
+  @extension("x-ms-pageable", #{ nextLinkName: "nextLink" })
   list is Azure.Core.Foundations.Operation<
     {},
     DataBoxEdgeSkuList
   >;
 }

# ============================================================================
# FIX GENERATION SUMMARY
# ============================================================================
#
# Total Categories Analyzed: 13
# Categories Requiring Fixes: 6
# Categories with No Fix Needed: 7
#
# Critical Fixes Required:
# ✅ Category 1: Path Parameter Rename (3 fixes)
#    - Add @parentResource(Role) to Addon model
#    - Add @parentResource(Role) to MonitoringMetricConfiguration model
#    - Fix SecuritySettings update operation path
#
# ✅ Category 4: SystemData Property Removal (investigation needed)
#    - Investigate why systemData not appearing in generated swagger
#    - May need explicit property addition or inheritance fix
#
# ✅ Category 6: Common Type Version Update - MOST CRITICAL (4 major fixes)
#    - Define custom CloudError and CloudErrorBody models
#    - Define custom OperationsList and related models
#    - Update Operations interface to use custom OperationsList
#    - Update ALL 73+ operations to use CloudError instead of ErrorResponse
#
# ✅ Category 12: x-ms-secret Extension Removal - SECURITY CRITICAL (2 fixes)
#    - Add @secret to AsymmetricEncryptedSecret.encryptionCertThumbprint
#    - Add @secret to GenerateCertResponse.privateKey
#
# ✅ Category 13: x-ms-pageable Removal - SDK CRITICAL (1 fix)
#    - Add @extension("x-ms-pageable") to AvailableSkus_List operation
#
# Non-Breaking Categories (No Fix Needed):
# ⚠️ Category 2: Service Description Missing (documentation only)
# ⚠️ Category 3: Polymorphic Discriminator Changes (modern pattern)
# ⚠️ Category 5: LRO Response Headers Addition (strengthening)
# ⚠️ Category 7: Unused Model Definitions Removed (addressed in Category 6)
# ⚠️ Category 8: TypeSpec Helper Types Added (compiler internal)
# ⚠️ Category 9: Array Property Modifications (mostly strengthening)
# ⚠️ Category 10: DataBoxEdgeDevice Resource Properties (proper inheritance)
# ⚠️ Category 11: Enum Name Casing Changes (style improvement)
#
# ============================================================================
# NEXT STEPS
# ============================================================================
#
# 1. Review this fix plan and confirm approach
# 2. Apply fixes category by category with user confirmation
# 3. Run tsp compile after each category fix to verify
# 4. Re-run TSMV to verify fixes resolve swagger diffs
# 5. Iterate until all breaking changes are resolved
#
# ============================================================================
