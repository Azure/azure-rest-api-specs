{
  "swagger": "2.0",
  "info": {
    "version": "2022-04-07-preview",
    "title": "Azure Communication Service ServerCalling APIs",
    "description": "Azure Communication CallingServer Service"
  },
  "schemes": [
    "https"
  ],
  "consumes": [
    "application/json"
  ],
  "produces": [
    "application/json"
  ],
  "paths": {
    "/calling/callConnections": {
      "post": {
        "tags": [
          "PreConnections"
        ],
        "summary": "Create an outbound call.",
        "description": "Create an outbound call.",
        "operationId": "ServerCalling_CreateCall",
        "parameters": [
          {
            "name": "createCallRequest",
            "in": "body",
            "description": "The create call request.",
            "required": true,
            "schema": {
              "$ref": "#/definitions/CreateCallRequest"
            }
          },
          {
            "$ref": "#/parameters/ApiVersionParameter"
          }
        ],
        "responses": {
          "201": {
            "description": "Returns the create call response.",
            "schema": {
              "$ref": "#/definitions/CreateCallResponse"
            }
          }
        }
      },
      "x-ms-examples": {
        "calls": {
          "$ref": "./examples/ServerCalling_CreateCall.json"
        }
      }
    },
    "/calling/callConnections:answer": {
      "post": {
        "tags": [
          "PreConnections"
        ],
        "summary": "Answer a call.",
        "description": "Answer an incoming call using the IncomingCallContext from Event Grid.",
        "operationId": "ServerCalling_AnswerCall",
        "parameters": [
          {
            "name": "answerCallRequest",
            "in": "body",
            "description": "The answer call request.",
            "required": true,
            "schema": {
              "$ref": "#/definitions/AnswerCallRequest"
            }
          },
          {
            "$ref": "#/parameters/ApiVersionParameter"
          }
        ],
        "responses": {
          "202": {
            "description": "Returns the answer call response.",
            "schema": {
              "$ref": "#/definitions/AnswerCallResponse"
            }
          }
        },
        "x-ms-examples": {
          "answer": {
            "$ref": "./examples/ServerCalling_AnswerCall.json"
          }
        }
      }
    },
    "/calling/callConnections:redirect": {
      "post": {
        "tags": [
          "PreConnections"
        ],
        "summary": "Redirect a call.",
        "description": "Redirect an incoming call using the IncomingCallContext from Event Grid.",
        "operationId": "ServerCalling_RedirectCall",
        "parameters": [
          {
            "name": "redirectCallRequest",
            "in": "body",
            "description": "",
            "required": true,
            "schema": {
              "$ref": "#/definitions/RedirectCallRequest"
            }
          },
          {
            "$ref": "#/parameters/ApiVersionParameter"
          }
        ],
        "responses": {
          "202": {
            "description": "Returns the redirect call response."
          }
        }
      },
      "x-ms-examples": {
        "redirect": {
          "$ref": "./examples/ServerCalling_RedirectCall.json"
        }
      }
    },
    "/calling/callConnections:reject": {
      "post": {
        "tags": [
          "PreConnections"
        ],
        "summary": "Reject a call.",
        "description": "Reject an incoming call using the IncomingCallContext from Event Grid.",
        "operationId": "ServerCalling_RejectCall",
        "parameters": [
          {
            "name": "rejectCallRequest",
            "in": "body",
            "description": "The reject call request.",
            "required": true,
            "schema": {
              "$ref": "#/definitions/RejectCallRequest"
            }
          },
          {
            "$ref": "#/parameters/ApiVersionParameter"
          }
        ],
        "responses": {
          "202": {
            "description": "Returns the reject call response."
          }
        },
        "x-ms-examples": {
          "reject": {
            "$ref": "./examples/ServerCalling_RejectCall.json"
          }
        }
      }
    },
    "/calling/callConnections/{callConnectionId}": {
      "get": {
        "tags": [
          "MidConnections"
        ],
        "summary": "Get a call connection.",
        "description": "Get information of an existing call connection",
        "operationId": "CallConnections_GetCall",
        "parameters": [
          {
            "name": "callConnectionId",
            "in": "path",
            "description": "The call connection ID.",
            "required": true,
            "type": "string"
          },
          {
            "$ref": "#/parameters/ApiVersionParameter"
          }
        ],
        "responses": {
          "200": {
            "description": "Returns the get call response.",
            "schema": {
              "$ref": "#/definitions/CallConnectionProperties"
            }
          }
        },
        "x-ms-examples": {
          "get": {
            "$ref": "./examples/CallConnections_GetCall.json"
          }
        }
      },
      "delete": {
        "tags": [
          "MidConnections"
        ],
        "summary": "Hangup a call.",
        "description": "Hangup a call using call leg id.",
        "operationId": "CallConnections_HangupCall",
        "parameters": [
          {
            "name": "callConnectionId",
            "in": "path",
            "description": "The call connection ID.",
            "required": true,
            "type": "string"
          },
          {
            "$ref": "#/parameters/ApiVersionParameter"
          }
        ],
        "responses": {
          "204": {
            "description": "Returns the hangup call response."
          }
        },
        "x-ms-examples": {
          "hangUp": {
            "$ref": "./examples/CallConnections_HangUpCall.json"
          }
        }
      }
    },
    "/calling/callConnections/{callConnectionId}:terminate": {
      "post": {
        "tags": [
          "MidConnections"
        ],
        "summary": "Terminate a call using CallConnectionId.",
        "description": "Terminate a call, hanging up all participants in the call.",
        "operationId": "CallConnections_TerminateCall",
        "parameters": [
          {
            "name": "callConnectionId",
            "in": "path",
            "description": "The call connection ID.",
            "required": true,
            "type": "string"
          },
          {
            "$ref": "#/parameters/ApiVersionParameter"
          }
        ],
        "responses": {
          "202": {
            "description": "Returns the terminate call response."
          }
        },
        "x-ms-examples": {
          "terminate": {
            "$ref": "./examples/CallConnections_TerminateCall.json"
          }
        }
      }
    },
    "/calling/callConnections/{callConnectionId}:transferToParticipant": {
      "post": {
        "tags": [
          "MidConnections"
        ],
        "summary": "Transfer the call to a participant.",
        "description": "Transfer the call to a participant.",
        "operationId": "CallConnections_TransferToParticipant",
        "parameters": [
          {
            "name": "callConnectionId",
            "in": "path",
            "description": "The call connection id.",
            "required": true,
            "type": "string"
          },
          {
            "name": "transferToParticipantRequest",
            "in": "body",
            "description": "The transfer to participant request.",
            "required": true,
            "schema": {
              "$ref": "#/definitions/TransferToParticipantRequest"
            }
          },
          {
            "$ref": "#/parameters/ApiVersionParameter"
          }
        ],
        "responses": {
          "202": {
            "description": "Returns the transfer call response.",
            "schema": {
              "$ref": "#/definitions/TransferCallResponse"
            }
          }
        },
        "x-ms-examples": {
          "transferToParticipant": {
            "$ref": "./examples/CallConnections_TransferToParticipant.json"
          }
        }
      }
    },
    "/calling/callConnections/{callConnectionId}/operations": {
      "get": {
        "tags": [
          "MidConnections"
        ],
        "summary": "Get all operations associated with a call connection.",
        "description": "Get all operations associated with a call connection.",
        "operationId": "CallConnections_ListOperations",
        "parameters": [
          {
            "name": "callConnectionId",
            "in": "path",
            "description": "The call connection ID.",
            "required": true,
            "type": "string"
          },
          {
            "$ref": "#/parameters/ApiVersionParameter"
          }
        ],
        "responses": {
          "200": {
            "description": "Returns the list operations response.",
            "schema": {
              "$ref": "#/definitions/OperationsCollection"
            }
          }
        },
        "x-ms-examples": {
          "get": {
            "$ref": "./examples/CallConnections_ListOperations.json"
          }
        }
      }
    },
    "/calling/callConnections/{callConnectionId}/operations/{operationId}": {
      "get": {
        "tags": [
          "MidConnections"
        ],
        "summary": "Get the operation associated with a call connection.",
        "description": "Get the operation associated with a call connection.",
        "operationId": "CallConnections_GetOperation",
        "parameters": [
          {
            "name": "callConnectionId",
            "in": "path",
            "description": "The call connection ID.",
            "required": true,
            "type": "string"
          },
          {
            "name": "operationId",
            "in": "path",
            "description": "The operation ID.",
            "required": true,
            "type": "string"
          },
          {
            "$ref": "#/parameters/ApiVersionParameter"
          }
        ],
        "responses": {
          "200": {
            "description": "Returns the operation response.",
            "schema": {
              "$ref": "#/definitions/OperationResponse"
            }
          }
        },
        "x-ms-examples": {
          "get": {
            "$ref": "./examples/CallConnections_GetOperation.json"
          }
        }
      }
    },
    "/calling/callConnections/{callConnectionId}/participants": {
      "get": {
        "tags": [
          "MidConnections"
        ],
        "summary": "Get information of all participants from a call.",
        "description": "Get information of all participants from a call.",
        "operationId": "CallConnections_ListParticipant",
        "parameters": [
          {
            "name": "callConnectionId",
            "in": "path",
            "description": "The call connection ID.",
            "required": true,
            "type": "string"
          },
          {
            "in": "query",
            "name": "maxpagesize",
            "description": "Number of objects to return per page",
            "type": "integer",
            "format": "int32",
            "default": 20
          },
          {
            "$ref": "#/parameters/ApiVersionParameter"
          }
        ],
        "responses": {
          "200": {
            "description": "Returns the list participant response.",
            "schema": {
              "$ref": "#/definitions/CallParticipantCollection"
            }
          }
        },
        "x-ms-examples": {
          "listParticipants": {
            "$ref": "./examples/CallConnections_ListParticipant.json"
          }
        }
      }
    },
    "/calling/callConnections/{callConnectionId}/participants:add": {
      "post": {
        "tags": [
          "MidConnections"
        ],
        "summary": "Add participants to a call.",
        "description": "Add participants to a call.",
        "operationId": "CallConnections_AddParticipant",
        "parameters": [
          {
            "name": "callConnectionId",
            "in": "path",
            "description": "The call connection ID.",
            "required": true,
            "type": "string"
          },
          {
            "name": "addParticipantsRequest",
            "in": "body",
            "description": "The add participants request.",
            "required": true,
            "schema": {
              "$ref": "#/definitions/AddParticipantsRequest"
            }
          },
          {
            "$ref": "#/parameters/ApiVersionParameter"
          }
        ],
        "responses": {
          "202": {
            "description": "Returns the add participant response.",
            "schema": {
              "$ref": "#/definitions/AddParticipantsResponse"
            }
          }
        },
        "x-ms-examples": {
          "addParticipant": {
            "$ref": "./examples/CallConnections_AddParticipant.json"
          }
        }
      }
    },
    "/calling/callConnections/{callConnectionId}/participants:remove": {
      "post": {
        "tags": [
          "MidConnections"
        ],
        "summary": "Remove participants from a call.",
        "description": "Remove participants from a call.",
        "operationId": "CallConnections_RemoveParticipant",
        "parameters": [
          {
            "name": "callConnectionId",
            "in": "path",
            "description": "The call connection ID.",
            "required": true,
            "type": "string"
          },
          {
            "name": "removeParticipantsRequest",
            "in": "body",
            "description": "The remove participant request.",
            "required": true,
            "schema": {
              "$ref": "#/definitions/RemoveParticipantsRequest"
            }
          },
          {
            "$ref": "#/parameters/ApiVersionParameter"
          }
        ],
        "responses": {
          "202": {
            "description": "Returns the remove participant response.",
            "schema": {
              "$ref": "#/definitions/RemoveParticipantsResponse"
            }
          }
        },
        "x-ms-examples": {
          "removeParticipant": {
            "$ref": "./examples/CallConnections_RemoveParticipant.json"
          }
        }
      }
    },
    "/calling/callConnections/{callConnectionId}/participants:get": {
      "post": {
        "tags": [
          "MidConnections"
        ],
        "summary": "Get information of participant from a call.",
        "description": "Get information of participant from a call.",
        "operationId": "CallConnections_GetParticipant",
        "parameters": [
          {
            "name": "callConnectionId",
            "in": "path",
            "description": "The call connection ID.",
            "required": true,
            "type": "string"
          },
          {
            "name": "getParticipantRequest",
            "in": "body",
            "description": "The get participant request.",
            "required": true,
            "schema": {
              "$ref": "#/definitions/GetParticipantRequest"
            }
          },
          {
            "$ref": "#/parameters/ApiVersionParameter"
          }
        ],
        "responses": {
          "200": {
            "description": "Returns the get participant response.",
            "schema": {
              "$ref": "#/definitions/CallParticipant"
            }
          }
        },
        "x-ms-examples": {
          "getParticipant": {
            "$ref": "./examples/CallConnections_GetParticipant.json"
          }
        }
      }
    }
  },
  "definitions": {
    "AnswerCallRequest": {
      "description": "The request payload for answering the call.",
      "required": [
        "incomingCallContext"
      ],
      "type": "object",
      "properties": {
        "incomingCallContext": {
          "description": "The context associated with the call.",
          "type": "string"
        },
        "callbackUri": {
          "description": "The callback uri.",
          "type": "string"
        }
      }
    },
    "AnswerCallResponse": {
      "description": "The response payload of the answer call operation.",
      "type": "object",
      "properties": {
        "callConnectionId": {
          "description": "The call connection ID.",
          "type": "string",
          "readOnly": true
        },
        "serverCallId": {
          "description": "The server call id.",
          "type": "string",
          "readOnly": true
        }
      }
    },
    "RedirectCallRequest": {
      "description": "The request payload for redirecting the call.",
      "required": [
        "incomingCallContext",
        "target"
      ],
      "type": "object",
      "properties": {
        "incomingCallContext": {
          "description": "The context associated with the call.",
          "type": "string"
        },
        "target": {
          "$ref": "#/definitions/CommunicationIdentifierModel",
          "description": "The target identity to redirect the call to."
        }
      }
    },
    "TransferToParticipantRequest": {
      "description": "The transfer call to participant request.",
      "type": "object",
      "properties": {
        "targetParticipant": {
          "description": "The target participant to transfer the call to.",
          "$ref": "#/definitions/CommunicationIdentifierModel"
        },
        "userToUserInformation": {
          "description": "The user to user information.",
          "type": "string"
        },
        "alternateCallerId": {
          "description": "The alternate identity of the transferor if transferring to a pstn number.",
          "type": "string"
        },
        "operationContext": {
          "description": "The operation context.",
          "type": "string"
        }
      }
    },
    "CommunicationIdentifierModel": {
      "$ref": "../../../Common/stable/2021-03-07/common.json#/definitions/CommunicationIdentifierModel"
    },
    "CommunicationUserIdentifierModel": {
      "$ref": "../../../Common/stable/2021-03-07/common.json#/definitions/CommunicationUserIdentifierModel"
    },
    "PhoneNumberIdentifierModel": {
      "$ref": "../../../Common/stable/2021-03-07/common.json#/definitions/PhoneNumberIdentifierModel"
    },
    "CommunicationCloudEnvironmentModel": {
      "$ref": "../../../Common/stable/2021-03-07/common.json#/definitions/CommunicationCloudEnvironmentModel"
    },
    "MicrosoftTeamsUserIdentifierModel": {
      "$ref": "../../../Common/stable/2021-03-07/common.json#/definitions/MicrosoftTeamsUserIdentifierModel"
    },
    "CommunicationErrorResponse": {
      "$ref": "../../../Common/stable/2021-03-07/common.json#/definitions/CommunicationErrorResponse"
    },
    "CommunicationError": {
      "$ref": "../../../Common/stable/2021-03-07/common.json#/definitions/CommunicationError"
    },
    "CallRejectReason": {
      "description": "The rejection reason.",
      "enum": [
        "none",
        "busy",
        "forbidden"
      ],
      "type": "string",
      "x-ms-enum": {
        "name": "CallRejectReason",
        "modelAsString": true
      }
    },
    "RejectCallRequest": {
      "description": "The request payload for rejecting the call.",
      "required": [
        "incomingCallContext"
      ],
      "type": "object",
      "properties": {
        "incomingCallContext": {
          "description": "The context associated with the call.",
          "type": "string"
        },
        "callRejectReason": {
          "description": "The reject reason.",
          "$ref": "#/definitions/CallRejectReason"
        }
      }
    },
    "CreateCallRequest": {
      "description": "The request payload for create call.",
      "required": [
        "targets",
        "source",
        "callbackUri"
      ],
      "type": "object",
      "properties": {
        "targets": {
          "description": "The targets of the call.",
          "type": "array",
          "items": {
            "$ref": "#/definitions/CommunicationIdentifierModel"
          }
        },
        "source": {
          "description": "The source of the call.",
          "type": "object",
          "properties": {
            "callerId": {
              "$ref": "#/definitions/PhoneNumberIdentifierModel",
              "description": "The alternate identity of the source of the call if dialing out to a pstn number"
            },
            "identifier": {
              "$ref": "#/definitions/CommunicationIdentifierModel",
              "description": "The identity model of the source."
            }
          }
        },
        "subject": {
          "description": "The subject.",
          "type": "string"
        },
        "callbackUri": {
          "description": "The callback URI.",
          "type": "string"
        }
      }
    },
    "CallConnectionProperties": {
      "type": "object",
      "properties": {
        "callConnectionId": {
          "description": "The call connection ID.",
          "type": "string"
        },
        "serverCallId": {
          "description": "The server call id.",
          "type": "string"
        },
        "source": {
          "$ref": "#/definitions/CommunicationIdentifierModel",
          "description": "The source of the call."
        },
        "alternateCallerId": {
          "$ref": "#/definitions/PhoneNumberIdentifierModel",
          "description": "The alternate identity of the source of the call if dialing out to a pstn number"
        },
        "targets": {
          "description": "The targets of the call.",
          "type": "array",
          "items": {
            "$ref": "#/definitions/CommunicationIdentifierModel"
          }
        },
        "callConnectionState": {
          "$ref": "#/definitions/CallConnectionState"
        },
        "subject": {
          "description": "The subject.",
          "type": "string"
        },
        "callbackUri": {
          "description": "The callback URI.",
          "type": "string"
        }
      }
    },
    "TransferCallResponse": {
      "description": "The transfer call response.",
      "$ref": "#/definitions/OperationResponse"
    },
    "AddParticipantsRequest": {
      "description": "The add participant request.",
      "required": [
        "participantsToAdd"
      ],
      "type": "object",
      "properties": {
        "sourceCallerId": {
          "$ref": "#/definitions/PhoneNumberIdentifierModel",
          "description": "The alternate identity of source participant."
        },
        "participantsToAdd": {
          "description": "The participants to be added to the call.",
          "type": "array",
          "items": {
            "$ref": "#/definitions/CommunicationIdentifierModel"
          }
        },
        "operationContext": {
          "description": "The operation context.",
          "type": "string"
        },
        "invitationTimeoutInSeconds": {
          "description": "Timeout to wait for the invited participant to pick up. Maximum value is 180 seconds. Default is 180 seconds.",
          "type": "integer",
          "format": "int32"
        },
        "replacementCallConnectionId": {
          "description": "Replaces the call with this call connection Id after invitation.",
          "type": "string"
        }
      }
    },
    "AddParticipantsResponse": {
      "description": "The add participant response.",
      "$ref": "#/definitions/OperationResponse"
    },
    "RemoveParticipantsRequest": {
      "description": "The remove participant request.",
      "required": [
        "participantsToRemove"
      ],
      "type": "object",
      "properties": {
        "participantsToRemove": {
          "description": "The participants to be removed from the call.",
          "type": "array",
          "items": {
            "$ref": "#/definitions/CommunicationIdentifierModel"
          }
        },
        "operationContext": {
          "description": "The operation context.",
          "type": "string"
        }
      }
    },
    "RemoveParticipantsResponse": {
      "description": "The remove participant response.",
      "$ref": "#/definitions/OperationResponse"
    },
    "GetParticipantRequest": {
      "description": "The get participant request.",
      "required": [
        "participant"
      ],
      "type": "object",
      "properties": {
        "participant": {
          "description": "The participants to be get from the call.",
          "$ref": "#/definitions/CommunicationIdentifierModel"
        }
      }
    },
    "CallParticipant": {
      "description": "A participant in a call.",
      "required": [
        "identifier",
        "isMuted"
      ],
      "type": "object",
      "properties": {
        "identifier": {
          "$ref": "#/definitions/CommunicationIdentifierModel",
          "description": "Communication identifier of the participant"
        },
        "isMuted": {
          "description": "Is participant muted",
          "type": "boolean"
        }
      }
    },
    "CallParticipantCollection": {
      "description": "A paged collection of participants.",
      "required": [
        "value"
      ],
      "type": "object",
      "properties": {
        "value": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/CallParticipant"
          }
        },
        "nextLink": {
          "type": "string",
          "readOnly": true
        }
      }
    },
    "CallConnectionState": {
      "description": "The state of the call connection.",
      "enum": [
        "connecting",
        "connected",
        "transferring",
        "transferAccepted",
        "disconnecting",
        "disconnected"
      ],
      "type": "string",
      "x-ms-enum": {
        "name": "CallConnectionState",
        "modelAsString": true
      }
    },
    "CreateCallResponse": {
      "description": "The response payload of the create call operation.",
      "type": "object",
      "properties": {
        "callConnectionId": {
          "description": "The call connection ID.",
          "type": "string"
        },
        "serverCallId": {
          "description": "The server call id.",
          "type": "string"
        }
      }
    },
    "OperationResponse": {
      "description": "The response for long running operations.",
      "type": "object",
      "required": [
        "status"
      ],
      "properties": {
        "operationId": {
          "type": "string",
          "description": "The operation Id."
        },
        "status": {
          "enum": [
            "notStarted",
            "running",
            "completed",
            "failed"
          ],
          "description": "The state of the operation."
        },
        "operationContext": {
          "type": "string",
          "description": "The operation context."
        },
        "resultDetails": {
          "type": "object",
          "properties": {
            "code": {
              "type": "string",
              "description": "The result code associated with the operation."
            },
            "subcode": {
              "type": "string",
              "description": "The subcode that further classifies the result."
            },
            "message": {
              "type": "string",
              "description": "The message is a detailed explanation of subcode."
            }
          }
        }
      }
    },
    "OperationsCollection": {
      "description": "A paged collection of operations.",
      "required": [
        "value"
      ],
      "type": "object",
      "properties": {
        "value": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/OperationResponse"
          }
        },
        "nextLink": {
          "type": "string",
          "readOnly": true
        }
      }
    }
  },
  "parameters": {
    "ApiVersionParameter": {
      "name": "api-version",
      "in": "query",
      "description": "Version of API to invoke.",
      "required": true,
      "type": "string",
      "x-ms-parameter-location": "method"
    },
    "Endpoint": {
      "name": "endpoint",
      "in": "path",
      "description": "The endpoint of the Azure Communication resource.",
      "required": true,
      "type": "string",
      "x-ms-skip-url-encoding": true,
      "x-ms-parameter-location": "client"
    }
  },
  "x-ms-parameterized-host": {
    "hostTemplate": "{endpoint}",
    "useSchemePrefix": false,
    "parameters": [
      {
        "$ref": "#/parameters/Endpoint"
      }
    ]
  }
}
