{
    "parameters": {
        "subscriptionId": "caac1590-e859-444f-a9e0-62091c0f5929",
        "resourceGroupName": "myResourceGroup",
        "stepName": "healthCheckStep",
        "api-version": "2019-11-01-preview",
        "stepInfo": {
            "type": "Microsoft.DeploymentManager/steps",
            "location": "centralus",
            "tags": {},
            "properties": {
                "stepType": "healthCheck", 
                "attributes": {
                    "waitDuration": "PT15M",
                    "maxElasticDuration": "PT30M",
                    "HealthyStateDuration": "PT2H",
                    "type": "REST",
                    "properties": {
                        "HealthChecks": [
                            {
                                "Name": "appHealth",
                                "Request": {
                                    "Method": "Get",
                                    "Uri": "https://resthealth.healthservice.com/api/applications/contosoApp/healthStatus",
                                    "Authentication": {
                                        "Type": "ApiKey",
                                        "Name": "Code",
                                        "In": "Query",
                                        "Value": "NBCapiMOBQyAAbCkeytoPadnvO0eGHmidwFz5rXpappznKp3Jt7LLg=="
                                    }
                                },
                                "Response": {
                                    "SuccessStatusCodes": [
                                        "OK"
                                    ],
                                    "Regex": {
                                        "MatchQuantifier": "All",
                                        "Matches": [
                                            "(?i)Contoso-App",
                                            "(?i)\"health_status\":((.|\n)*)\"(green|yellow)\"",
                                            "(?mi)^(\"application_host\": 94781052)$"
                                        ]
                                    }
                                }
                            },
                            {
                                "Name": "serviceHealth",
                                "Request": {
                                    "Method": "Get",
                                    "Uri": "https://resthealth.healthservice.com/api/services/contosoService/healthStatus",
                                    "Authentication": {
                                        "Type": "ApiKey",
                                        "Name": "code",
                                        "In": "Header",
                                        "Value": "NBCapiMOBQyAAbCkeytoPadnvO0eGHmidwFz5rXpappznKp3Jt7LLg=="
                                    }
                                },
                                "Response": {
                                    "SuccessStatusCodes": [
                                        "OK"
                                    ],
                                    "Regex": {
                                        "MatchQuantifier": "All",
                                        "Matches": [
                                            "(?i)Contoso-Service-EndToEnd",
                                            "(?i)\"health_status\":((.|\n)*)\"(green)\"",
                                        ]
                                    }
                                }
                            }
                        ]
                    }
                }
            }
        }
    },
    "responses": {
        "201": {
            "body": {
                "name": "healthCheckStep",
                "type": "Microsoft.DeploymentManager/steps",
                "location": "centralus",
                "tags": {},
                "properties": {
                    "stepType": "healthCheck",
                    "attributes": {
                        "waitDuration": "PT15M",
                        "maxElasticDuration": "PT30M",
                        "HealthyStateDuration": "PT2H",
                        "type": "REST",
                        "properties": {
                            "HealthChecks": [
                                {
                                    "Name": "appHealth",
                                    "Request": {
                                        "Method": "Get",
                                        "Uri": "https://resthealth.healthservice.com/api/applications/contosoApp/healthStatus",
                                        "Authentication": {
                                            "Type": "ApiKey",
                                            "Name": "Code",
                                            "In": "Query",
                                            "Value": "NBCapiMOBQyAAbCkeytoPadnvO0eGHmidwFz5rXpappznKp3Jt7LLg=="
                                        }
                                    },
                                    "Response": {
                                        "SuccessStatusCodes": [
                                            "OK"
                                        ],
                                        "Regex": {
                                            "MatchQuantifier": "All",
                                            "Matches": [
                                                "(?i)Contoso-App",
                                                "(?i)\"health_status\":((.|\n)*)\"(green|yellow)\"",
                                                "(?mi)^(\"application_host\": 94781052)$"
                                            ]
                                        }
                                    }
                                },
                                {
                                    "Name": "serviceHealth",
                                    "Request": {
                                        "Method": "Get",
                                        "Uri": "https://resthealth.healthservice.com/api/services/contosoService/healthStatus",
                                        "Authentication": {
                                            "Type": "ApiKey",
                                            "Name": "code",
                                            "In": "Header",
                                            "Value": "NBCapiMOBQyAAbCkeytoPadnvO0eGHmidwFz5rXpappznKp3Jt7LLg=="
                                        }
                                    },
                                    "Response": {
                                        "SuccessStatusCodes": [
                                            "OK"
                                        ],
                                        "Regex": {
                                            "MatchQuantifier": "All",
                                            "Matches": [
                                                "(?i)Contoso-Service-EndToEnd",
                                                "(?i)\"health_status\":((.|\n)*)\"(green)\"",
                                            ]
                                        }
                                    }
                                }
                            ]
                        }
                    }
                }
            }
        }
    }
}