{
  "tags": {
      "created by": "azureuser"
  },
  "location": "eastus2",
  "type": "microsoft.workloads/sapvirtualinstances",
  "properties": {
      "environment": "Prod",
      "sapProduct": "S4HANA",
      "configuration": {
          "configurationType": "DeploymentWithOSConfig",
          "appLocation": "eastus",
          "infrastructureConfiguration": {
              "deploymentType": "ThreeTier",
              "appResourceGroup": "{{resourcegrp}}",
              "networkConfiguration": {
                  "isSecondaryIpEnabled": true
              },
              "centralServer": {
                  "subnetId": "/subscriptions/49d64d54-e966-4c46-a868-1999802b762c/resourceGroups/test-rg/providers/Microsoft.Network/virtualNetworks/test-vnet/subnets/app",
                  "virtualMachineConfiguration": {
                      "vmSize": "Standard_E4ds_v4",
                      "imageReference": {
                          "sku": "8.2",
                          "publisher": "RedHat",
                          "version": "8.2.2021091201",
                          "offer": "RHEL-SAP-HA"
                      },
                      "osProfile": {
                          "adminUsername": "azureuser",
                          "osConfiguration": {
                              "osType": "Linux",
                              "disablePasswordAuthentication": true,
                              "sshKeyPair": {
                                  "publicKey": "{{sshkey}}",
                                  "privateKey": "{{privateKey}}"
                              }
                          }
                      }
                  },
                  "instanceCount": 1
              },
              "applicationServer": {
                  "subnetId": "/subscriptions/49d64d54-e966-4c46-a868-1999802b762c/resourceGroups/test-rg/providers/Microsoft.Network/virtualNetworks/test-vnet/subnets/app",
                  "virtualMachineConfiguration": {
                      "vmSize": "Standard_E4ds_v4",
                      "imageReference": {
                          "sku": "8.2",
                          "publisher": "RedHat",
                          "version": "8.2.2021091201",
                          "offer": "RHEL-SAP-HA"
                      },
                      "osProfile": {
                          "adminUsername": "azureuser",
                          "osConfiguration": {
                              "osType": "Linux",
                              "disablePasswordAuthentication": true,
                              "sshKeyPair": {
                                  "publicKey": "{{sshkey}}",
                                  "privateKey": "{{privateKey}}"
                              }
                          }
                      }
                  },
                  "instanceCount": 2
              },
              "databaseServer": {
                  "subnetId": "/subscriptions/49d64d54-e966-4c46-a868-1999802b762c/resourceGroups/test-rg/providers/Microsoft.Network/virtualNetworks/test-vnet/subnets/app",
                  "virtualMachineConfiguration": {
                      "vmSize": "Standard_M32ts",
                      "imageReference": {
                          "sku": "8.2",
                          "publisher": "RedHat",
                          "version": "8.2.2021091201",
                          "offer": "RHEL-SAP-HA"
                      },
                      "osProfile": {
                          "adminUsername": "azureuser",
                          "osConfiguration": {
                              "osType": "Linux",
                              "disablePasswordAuthentication": true,
                              "sshKeyPair": {
                                  "publicKey": "{{sshkey}}",
                                  "privateKey": "{{privateKey}}"
                              }
                          }
                      }
                  },
                  "instanceCount": 1
              }
          },
          "softwareConfiguration": {
            "softwareInstallationType": "SAPInstallWithoutOSConfig",
            "bomUrl": "https://teststorageaccount.blob.core.windows.net/sapbits/sapfiles/boms/S41909SPS03_v0011ms/S41909SPS03_v0011ms.yaml",
            "softwareVersion": "SAP S/4HANA 1909 SPS 03",
            "sapBitsStorageAccountId": "/subscriptions/49d64d54-e966-4c46-a868-1999802b762c/resourceGroups/test-rg/providers/Microsoft.Storage/storageAccounts/teststorageaccount"
          },
          "osSapConfiguration": {
              "sapFqdn": "sap.bpaas.com"
          }
      }
  }
}
