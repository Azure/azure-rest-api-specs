{
  "parameters": {
    "resourceUrl": "management.azure.com/",
    "api-version": "2021-03-15-preview"
  },
  "responses": {
    "200": {
      "body": {
        "value": [
          {
            "resourceProviderName": "Microsoft.Compute",
            "properties": {
              "value": [
                {
                  "resourceType": "virtualMachines",
                  "resourceQuery": {
                    "resourceQueryType": "ARG",
                    "resourceQueryMethod": "POST",
                    "resourceQueryUri": "https://management.azure.com/providers/Microsoft.ResourceGraph/resources?api-version=2019-04-01",
                    "resourceQueryPostTemplate": "where type contains 'virtualMachines'"
                  },
                  "resourceUsagesQuery": {
                    "resourceQueryType": "RestAPI",
                    "resourceQueryMethod": "GET",
                    "resourceQueryUri": "https://management.azure.com/subscriptions/{{subscriptionId}}/providers/Microsoft.Compute/locations/{{location}}/usages?api-version=2020-12-01",
                    "resourceQueryPostTemplate": ""
                  },
                  "dimensions": [
                    {
                      "name": "subscriptionId",
                      "displayName": "SubscriptionId"
                    },
                    {
                      "name": "location",
                      "displayName": "Location"
                    }
                  ],
                  "quotaBuckets": [
                    {
                      "name": "virtualMachines",
                      "displayName": "vCPUs Skus"
                    },
                    {
                      "name": "lowPriorityCores",
                      "displayName": "Total Regional Low-priority vCPUs"
                    },
                    {
                      "name": "cores",
                      "displayName": "Total Regional vCPUs"
                    }
                  ]
                }
              ]
            }
          },
          {
            "resourceProviderName": "Microsoft.Batch",
            "properties": {
              "value": [
                {
                  "resourceType": "batchAccounts/pool",
                  "resourceQuery": {
                    "resourceQueryType": "ARG",
                    "resourceQueryMethod": "POST",
                    "resourceQueryUri": "https://management.azure.com/providers/Microsoft.ResourceGraph/resources?api-version=2019-04-01",
                    "resourceQueryPostTemplate": "where type contains 'batchAccounts' and isnotempty(properties.batchAccountName)"
                  },
                  "resourceUsagesQuery": {
                    "resourceQueryType": "RestAPI",
                    "resourceQueryMethod": "GET",
                    "resourceQueryUri": "https://management.azure.com/subscriptions/{{subscriptionId}}/providers/Microsoft.Batch/locations/{{location}}/usages?api-version=2020-12-01",
                    "resourceQueryPostTemplate": ""
                  },
                  "dimensions": [
                    {
                      "name": "subscriptionId",
                      "displayName": "SubscriptionId"
                    },
                    {
                      "name": "location",
                      "displayName": "Location"
                    },
                    {
                      "name": "batchAccounts",
                      "displayName": "BatchAccount Name"
                    }
                  ],
                  "quotaBuckets": [
                    {
                      "name": "PoolQuota",
                      "displayName": "PoolQuota"
                    },
                    {
                      "name": "JobQuota",
                      "displayName": "JobQuota"
                    },
                    {
                      "name": "LowPriorityCoreQuota",
                      "displayName": "Low Priority Cores"
                    },
                    {
                      "name": "virtualMachines",
                      "displayName": "vCPUs Skus"
                    }
                  ]
                },
                {
                  "resourceType": "batchAccounts",
                  "resourceQuery": {
                    "resourceQueryType": "ARG",
                    "resourceQueryMethod": "POST",
                    "resourceQueryUri": "https://management.azure.com/providers/Microsoft.ResourceGraph/resources?api-version=2019-04-01",
                    "resourceQueryPostTemplate": "where type contains 'batchAccounts'"
                  },
                  "resourceUsagesQuery": {
                    "resourceQueryType": "RestAPI",
                    "resourceQueryMethod": "GET",
                    "resourceQueryUri": "https://management.azure.com/subscriptions/{{subscriptionId}}/providers/Microsoft.Compute/locations/{{location}}/usages?api-version=2020-12-01",
                    "resourceQueryPostTemplate": ""
                  },
                  "dimensions": [
                    {
                      "name": "subscriptionId",
                      "displayName": "SubscriptionId"
                    },
                    {
                      "name": "location",
                      "displayName": "Location"
                    }
                  ],
                  "quotaBuckets": [
                    {
                      "name": "BatchAccountQuota",
                      "displayName": "BatchAccountQuota"
                    }
                  ]
                }
              ]
            }
          },
          {
            "resourceProviderName": "Microsoft.Network",
            "properties": {
              "value": [
                {
                  "resourceType": "PublicIpAddresses",
                  "resourceQuery": {
                    "resourceQueryType": "ARG",
                    "resourceQueryMethod": "POST",
                    "resourceQueryUri": "https://management.azure.com/providers/Microsoft.ResourceGraph/resources?api-version=2019-04-01",
                    "resourceQueryPostTemplate": "where type contains 'publicIPAddresses' and isnotempty(properties.ipAddress)"
                  },
                  "resourceUsagesQuery": {
                    "resourceQueryType": "RestAPI",
                    "resourceQueryMethod": "GET",
                    "resourceQueryUri": "https://management.azure.com/subscriptions/{{subscriptionId}}/providers/Microsoft.Compute/locations/{{location}}/usages?api-version=2020-12-01"
                  },
                  "dimensions": [
                    {
                      "name": "subscriptions",
                      "displayName": "Subscription"
                    },
                    {
                      "name": "locations",
                      "displayName": "Location"
                    }
                  ],
                  "quotaBuckets": [
                    {
                      "name": "PublicIPAddresses",
                      "displayName": "PublicIPAddresses"
                    },
                    {
                      "name": "StandardSkuPublicIpAddresses",
                      "displayName": "Public IP Addresses - Standard"
                    }
                  ]
                }
              ]
            }
          }
        ]
      }
    }
  }
}
